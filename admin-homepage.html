<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–é å…§å®¹ç®¡ç† - åŒ å¯µå¾Œå°</title>
    <!-- é–‹ç™¼ç’°å¢ƒï¼šå¼·åˆ¶ç¦ç”¨ç·©å­˜ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- å…¨å±€é…ç½®ï¼ˆå¿…é ˆå…ˆè¼‰å…¥ï¼Œæä¾› loggerï¼‰ -->
    <script src="js/config.js"></script>
    
    <!-- é¦–é é…ç½®ç®¡ç†ç³»çµ± -->
    <script src="js/homepage-config.js"></script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .sidebar-item {
            transition: all 0.2s ease;
        }
        .sidebar-item:hover {
            background: rgba(230, 57, 70, 0.1);
            border-left: 4px solid #E63946;
        }
        .sidebar-item.active {
            background: rgba(230, 57, 70, 0.15);
            border-left: 4px solid #E63946;
            font-weight: 600;
        }
        .content-block {
            border: 2px dashed #e5e7eb;
            transition: all 0.3s;
        }
        .content-block.draggable-item {
            cursor: move;
            user-select: none;
        }
        .content-block.draggable-item:hover {
            border-color: #3B82F6;
        }
        .content-block.draggable-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        .content-block.drag-over {
            border-top: 3px solid #3B82F6 !important;
            background-color: #EFF6FF !important;
        }
        .content-block.draggable-item[draggable="true"]:active {
            opacity: 0.5;
        }
        .drag-handle {
            cursor: grab;
            pointer-events: auto;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        /* é˜²æ­¢å…§éƒ¨å…ƒç´ é˜»æ­¢æ‹–æ‹½ */
        .content-block.draggable-item button,
        .content-block.draggable-item input,
        .content-block.draggable-item label {
            pointer-events: auto;
        }
        .content-block:hover {
            border-color: #ef4444;
            background: #fef2f2;
        }
        .content-block.active {
            border-color: #ef4444;
            border-style: solid;
            background: #fef2f2;
        }
        /* æ‹–æ‹½ä¸Šå‚³æ¨£å¼ */
        #heroImageUploadArea {
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #heroImageUploadArea.drag-over {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        #heroImageDragOverlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            border-radius: 0.5rem;
        }
        
        /* ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨æ¨£å¼ */
        .product-item {
            transition: all 0.3s;
        }
        
        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .drag-handle {
            cursor: move;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #7C3AED;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Modal å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é ‚éƒ¨å°èˆªæ¬„ -->
    <nav class="bg-white border border-gray-200 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-400 rounded-xl flex items-center justify-center">
                        <i class="fas fa-paw text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">åŒ å¯µå¾Œå°</h1>
                        <p class="text-xs text-gray-500">é¦–é å…§å®¹ç®¡ç†</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="previewWebsite()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">
                    <i class="fas fa-eye mr-2"></i>é è¦½ç¶²ç«™
                </button>
                <button onclick="publishChanges()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                    <i class="fas fa-upload mr-2"></i>ç™¼å¸ƒæ›´æ–°
                </button>
                <button class="relative text-gray-600 hover:text-gray-800">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                </button>
                <div class="flex items-center space-x-3 border-l pl-4">
                    <div class="hidden md:block text-right">
                        <p class="text-sm font-semibold text-gray-800" id="adminName">è¶…ç´šç®¡ç†å“¡</p>
                        <p class="text-xs text-gray-500" id="adminRole">Super Admin</p>
                    </div>
                    <button onclick="showUserMenu()" class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">A</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- å´é‚Šæ¬„ -->
    <aside id="sidebar" class="sidebar fixed left-0 top-16 bottom-0 w-64 bg-white border border-gray-200 overflow-y-auto z-40">
    <div class="p-4">
        <nav class="space-y-2">
            <a href="admin-dashboard.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                <i class="fas fa-chart-line text-lg w-6"></i>
                <span>å„€è¡¨æ¿</span>
            </a>
            <div class="sidebar-section">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">ç”¨æˆ¶ç®¡ç†</p>
                <a href="admin-users.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-users text-lg w-6"></i>
                    <span>ç”¨æˆ¶åˆ—è¡¨</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">å•†å“ç®¡ç†</p>
                <a href="admin-products.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-box text-lg w-6"></i>
                    <span>ç”¢å“åˆ—è¡¨</span>
                </a>
                <a href="admin-orders.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-shopping-cart text-lg w-6"></i>
                    <span>è¨‚å–®ç®¡ç†</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">15</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">ç‰©æµç®¡ç†</p>
                <a href="admin-shipping.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-shipping-fast text-lg w-6"></i>
                    <span>ç‰©æµè¨­å®š</span>
                </a>
                <a href="checkout.html" target="_blank" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-truck text-lg w-6"></i>
                    <span>æ¸¬è©¦çµå¸³æµç¨‹</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">æ¸¬é©—ç³»çµ±</p>
                <a href="admin-quizzes.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-clipboard-list text-lg w-6"></i>
                    <span>æ¸¬é©—åˆ—è¡¨</span>
                </a>
                <a href="admin-quiz-stats.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-chart-pie text-lg w-6"></i>
                    <span>æ¸¬é©—çµ±è¨ˆ</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">è¨‚é–±æœå‹™</p>
                <a href="admin-subscription-management.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-sync-alt text-lg w-6"></i>
                    <span>è¨‚é–±ç®¡ç†</span>
                </a>
                <a href="admin-subscription-options.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-list-alt text-lg w-6"></i>
                    <span>è¨‚é–±é¸é …</span>
                </a>
                <a href="admin-jar-program.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-recycle text-lg w-6"></i>
                    <span>æ›ç½è¨ˆç•«</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">æ•¸æ“šåˆ†æ</p>
                <a href="admin-analytics.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-chart-bar text-lg w-6"></i>
                    <span>ç‡Ÿæ”¶å ±è¡¨</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">ç³»çµ±è¨­å®š</p>
                
                <a href="admin-website-settings.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-palette text-lg w-6"></i>
                    <span>ç¶²ç«™ä½ˆå±€</span>
                </a>
                <a href="admin-payment.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-credit-card text-lg w-6"></i>
                    <span>é‡‘æµè¨­å®š</span>
                </a>
                <a href="admin-settings.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-cog text-lg w-6"></i>
                    <span>ç³»çµ±è¨­å®š</span>
                </a>
                <a href="admin-login.html" onclick="logout()" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600">
                    <i class="fas fa-sign-out-alt text-lg w-6"></i>
                    <span>ç™»å‡º</span>
                </a>
            </div>
        </nav>
    </div>
</aside>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="ml-64 mt-16 p-6">
        <!-- é é¢æ¨™é¡Œ -->
        <div class="mb-6">
            <h2 class="text-3xl font-bold text-gray-800">é¦–é å…§å®¹ç®¡ç†</h2>
            <p class="text-gray-600 mt-1">åƒè€ƒ Cyberbiz æ¨¡å¼ï¼Œæ‹–æ‹½ã€ç·¨è¼¯ã€å³æ™‚é è¦½é¦–é å„å€å¡Šå…§å®¹</p>
        </div>

        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="bg-white rounded-2xl border border-gray-200 p-6 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="addNewBlock()" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                        <i class="fas fa-plus mr-2"></i>æ–°å¢å€å¡Š
                    </button>
                    <button onclick="resetToDefault()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-undo mr-2"></i>æ¢å¾©é è¨­
                    </button>
                </div>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-info-circle mr-1"></i>
                    æœ€å¾Œæ›´æ–°: <span id="lastUpdate">2024-12-21 14:30</span>
                </div>
            </div>
        </div>

        <!-- å…§å®¹å€å¡Šåˆ—è¡¨ -->
        <div class="space-y-4" id="contentBlocks">
            <!-- å€å¡Šå°‡å‹•æ…‹è¼‰å…¥ -->
        </div>
        
        <!-- éš±è—çš„å€å¡Šæ¨¡æ¿ï¼ˆç”¨æ–¼å‹•æ…‹æ¸²æŸ“ï¼‰ -->
        <template id="blockTemplate">
            <div class="content-block bg-white rounded-2xl border border-gray-200 p-6 draggable-item" data-block-id="" style="transition: transform 0.2s;">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-grip-vertical text-gray-400 text-xl cursor-move drag-handle"></i>
                        <h3 class="text-xl font-bold text-gray-800 block-title"></h3>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold block-badge"></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="edit-btn px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold">
                            <i class="fas fa-edit mr-1"></i>ç·¨è¼¯
                        </button>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="toggle-checkbox sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                </div>
                <div class="block-content"></div>
            </div>
        </template>

        <!-- æ–°å¢å€å¡Šèªªæ˜ -->
        <div class="mt-8 bg-blue-50 border-2 border-blue-200 rounded-2xl p-6">
            <h3 class="text-lg font-bold text-blue-900 mb-3">
                <i class="fas fa-lightbulb mr-2"></i>å€å¡Šç®¡ç†èªªæ˜
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800">
                <div>
                    <p class="mb-2"><strong>â€¢ èª¿æ•´é †åºï¼š</strong>ä½¿ç”¨ä¸Šç§»/ä¸‹ç§»æŒ‰éˆ•èª¿æ•´å€å¡Šé †åº</p>
                    <p class="mb-2"><strong>â€¢ ç·¨è¼¯å…§å®¹ï¼š</strong>é»æ“Šã€Œç·¨è¼¯ã€æŒ‰éˆ•ä¿®æ”¹å€å¡Šå…§å®¹</p>
                    <p class="mb-2"><strong>â€¢ é–‹é—œé¡¯ç¤ºï¼š</strong>ä½¿ç”¨é–‹é—œæ§åˆ¶å€å¡Šåœ¨å‰å°çš„é¡¯ç¤º/éš±è—</p>
                </div>
                <div>
                    <p class="mb-2"><strong>â€¢ å³æ™‚é è¦½ï¼š</strong>é»æ“Šã€Œé è¦½ç¶²ç«™ã€æŸ¥çœ‹å¯¦éš›æ•ˆæœ</p>
                    <p class="mb-2"><strong>â€¢ ç™¼å¸ƒæ›´æ–°ï¼š</strong>å®Œæˆç·¨è¼¯å¾Œé»æ“Šã€Œç™¼å¸ƒæ›´æ–°ã€å¥—ç”¨è®Šæ›´</p>
                    <p class="mb-2"><strong>â€¢ æ¢å¾©é è¨­ï¼š</strong>å¯éš¨æ™‚æ¢å¾©åˆ°åŸå§‹é è¨­é…ç½®</p>
                </div>
            </div>
        </div>
    </main>

    <!-- ç·¨è¼¯å€å¡Š Modal -->
    <div id="editBlockModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h3 class="text-2xl font-bold text-gray-800" id="editModalTitle">ç·¨è¼¯å€å¡Š</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <div class="p-6" id="editModalContent">
                <!-- å‹•æ…‹è¼‰å…¥ç·¨è¼¯è¡¨å–® -->
            </div>

            <div class="sticky bottom-0 bg-gray-50 px-6 py-4 flex items-center justify-end space-x-3 border-t border-gray-200">
                <button onclick="closeEditModal()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="saveBlockChanges()" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                    <i class="fas fa-save mr-2"></i>å„²å­˜è®Šæ›´
                </button>
            </div>
        </div>
    </div>

    <!-- ç”¢å“é¸æ“‡å™¨ Modal -->
    <div id="productSelectorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" style="animation: fadeIn 0.3s ease; z-index: 10000 !important;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col" style="animation: slideUp 0.3s ease;">
            
            <!-- Modal æ¨™é¡Œ -->
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">é¸æ“‡ç”¢å“</h2>
                    <p class="text-sm text-gray-600 mt-1">å·²é¸æ“‡ <span id="selectedProductsCount" class="font-bold text-purple-600">0</span> å€‹ç”¢å“</p>
                </div>
                <button onclick="closeProductSelector()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- æœå°‹å’Œç¯©é¸å€ -->
            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- æœå°‹æ¡† -->
                    <div class="flex-1 relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" 
                               id="productSelectorSearch"
                               placeholder="æœå°‹ç”¢å“åç¨±ã€SKU æˆ–æè¿°..." 
                               oninput="filterProductsInSelector()"
                               class="w-full pl-11 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    
                    <!-- åˆ†é¡ç¯©é¸ -->
                    <select id="productSelectorCategory" 
                            onchange="filterProductsInSelector()"
                            class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                        <option value="snacks">æ‰‹ä½œé›¶é£Ÿ</option>
                        <option value="toys">ç›Šæ™ºç©å…·</option>
                        <option value="subscription">è¨‚é–±ç½ç½</option>
                        <option value="crowdfunding">é›†è³‡é …ç›®</option>
                    </select>
                    
                    <!-- ç‹€æ…‹ç¯©é¸ -->
                    <select id="productSelectorStatus" 
                            onchange="filterProductsInSelector()"
                            class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500">
                        <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                        <option value="active">ä¸Šæ¶ä¸­</option>
                        <option value="inactive">å·²ä¸‹æ¶</option>
                        <option value="out_of_stock">å·²å”®å®Œ</option>
                    </select>
                </div>
                
                <!-- æ‰¹é‡æ“ä½œ -->
                <div class="flex items-center justify-between mt-4">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" 
                               id="selectAllProducts" 
                               onchange="toggleSelectAllProducts()"
                               class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                        <span class="text-sm font-semibold text-gray-700">å…¨é¸ç•¶å‰ç¯©é¸çµæœ</span>
                    </label>
                    <div class="text-sm text-gray-600">
                        å…±æ‰¾åˆ° <span id="filteredProductsCount" class="font-bold">0</span> å€‹ç”¢å“
                    </div>
                </div>
            </div>
            
            <!-- ç”¢å“åˆ—è¡¨ -->
            <div class="flex-1 overflow-y-auto p-6">
                <div id="productSelectorList" class="space-y-3">
                    <!-- å‹•æ…‹ç”Ÿæˆç”¢å“åˆ—è¡¨ -->
                </div>
            </div>
            
            <!-- åº•éƒ¨æŒ‰éˆ• -->
            <div class="sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    å·²é¸æ“‡ <span id="selectedCountBottom" class="font-bold text-purple-600">0</span> å€‹ç”¢å“
                </div>
                <div class="flex space-x-3">
                    <button onclick="closeProductSelector()" 
                            class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 font-semibold">
                        å–æ¶ˆ
                    </button>
                    <button onclick="confirmProductSelection()" 
                            class="px-6 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 font-semibold">
                        <i class="fas fa-check mr-2"></i>ç¢ºèªé¸æ“‡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨ Modal -->
    <div id="productsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" style="animation: fadeIn 0.3s ease;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto" style="animation: slideUp 0.3s ease;">
            
            <!-- Modal æ¨™é¡Œ -->
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">ç·¨è¼¯ - ç”¢å“ç³»åˆ—å€å¡Š</h2>
                    <p class="text-sm text-gray-600 mt-1">è¨­å®šé¦–é ç”¢å“ç³»åˆ—çš„é¡¯ç¤ºå…§å®¹èˆ‡æ¨£å¼</p>
                </div>
                <button onclick="closeProductsModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Modal å…§å®¹ -->
            <form id="productsForm" class="p-6 space-y-8">
                
                <!-- åŸºæœ¬è¨­å®š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-cog text-purple-600 mr-2"></i>
                        åŸºæœ¬è¨­å®š
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">å€å¡Šæ¨™é¡Œ *</label>
                            <input type="text" id="blockTitle" value="ä¸‰å¤§ç”¢å“ç³»åˆ—" required
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">å‰¯æ¨™é¡Œ</label>
                            <input type="text" id="blockSubtitle" value="æ»¿è¶³ä¸åŒéœ€æ±‚"
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">æè¿°æ–‡å­—</label>
                        <textarea id="blockDescription" rows="2"
                                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                  placeholder="é¸å¡«ï¼šå€å¡Šçš„æè¿°èªªæ˜..."></textarea>
                    </div>
                </div>
                
                <!-- é¡¯ç¤ºè¨­å®š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-eye text-blue-600 mr-2"></i>
                        é¡¯ç¤ºè¨­å®š
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">é¡¯ç¤ºæ–¹å¼ *</label>
                            <select id="displayMode" required
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <option value="carousel">è¼ªæ’­å±•ç¤º</option>
                                <option value="grid">ç¶²æ ¼å±•ç¤º</option>
                                <option value="list">åˆ—è¡¨å±•ç¤º</option>
                                <option value="card">å¡ç‰‡å±•ç¤º</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">é¡¯ç¤ºæ•¸é‡ *</label>
                            <input type="number" id="displayCount" value="3" min="1" max="12" required
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">æ’åºæ–¹å¼ *</label>
                            <select id="sortOrder" required
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <option value="custom">è‡ªè¨‚æ’åº</option>
                                <option value="newest">æœ€æ–°å„ªå…ˆ</option>
                                <option value="popular">ç†±é–€å„ªå…ˆ</option>
                                <option value="price-asc">åƒ¹æ ¼ä½è‡³é«˜</option>
                                <option value="price-desc">åƒ¹æ ¼é«˜è‡³ä½</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center space-x-3 p-4 bg-gray-50 rounded-xl">
                            <input type="checkbox" id="showPrice" checked class="w-5 h-5 text-purple-600 rounded">
                            <label for="showPrice" class="text-sm font-semibold text-gray-700">é¡¯ç¤ºåƒ¹æ ¼</label>
                        </div>
                        
                        <div class="flex items-center space-x-3 p-4 bg-gray-50 rounded-xl">
                            <input type="checkbox" id="showButton" checked class="w-5 h-5 text-purple-600 rounded">
                            <label for="showButton" class="text-sm font-semibold text-gray-700">é¡¯ç¤ºã€ŒæŸ¥çœ‹æ›´å¤šã€æŒ‰éˆ•</label>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸‰å¤§ç”¢å“ç³»åˆ—é¸æ“‡ -->
                <div class="space-y-6">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-shopping-bag text-green-600 mr-2"></i>
                        ä¸‰å¤§ç”¢å“ç³»åˆ—è¨­å®š
                    </h3>
                    
                    <!-- ç³»åˆ—é¡¯ç¤ºæ§åˆ¶ -->
                    <div class="mb-6 bg-gray-50 rounded-xl p-4">
                        <h4 class="font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-eye mr-2 text-blue-500"></i>
                            ç³»åˆ—é¡¯ç¤ºè¨­å®š
                        </h4>
                        <div class="space-y-3">
                            <!-- ç›Šæ™ºç©å…· -->
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">ğŸ§ </span>
                                    <div>
                                        <p class="font-semibold text-gray-800">ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—</p>
                                        <p class="text-sm text-gray-500">æ§åˆ¶æ­¤ç³»åˆ—æ˜¯å¦åœ¨é¦–é é¡¯ç¤º</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enableSeriesToys" checked 
                                           onchange="if(window.toggleSeriesVisibility){window.toggleSeriesVisibility('toys', this.checked);}else{console.error('toggleSeriesVisibilityæœªå®šç¾©');}"
                                           class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                                </label>
                            </div>
                            
                            <!-- æ‰‹ä½œé›¶é£Ÿ -->
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">ğŸ®</span>
                                    <div>
                                        <p class="font-semibold text-gray-800">å°ç£å¤œå¸‚æ‰‹ä½œé›¶é£Ÿ</p>
                                        <p class="text-sm text-gray-500">æ§åˆ¶æ­¤ç³»åˆ—æ˜¯å¦åœ¨é¦–é é¡¯ç¤º</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enableSeriesSnacks" checked 
                                           onchange="if(window.toggleSeriesVisibility){window.toggleSeriesVisibility('snacks', this.checked);}else{console.error('toggleSeriesVisibilityæœªå®šç¾©');}"
                                           class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                                </label>
                            </div>
                            
                            <!-- è¨‚é–±ç³»åˆ— -->
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">â™»ï¸</span>
                                    <div>
                                        <p class="font-semibold text-gray-800">ç‡Ÿé¤Šç½è¨‚é–±ç³»åˆ—</p>
                                        <p class="text-sm text-gray-500">æ§åˆ¶æ­¤ç³»åˆ—æ˜¯å¦åœ¨é¦–é é¡¯ç¤º</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enableSeriesSubscription" checked 
                                           onchange="if(window.toggleSeriesVisibility){window.toggleSeriesVisibility('subscription', this.checked);}else{console.error('toggleSeriesVisibilityæœªå®šç¾©');}"
                                           class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç³»åˆ—æ¨™ç±¤åˆ‡æ› -->
                    <div class="flex gap-3 border-b border-gray-200 mb-4">
                        <button type="button" onclick="if(window.switchProductSeriesTab){window.switchProductSeriesTab('toys');}else{console.error('switchProductSeriesTabæœªå®šç¾©');}" 
                                id="seriesTabToys" 
                                class="px-6 py-3 font-semibold border-b-2 border-orange-500 text-orange-600 transition">
                            ğŸ§  ç›Šæ™ºç©å…·
                        </button>
                        <button type="button" onclick="if(window.switchProductSeriesTab){window.switchProductSeriesTab('snacks');}else{console.error('switchProductSeriesTabæœªå®šç¾©');}" 
                                id="seriesTabSnacks" 
                                class="px-6 py-3 font-semibold border-b-2 border-transparent text-gray-600 hover:text-red-600 transition">
                            ğŸ® æ‰‹ä½œé›¶é£Ÿ
                        </button>
                        <button type="button" onclick="if(window.switchProductSeriesTab){window.switchProductSeriesTab('subscription');}else{console.error('switchProductSeriesTabæœªå®šç¾©');}" 
                                id="seriesTabSubscription" 
                                class="px-6 py-3 font-semibold border-b-2 border-transparent text-gray-600 hover:text-teal-600 transition">
                            â™»ï¸ è¨‚é–±ç³»åˆ—
                        </button>
                    </div>
                    
                    <!-- ç›Šæ™ºç©å…·ç³»åˆ— -->
                    <div id="seriesContentToys" class="series-content">
                        <!-- ç³»åˆ—å…§å®¹ç·¨è¼¯ -->
                        <div class="mb-6 bg-orange-50 rounded-xl p-4 border border-orange-200">
                            <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-edit text-orange-600 mr-2"></i>
                                ç›Šæ™ºç©å…·ç³»åˆ—å…§å®¹è¨­å®š
                            </h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">ç³»åˆ—æ¨™é¡Œ</label>
                                    <input type="text" id="toysSeriesTitle" value="ğŸ§  ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">ç³»åˆ—æè¿°</label>
                                    <textarea id="toysSeriesDescription" rows="2" 
                                              class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                              placeholder="è®“æ¯›å­©å‹•è…¦å‹•æ‰‹ï¼Œå»¶ç·©èªçŸ¥é€€åŒ–ï¼">è®“æ¯›å­©å‹•è…¦å‹•æ‰‹ï¼Œå»¶ç·©èªçŸ¥é€€åŒ–ï¼</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">ç ”ç©¶è­‰å¯¦æ–‡å­—</label>
                                    <input type="text" id="toysResearchText" value="ç¶­ä¹Ÿç´å¤§å­¸ç ”ç©¶è­‰å¯¦ï¼šç›Šæ™ºåˆºæ¿€å¯å»¶ç·©å¯µç‰©èªçŸ¥é€€åŒ–" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">é¢¨éšªæç¤ºæ–‡å­—</label>
                                    <input type="text" id="toysRiskText" value="è¶…é 50% é«˜é½¡çŠ¬é¢è‡¨å¤±æ™ºé¢¨éšª" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">CTA æŒ‰éˆ•æ–‡å­—</label>
                                    <input type="text" id="toysCtaText" value="ä¸ç¢ºå®šé¸å“ªæ¬¾ï¼Ÿ2åˆ†é˜æ‰¾å‡ºæœ€é©åˆçš„ç©å…·" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">CTA æŒ‰éˆ•é€£çµ</label>
                                    <input type="text" id="toysCtaLink" value="quiz-toy.html" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç”¢å“é¸æ“‡ -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-700">ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—ç”¢å“</h4>
                                <button type="button" onclick="if(window.openProductSelectorForSeries){window.openProductSelectorForSeries('toys');}else{console.error('openProductSelectorForSeriesæœªå®šç¾©');alert('åŠŸèƒ½è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™å†è©¦');}" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 text-sm">
                                    <i class="fas fa-plus mr-2"></i>é¸æ“‡ç”¢å“
                                </button>
                            </div>
                            <div id="selectedProductsToys" class="space-y-3 min-h-[100px]">
                                <p class="text-gray-500 text-sm text-center py-4">å°šæœªé¸æ“‡ç”¢å“ï¼Œé»æ“Šã€Œé¸æ“‡ç”¢å“ã€æŒ‰éˆ•æ·»åŠ </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ‰‹ä½œé›¶é£Ÿç³»åˆ— -->
                    <div id="seriesContentSnacks" class="series-content hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold text-gray-700">å°ç£å¤œå¸‚æ‰‹ä½œé›¶é£Ÿç”¢å“</h4>
                            <button type="button" onclick="if(window.openProductSelectorForSeries){window.openProductSelectorForSeries('snacks');}else{console.error('openProductSelectorForSeriesæœªå®šç¾©');alert('åŠŸèƒ½è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™å†è©¦');}" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
                                <i class="fas fa-plus mr-2"></i>é¸æ“‡ç”¢å“
                            </button>
                        </div>
                        <div id="selectedProductsSnacks" class="space-y-3 min-h-[100px]">
                            <p class="text-gray-500 text-sm text-center py-4">å°šæœªé¸æ“‡ç”¢å“ï¼Œé»æ“Šã€Œé¸æ“‡ç”¢å“ã€æŒ‰éˆ•æ·»åŠ </p>
                        </div>
                    </div>
                    
                    <!-- è¨‚é–±ç³»åˆ— -->
                    <div id="seriesContentSubscription" class="series-content hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold text-gray-700">ç‡Ÿé¤Šç½è¨‚é–±ç³»åˆ—ç”¢å“</h4>
                            <button type="button" onclick="if(window.openProductSelectorForSeries){window.openProductSelectorForSeries('subscription');}else{console.error('openProductSelectorForSeriesæœªå®šç¾©');alert('åŠŸèƒ½è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™å†è©¦');}" class="px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm">
                                <i class="fas fa-plus mr-2"></i>é¸æ“‡ç”¢å“
                            </button>
                        </div>
                        <div id="selectedProductsSubscription" class="space-y-3 min-h-[100px]">
                            <p class="text-gray-500 text-sm text-center py-4">å°šæœªé¸æ“‡ç”¢å“ï¼Œé»æ“Šã€Œé¸æ“‡ç”¢å“ã€æŒ‰éˆ•æ·»åŠ </p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg mt-4">
                        <p class="text-sm text-gray-700 mb-2">
                            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                            <strong>ä½¿ç”¨èªªæ˜ï¼š</strong>
                        </p>
                        <ul class="text-sm text-gray-600 space-y-1 ml-6 list-disc">
                            <li>ç‚ºæ¯å€‹ç”¢å“ç³»åˆ—é¸æ“‡è¦å±•ç¤ºçš„ç”¢å“</li>
                            <li>ç”¢å“å¿…é ˆåœ¨ <a href="admin-products.html" class="text-blue-600 hover:underline" target="_blank">å¾Œå°ç”¢å“ç®¡ç†</a> ä¸­æ–°å¢</li>
                            <li>é¸æ“‡çš„ç”¢å“æœƒä¾åºé¡¯ç¤ºåœ¨é¦–é å°æ‡‰çš„ç³»åˆ—å€å¡Šä¸­</li>
                            <li>å¯æ‹–æ›³èª¿æ•´é¡¯ç¤ºé †åºï¼Œé—œé–‰é–‹é—œå¯æš«æ™‚éš±è—ç”¢å“</li>
                        </ul>
                    </div>
                </div>
                
                <!-- æ¨£å¼è¨­å®š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-palette text-pink-600 mr-2"></i>
                        æ¨£å¼è¨­å®š
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">æŒ‰éˆ•æ–‡å­—</label>
                            <input type="text" id="buttonText" value="æŸ¥çœ‹æ›´å¤š"
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">æŒ‰éˆ•é€£çµ</label>
                            <input type="text" id="buttonLink" value="/products.html"
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">èƒŒæ™¯é¡è‰²</label>
                            <div class="flex space-x-2">
                                <input type="color" id="bgColor" value="#FFFFFF"
                                       class="w-16 h-12 border-2 border-gray-300 rounded-xl cursor-pointer">
                                <input type="text" id="bgColorText" value="#FFFFFF" readonly
                                       class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl bg-gray-50">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">é–“è·å¤§å°</label>
                            <select id="spacing"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <option value="small">ç·Šæ¹Š</option>
                                <option value="medium" selected>æ¨™æº–</option>
                                <option value="large">å¯¬é¬†</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- SEO è¨­å®š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-search text-orange-600 mr-2"></i>
                        SEO è¨­å®šï¼ˆé¸å¡«ï¼‰
                    </h3>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">å€å¡Š ID</label>
                        <input type="text" id="blockId" value="products-section"
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <p class="text-xs text-gray-500 mt-1">ç”¨æ–¼éŒ¨é»é€£çµï¼Œä¾‹å¦‚ï¼š#products-section</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">å€å¡Š Schema æ¨™è¨˜</label>
                        <select id="schemaType"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <option value="">ç„¡</option>
                            <option value="Product" selected>Productï¼ˆç”¢å“ï¼‰</option>
                            <option value="ItemList">ItemListï¼ˆé …ç›®åˆ—è¡¨ï¼‰</option>
                            <option value="Offer">Offerï¼ˆå„ªæƒ ï¼‰</option>
                        </select>
                    </div>
                </div>
                
                <!-- æŒ‰éˆ•å€ -->
                <div class="flex space-x-3 pt-4 border-t-2 border-gray-200">
                    <button type="button" onclick="closeProductsModal()" 
                            class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 font-bold text-lg">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" 
                            class="flex-1 px-6 py-4 bg-red-600 text-white rounded-xl hover:bg-red-700 font-bold text-lg">
                        <i class="fas fa-save mr-2"></i>å„²å­˜è®Šæ›´
                    </button>
                </div>
                
            </form>
        </div>
    </div>

    <script>
        let currentEditingBlock = null;
        
        // ==================== æ›ç½è¨ˆç•«ç·¨è¼¯å™¨å°ˆç”¨è®Šæ•¸ ====================
        let benefitsData = [
            'æ¯æ¬¡å…Œæ›å¯ç²å¾— NT$ 50 æŠ˜æ‰£åˆ¸',
            'ç´¯è¨ˆ10æ¬¡å‡ç´šç‚ºVIPæœƒå“¡',
            'å…è²»åƒåŠ å·¥ä½œåŠå’Œæ´»å‹•'
        ];

        // å€å¡Šé…ç½®å®šç¾©ï¼ˆé…ç½®é©…å‹•çš„å‹•æ…‹è¡¨å–®ç”Ÿæˆï¼‰
        const SECTION_CONFIGS = {
            hero: {
                name: 'Hero ä¸»è¦–è¦º',
                icon: 'fa-image',
                color: 'blue',
                required: true,
                fields: {
                    title: { type: 'text', label: 'ä¸»æ¨™é¡Œ', default: 'å¾å°ç£å¤œå¸‚åˆ°å¥åº·é¤æ¡Œ' },
                    subtitle: { type: 'textarea', label: 'å‰¯æ¨™é¡Œ', default: 'æ‰‹å·¥è£½ä½œï¼Œå¤©ç„¶ç„¡æ·»åŠ ' },
                    ctaText: { type: 'text', label: 'CTA æŒ‰éˆ•æ–‡å­—', default: 'ç«‹å³é¸è³¼' },
                    ctaLink: { type: 'text', label: 'æŒ‰éˆ•é€£çµ', default: '#products' },
                    bgImage: { type: 'image-upload', label: 'èƒŒæ™¯åœ–ç‰‡', default: '' }
                }
            },
            products: {
                name: 'ç”¢å“ç³»åˆ—',
                icon: 'fa-box',
                color: 'green',
                required: true,
                fields: {
                    title: { type: 'text', label: 'å€å¡Šæ¨™é¡Œ', default: 'ä¸‰å¤§ç”¢å“ç³»åˆ—' },
                    subtitle: { type: 'textarea', label: 'å‰¯æ¨™é¡Œ', default: 'ç²¾å¿ƒæŒ‘é¸çš„ç”¢å“ï¼Œæ»¿è¶³æ¯›å­©å„ç¨®éœ€æ±‚' },
                    displayMode: { 
                        type: 'select', 
                        label: 'é¡¯ç¤ºæ–¹å¼', 
                        options: ['è¼ªæ’­å±•ç¤º', 'ç¶²æ ¼å±•ç¤º', 'åˆ—è¡¨å±•ç¤º'],
                        default: 'è¼ªæ’­å±•ç¤º'
                    }
                }
            },
            quiz: {
                name: 'æ™ºèƒ½æ¸¬é©—',
                icon: 'fa-brain',
                color: 'purple',
                required: false,
                fields: {
                    title: { type: 'text', label: 'å€å¡Šæ¨™é¡Œ', default: 'æ‰¾åˆ°æœ€é©åˆçš„ç”¢å“' },
                    subtitle: { type: 'textarea', label: 'å‰¯æ¨™é¡Œ', default: 'é€éå°ˆæ¥­æ¸¬é©—ï¼Œç‚ºæ‚¨çš„æ¯›å­©æ¨è–¦æœ€é©åˆçš„ç”¢å“' },
                    ctaText: { type: 'text', label: 'æŒ‰éˆ•æ–‡å­—', default: 'ç«‹å³æ¸¬é©—' },
                    layout: {
                        type: 'select',
                        label: 'ä½ˆå±€æ–¹å¼',
                        options: ['ä¸¦æ’é¡¯ç¤º', 'ä¸Šä¸‹æ’åˆ—', 'å¡ç‰‡æ¨£å¼'],
                        default: 'ä¸¦æ’é¡¯ç¤º'
                    }
                }
            },
            subscription: {
                name: 'è¨‚é–±æœå‹™',
                icon: 'fa-sync',
                color: 'orange',
                required: false,
                fields: {
                    title: { type: 'text', label: 'å€å¡Šæ¨™é¡Œ', default: 'è¨‚é–±æœå‹™' },
                    subtitle: { type: 'textarea', label: 'å‰¯æ¨™é¡Œ', default: 'å®šæœŸé…é€æ–°é®®ç‡Ÿé¤Šç½ï¼Œè®“æ¯›å­©å¥åº·æˆé•·' },
                    recommendedPlan: {
                        type: 'select',
                        label: 'æ¨è–¦æ–¹æ¡ˆ',
                        options: ['basic', 'advanced', 'premium'],
                        default: 'advanced'
                    }
                }
            },
            crowdfunding: {
                name: 'é›†è³‡é …ç›®',
                icon: 'fa-rocket',
                color: 'red',
                required: false,
                fields: {
                    projectName: { type: 'text', label: 'é …ç›®åç¨±', default: 'ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—' },
                    projectDescription: { type: 'textarea', label: 'é …ç›®æè¿°', default: 'å‰µæ–°ç›Šæ™ºç©å…·ï¼Œå»¶ç·©æ¯›å­©è€åŒ–ï¼Œè®“ç‰ å€‘æ´»åŠ›åè¶³' },
                    zeczecLink: { type: 'text', label: 'å˜–å˜–å˜–é€£çµ', default: 'https://www.zeczec.com/projects/xxxxx' },
                    coverImage: { type: 'image', label: 'å°é¢åœ–ç‰‡', default: '' }
                }
            },
            'jar-exchange': {
                name: 'æ›ç½è¨ˆç•«',
                icon: 'fa-exchange-alt',
                color: 'teal',
                required: false,
                fields: {
                    title: { type: 'text', label: 'å€å¡Šæ¨™é¡Œ', default: 'æ›ç½è¨ˆç•«', icon: 'fa-heading' },
                    subtitle: { type: 'textarea', label: 'å‰¯æ¨™é¡Œ', default: 'ç’°ä¿æ„›åœ°çƒï¼Œå›é¥‹æ„›æ¯›å­©', icon: 'fa-font' },
                    description: { type: 'textarea', label: 'æè¿°æ–‡å­—', default: 'å°‡ç»ç’ƒç½å¸¶å›åº—å…§ï¼Œäº«å—å°ˆå±¬å„ªæƒ ', icon: 'fa-align-left' },
                    benefits: { type: 'benefits-list', label: 'å„ªæƒ é …ç›®', default: [], icon: 'fa-gift' },
                    image: { type: 'image', label: 'ä¸»åœ–ç‰‡ URL', default: 'https://www.genspark.ai/api/files/s/P5s2ZTfx', icon: 'fa-image' },
                    ctaPrimaryText: { type: 'text', label: 'ä¸»è¦ CTA æ–‡å­—', default: 'äº†è§£æ›´å¤šæ›è³¼è¨ˆç•«' },
                    ctaPrimaryLink: { type: 'text', label: 'ä¸»è¦ CTA é€£çµ', default: '#jar-exchange' },
                    ctaSecondaryText: { type: 'text', label: 'æ¬¡è¦ CTA æ–‡å­—', default: 'æŸ¥çœ‹åˆä½œåº—å®¶' },
                    ctaSecondaryLink: { type: 'text', label: 'æ¬¡è¦ CTA é€£çµ', default: '#stores' }
                }
            },
            about: {
                name: 'é—œæ–¼æˆ‘å€‘',
                icon: 'fa-heart',
                color: 'pink',
                required: false,
                fields: {
                    title: { type: 'text', label: 'ä¸»æ¨™é¡Œ', default: 'é—œæ–¼åŒ å¯µ' },
                    subtitle: { type: 'text', label: 'å‰¯æ¨™é¡Œ', default: 'å¾å°ç£åˆ°ä¸–ç•Œï¼Œç‚ºæ¯›å­©å‰µé€ æ›´å¥½çš„ç”Ÿæ´»' },
                    description: { type: 'textarea', label: 'æè¿°', default: 'æˆ‘å€‘ç›¸ä¿¡ï¼Œæ¯ä¸€éš»æ¯›å­©éƒ½å€¼å¾—æœ€å¥½çš„ç…§é¡§...' },
                    showTeam: { type: 'checkbox', label: 'é¡¯ç¤ºåœ˜éšŠä»‹ç´¹', default: false },
                    showMission: { type: 'checkbox', label: 'é¡¯ç¤ºä½¿å‘½é¡˜æ™¯', default: false },
                    showValues: { type: 'checkbox', label: 'é¡¯ç¤ºæ ¸å¿ƒåƒ¹å€¼', default: false }
                }
            }
        };

        // å‰µå»ºè¡¨å–®æ¬„ä½ï¼ˆå‹•æ…‹ç”Ÿæˆï¼‰
        function createFieldHTML(fieldName, config, value, blockId) {
            let inputHTML = '';
            const iconHTML = config.icon ? `<i class="fas ${config.icon} mr-2 text-red-500"></i>` : '';
            
            switch(config.type) {
                case 'text':
                    inputHTML = `
                        <input type="text" id="field-${blockId}-${fieldName}" value="${(value || '').replace(/"/g, '&quot;')}" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                    `;
                    break;
                case 'textarea':
                    inputHTML = `
                        <textarea id="field-${blockId}-${fieldName}" rows="3" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">${(value || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    `;
                    break;
                case 'number':
                    inputHTML = `
                        <input type="number" id="field-${blockId}-${fieldName}" value="${value || ''}" 
                               ${config.min !== undefined ? `min="${config.min}"` : ''} 
                               ${config.max !== undefined ? `max="${config.max}"` : ''}
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                    `;
                    break;
                case 'checkbox':
                    inputHTML = `
                        <input type="checkbox" id="field-${blockId}-${fieldName}" ${value ? 'checked' : ''} 
                               class="w-5 h-5 text-red-500 rounded focus:ring-2 focus:ring-red-400">
                    `;
                    break;
                case 'select':
                    inputHTML = `
                        <select id="field-${blockId}-${fieldName}" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                    `;
                    config.options.forEach(option => {
                        inputHTML += `<option value="${option}" ${option === value ? 'selected' : ''}>${option}</option>`;
                    });
                    inputHTML += '</select>';
                    break;
                case 'image':
                    inputHTML = `
                        <div class="space-y-2">
                            <input type="url" id="field-${blockId}-${fieldName}" value="${(value || '').replace(/"/g, '&quot;')}" placeholder="åœ–ç‰‡ URL"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                            <input type="file" accept="image/*" onchange="handleImageUpload(this, '${blockId}-${fieldName}')"
                                   class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700">
                            ${value ? `<img src="${value}" class="mt-2 w-32 h-32 object-cover rounded-lg" onerror="this.style.display='none'">` : ''}
                        </div>
                    `;
                    break;
                case 'image-upload':
                    // Hero å€å¡Šçš„ç‰¹æ®Šåœ–ç‰‡ä¸Šå‚³è™•ç†
                    inputHTML = `
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸Šå‚³åœ–ç‰‡</label>
                            <div id="heroImageUploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-400 transition cursor-pointer bg-gray-50 hover:bg-gray-100" 
                                 onclick="document.getElementById('editHeroBgFile').click()"
                                 ondrop="handleHeroImageDrop(event)"
                                 ondragover="handleHeroImageDragOver(event)"
                                 ondragleave="handleHeroImageDragLeave(event)">
                                <input type="file" id="editHeroBgFile" accept="image/*" class="hidden" onchange="handleHeroImageUpload(event)">
                                <div id="heroImagePreviewArea">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm font-medium text-gray-700 mb-1">é»æ“Šæˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤è™•ä¸Šå‚³</p>
                                    <p class="text-xs text-gray-500">å»ºè­°å°ºå¯¸: 1920x1080pxï¼Œæœ€å¤§ 5MB</p>
                                </div>
                                <div id="heroImagePreviewContainer" class="hidden">
                                    <img id="heroImagePreview" class="max-w-full max-h-64 mx-auto rounded-lg border border-gray-200 mt-2" />
                                    <button type="button" onclick="event.stopPropagation(); clearHeroImagePreview();" class="mt-3 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm">
                                        <i class="fas fa-times mr-1"></i>æ¸…é™¤åœ–ç‰‡
                                    </button>
                                </div>
                                <div id="heroImageDragOverlay" class="hidden absolute inset-0 bg-blue-500 bg-opacity-20 border-4 border-dashed border-blue-500 rounded-lg flex items-center justify-center">
                                    <div class="text-center text-blue-600">
                                        <i class="fas fa-cloud-upload-alt text-5xl mb-3"></i>
                                        <p class="text-lg font-bold">æ”¾é–‹ä»¥ä¸Šå‚³åœ–ç‰‡</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æˆ–è¼¸å…¥åœ–ç‰‡ç¶²å€</label>
                            <input type="text" id="field-${blockId}-${fieldName}" value="${(value || '').replace(/"/g, '&quot;')}" placeholder="https://example.com/image.jpg" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                    `;
                    break;
                case 'benefits-list':
                    inputHTML = `
                        <div>
                            <div id="benefitsList" class="space-y-2 mb-3"></div>
                            <button type="button" onclick="addBenefitItem()" 
                                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm">
                                <i class="fas fa-plus mr-2"></i>æ–°å¢å„ªæƒ é …ç›®
                            </button>
                        </div>
                    `;
                    break;
            }
            
            return `
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        ${iconHTML}${config.label}
                    </label>
                    ${inputHTML}
                </div>
            `;
        }
        
        // ç·¨è¼¯å€å¡Š
        function editBlock(blockId) {
            // å¦‚æœæ˜¯ç”¢å“ç³»åˆ—ï¼Œæ‰“é–‹å°ˆç”¨ç·¨è¼¯å™¨
            if (blockId === 'products') {
                openProductsModal();
                return;
            }
            
            currentEditingBlock = blockId;
            const modal = document.getElementById('editBlockModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            // è¼‰å…¥ç•¶å‰é…ç½®
            let currentConfig = null;
            if (window.HomepageConfig) {
                const config = window.HomepageConfig.getHomepageConfig();
                currentConfig = config.sections.find(s => s.id === blockId);
            }
            
            // ä½¿ç”¨é…ç½®é©…å‹•çš„è¡¨å–®ç”Ÿæˆ
            const sectionConfig = SECTION_CONFIGS[blockId];
            if (sectionConfig) {
                // å‹•æ…‹ç”Ÿæˆè¡¨å–®
                let html = '<div class="space-y-6">';
                
                Object.entries(sectionConfig.fields).forEach(([fieldName, fieldConfig]) => {
                    let value = currentConfig?.content?.[fieldName];
                    
                    // è™•ç†ç‰¹æ®Šæƒ…æ³
                    if (fieldName === 'benefits' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.benefits || benefitsData;
                        if (Array.isArray(value)) {
                            benefitsData = [...value];
                        }
                    } else if (fieldName === 'ctaPrimaryText' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.ctaPrimary?.text || currentConfig?.content?.cta1Text || fieldConfig.default;
                    } else if (fieldName === 'ctaPrimaryLink' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.ctaPrimary?.link || fieldConfig.default;
                    } else if (fieldName === 'ctaSecondaryText' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.ctaSecondary?.text || currentConfig?.content?.cta2Text || fieldConfig.default;
                    } else if (fieldName === 'ctaSecondaryLink' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.ctaSecondary?.link || fieldConfig.default;
                    } else if (fieldName === 'image' && blockId === 'jar-exchange') {
                        value = value || currentConfig?.content?.image || currentConfig?.content?.mainImage || fieldConfig.default;
                    } else if (fieldName === 'bgImage' && blockId === 'hero') {
                        // Hero å€å¡Šçš„ bgImage éœ€è¦ç‰¹æ®Šè™•ç†
                        value = value || currentConfig?.content?.bgImage || fieldConfig.default;
                    } else {
                        value = value ?? fieldConfig.default;
                    }
                    
                    html += createFieldHTML(fieldName, fieldConfig, value, blockId);
                });
                
                html += '</div>';
                content.innerHTML = html;
                
                // æ›´æ–°æ¨™é¡Œ
                const blockTitles = {
                    'hero': 'Hero ä¸»è¦–è¦º',
                    'products': 'ç”¢å“ç³»åˆ—',
                    'quiz': 'æ™ºèƒ½æ¸¬é©—',
                    'subscription': 'è¨‚é–±æœå‹™',
                    'crowdfunding': 'é›†è³‡é …ç›®',
                    'jar-exchange': 'æ›ç½è¨ˆç•«',
                    'about': 'é—œæ–¼æˆ‘å€‘'
                };
                title.textContent = `ç·¨è¼¯ - ${blockTitles[blockId] || blockId}å€å¡Š`;
                
                // å¦‚æœæ˜¯ Hero å€å¡Šï¼Œé¡¯ç¤ºç¾æœ‰åœ–ç‰‡é è¦½
                if (blockId === 'hero' && currentConfig?.content?.bgImage) {
                    setTimeout(() => {
                        showHeroImagePreview(currentConfig.content.bgImage);
                    }, 100);
                }
                
                // å¦‚æœæ˜¯æ›ç½è¨ˆç•«ï¼Œåˆå§‹åŒ–å„ªæƒ é …ç›®åˆ—è¡¨
                if (blockId === 'jar-exchange') {
                    setTimeout(() => {
                        renderBenefitsList();
                    }, 100);
                }
                
                modal.style.display = 'flex';
                return;
            }
            
            // å¦‚æœæ²’æœ‰é…ç½®ï¼Œä½¿ç”¨èˆŠçš„ç¡¬ç·¨ç¢¼è¡¨å–®ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
            const editForms = {
                hero: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸»æ¨™é¡Œ</label>
                            <input type="text" id="editHeroTitle" value="${currentConfig?.content?.title || 'å¾å°ç£å¤œå¸‚åˆ°å¥åº·é¤æ¡Œ'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å‰¯æ¨™é¡Œ</label>
                            <input type="text" id="editHeroSubtitle" value="${currentConfig?.content?.subtitle || 'æ‰‹å·¥è£½ä½œï¼Œå¤©ç„¶ç„¡æ·»åŠ '}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CTA æŒ‰éˆ•æ–‡å­—</label>
                            <input type="text" id="editHeroCtaText" value="${currentConfig?.content?.ctaText || 'ç«‹å³é¸è³¼'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æŒ‰éˆ•é€£çµ</label>
                            <input type="text" id="editHeroCtaLink" value="${currentConfig?.content?.ctaLink || '#products'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">èƒŒæ™¯åœ–ç‰‡</label>
                            
                            <!-- æ–¹å¼ 1: ä¸Šå‚³åœ–ç‰‡ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰ -->
                            <div class="mb-3">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¸Šå‚³åœ–ç‰‡</label>
                                <div id="heroImageUploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-400 transition cursor-pointer bg-gray-50 hover:bg-gray-100" 
                                     onclick="document.getElementById('editHeroBgFile').click()"
                                     ondrop="handleHeroImageDrop(event)"
                                     ondragover="handleHeroImageDragOver(event)"
                                     ondragleave="handleHeroImageDragLeave(event)">
                                    <input type="file" id="editHeroBgFile" accept="image/*" class="hidden" onchange="handleHeroImageUpload(event)">
                                    <div id="heroImagePreviewArea">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                        <p class="text-sm font-medium text-gray-700 mb-1">é»æ“Šæˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤è™•ä¸Šå‚³</p>
                                        <p class="text-xs text-gray-500">å»ºè­°å°ºå¯¸: 1920x1080pxï¼Œæœ€å¤§ 5MB</p>
                                        <p class="text-xs text-gray-400 mt-2">æ”¯æ´ JPG, PNG, WebP, GIF</p>
                                    </div>
                                    <div id="heroImagePreviewContainer" class="hidden">
                                        <img id="heroImagePreview" class="max-w-full max-h-64 mx-auto rounded-lg border border-gray-200 mt-2" />
                                        <button type="button" onclick="event.stopPropagation(); clearHeroImagePreview();" class="mt-3 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm">
                                            <i class="fas fa-times mr-1"></i>æ¸…é™¤åœ–ç‰‡
                                        </button>
                                    </div>
                                    <div id="heroImageDragOverlay" class="hidden absolute inset-0 bg-blue-500 bg-opacity-20 border-4 border-dashed border-blue-500 rounded-lg flex items-center justify-center">
                                        <div class="text-center text-blue-600">
                                            <i class="fas fa-cloud-upload-alt text-5xl mb-3"></i>
                                            <p class="text-lg font-bold">æ”¾é–‹ä»¥ä¸Šå‚³åœ–ç‰‡</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ–¹å¼ 2: è¼¸å…¥åœ–ç‰‡ URL -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æˆ–è¼¸å…¥åœ–ç‰‡ç¶²å€</label>
                                <input type="text" id="editHeroBgImage" value="${currentConfig?.content?.bgImage || ''}" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                <p class="text-xs text-gray-500 mt-1">æ”¯æ´ JPG, PNG, WebP æ ¼å¼</p>
                            </div>
                        </div>
                    </div>
                `,
                products: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å€å¡Šæ¨™é¡Œ</label>
                            <input type="text" value="ä¸‰å¤§ç”¢å“ç³»åˆ—" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºç”¢å“ç³»åˆ—</label>
                            <div class="space-y-2">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500">
                                    <span>å°ç£å¤œå¸‚æ‰‹ä½œé›¶é£Ÿ</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500">
                                    <span>ç‡Ÿé¤Šç½è¨‚é–±ç³»åˆ—</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500">
                                    <span>ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºæ–¹å¼</label>
                            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                <option value="carousel">è¼ªæ’­å±•ç¤º</option>
                                <option value="grid">ç¶²æ ¼å±•ç¤º</option>
                                <option value="list">åˆ—è¡¨å±•ç¤º</option>
                            </select>
                        </div>
                    </div>
                `,
                quiz: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å€å¡Šæ¨™é¡Œ</label>
                            <input type="text" value="æ‰¾åˆ°æœ€é©åˆçš„ç”¢å“" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºæ¸¬é©—</label>
                            <div class="space-y-2">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500">
                                    <span>ç‡Ÿé¤Šæ¸¬é©—ï¼ˆé›¶é£Ÿæ¨è–¦ï¼‰</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500">
                                    <span>ç©å…·æ¸¬é©—ï¼ˆæ™ºåŠ›è©•ä¼°ï¼‰</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æŒ‰éˆ•æ–‡å­—</label>
                            <input type="text" value="ç«‹å³æ¸¬é©—" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                    </div>
                `,
                subscription: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å€å¡Šæ¨™é¡Œ</label>
                            <input type="text" value="è¨‚é–±æœå‹™" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å‰¯æ¨™é¡Œ</label>
                            <textarea rows="2" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">å®šæœŸé…é€æ–°é®®ç‡Ÿé¤Šç½ï¼Œè®“æ¯›å­©å¥åº·æˆé•·</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¨è–¦æ–¹æ¡ˆ</label>
                            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                <option value="basic">åŸºç¤æ–¹æ¡ˆ</option>
                                <option value="advanced" selected>é€²éšæ–¹æ¡ˆï¼ˆæ¨è–¦ï¼‰</option>
                                <option value="premium">è±ªè¯æ–¹æ¡ˆ</option>
                            </select>
                        </div>
                    </div>
                `,
                crowdfunding: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é …ç›®åç¨±</label>
                            <input type="text" id="editCrowdfundingProjectName" value="${currentConfig?.content?.projectName || 'ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é …ç›®æè¿°</label>
                            <textarea id="editCrowdfundingDescription" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">${currentConfig?.content?.projectDescription || 'å‰µæ–°ç›Šæ™ºç©å…·ï¼Œå»¶ç·©æ¯›å­©è€åŒ–ï¼Œè®“ç‰ å€‘æ´»åŠ›åè¶³'}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å˜–å˜–å˜–é€£çµ</label>
                            <input type="url" id="editCrowdfundingLink" value="${currentConfig?.content?.zeczecLink || 'https://www.zeczec.com/projects/xxxxx'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å°é¢åœ–ç‰‡ URL</label>
                            <input type="text" id="editCrowdfundingImage" value="${currentConfig?.content?.coverImage || ''}" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                    </div>
                `,
                'jar-exchange': `
                    <div class="space-y-6">
                        <!-- å€å¡Šæ¨™é¡Œ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-heading mr-2 text-red-500"></i>å€å¡Šæ¨™é¡Œ
                            </label>
                            <input 
                                type="text" 
                                id="jarExchangeTitle" 
                                value="${currentConfig?.content?.title || 'æ›ç½è¨ˆç•«'}" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                            >
                        </div>

                        <!-- å‰¯æ¨™é¡Œ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-font mr-2 text-red-500"></i>å‰¯æ¨™é¡Œ
                            </label>
                            <input 
                                type="text" 
                                id="jarExchangeSubtitle" 
                                value="${currentConfig?.content?.subtitle || 'ç’°ä¿æ„›åœ°çƒï¼Œå›é¥‹æ„›æ¯›å­©'}" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                            >
                        </div>

                        <!-- æè¿°æ–‡å­— -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-align-left mr-2 text-red-500"></i>æè¿°æ–‡å­—
                            </label>
                            <textarea 
                                id="jarExchangeDescription" 
                                rows="3" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                            >${currentConfig?.content?.description || 'å°‡ç»ç’ƒç½å¸¶å›åº—å…§ï¼Œäº«å—å°ˆå±¬å„ªæƒ '}</textarea>
                        </div>

                        <!-- å„ªæƒ é …ç›®åˆ—è¡¨ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-gift mr-2 text-red-500"></i>å„ªæƒ é …ç›®
                            </label>
                            <div id="benefitsList" class="space-y-2 mb-3"></div>
                            <button 
                                type="button" 
                                onclick="addBenefitItem()" 
                                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm"
                            >
                                <i class="fas fa-plus mr-2"></i>æ–°å¢å„ªæƒ é …ç›®
                                        </button>
                                    </div>

                        <!-- ä¸»åœ–ç‰‡ URL -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-image mr-2 text-red-500"></i>ä¸»åœ–ç‰‡ URL
                            </label>
                            <input 
                                type="url" 
                                id="jarExchangeImage" 
                                value="${currentConfig?.content?.image || currentConfig?.content?.mainImage || 'https://www.genspark.ai/api/files/s/P5s2ZTfx'}" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                            >
                            </div>

                        <!-- ä¸»è¦ CTA -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¸»è¦ CTA æ–‡å­—</label>
                                <input 
                                    type="text" 
                                    id="jarExchangeCtaPrimary" 
                                    value="${currentConfig?.content?.ctaPrimary?.text || currentConfig?.content?.cta1Text || 'äº†è§£æ›´å¤šæ›è³¼è¨ˆç•«'}" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                                >
                        </div>
                        <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¸»è¦ CTA é€£çµ</label>
                                <input 
                                    type="text" 
                                    id="jarExchangeCtaPrimaryLink" 
                                    value="${currentConfig?.content?.ctaPrimary?.link || '#jar-exchange'}" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                                >
                        </div>
                        </div>

                        <!-- æ¬¡è¦ CTA -->
                        <div class="grid grid-cols-2 gap-4">
                        <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¬¡è¦ CTA æ–‡å­—</label>
                                <input 
                                    type="text" 
                                    id="jarExchangeCtaSecondary" 
                                    value="${currentConfig?.content?.ctaSecondary?.text || currentConfig?.content?.cta2Text || 'æŸ¥çœ‹åˆä½œåº—å®¶'}" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                                >
                        </div>
                        <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¬¡è¦ CTA é€£çµ</label>
                                <input 
                                    type="text" 
                                    id="jarExchangeCtaSecondaryLink" 
                                    value="${currentConfig?.content?.ctaSecondary?.link || '#stores'}" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                                >
                            </div>
                        </div>
                    </div>
                `,
                about: `
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸»æ¨™é¡Œ</label>
                            <input type="text" id="editAboutTitle" value="${currentConfig?.content?.title || 'é—œæ–¼åŒ å¯µ'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å‰¯æ¨™é¡Œ</label>
                            <input type="text" id="editAboutSubtitle" value="${currentConfig?.content?.subtitle || 'å¾å°ç£åˆ°ä¸–ç•Œï¼Œç‚ºæ¯›å­©å‰µé€ æ›´å¥½çš„ç”Ÿæ´»'}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æè¿°</label>
                            <textarea id="editAboutDescription" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">${currentConfig?.content?.description || 'æˆ‘å€‘ç›¸ä¿¡ï¼Œæ¯ä¸€éš»æ¯›å­©éƒ½å€¼å¾—æœ€å¥½çš„ç…§é¡§...'}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºé¸é …</label>
                            <div class="space-y-2">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="editAboutShowTeam" ${currentConfig?.content?.showTeam ? 'checked' : ''} class="w-4 h-4 text-red-500">
                                    <span>é¡¯ç¤ºåœ˜éšŠä»‹ç´¹</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="editAboutShowMission" ${currentConfig?.content?.showMission ? 'checked' : ''} class="w-4 h-4 text-red-500">
                                    <span>é¡¯ç¤ºä½¿å‘½é¡˜æ™¯</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="editAboutShowValues" ${currentConfig?.content?.showValues ? 'checked' : ''} class="w-4 h-4 text-red-500">
                                    <span>é¡¯ç¤ºæ ¸å¿ƒåƒ¹å€¼</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `
            };
            
            // æ›´æ–°æ¨™é¡Œ
            const blockTitles = {
                'hero': 'Hero ä¸»è¦–è¦º',
                'products': 'ç”¢å“ç³»åˆ—',
                'quiz': 'æ™ºèƒ½æ¸¬é©—',
                'subscription': 'è¨‚é–±æœå‹™',
                'crowdfunding': 'é›†è³‡é …ç›®',
                'jar-exchange': 'æ›ç½è¨ˆç•«',
                'about': 'é—œæ–¼æˆ‘å€‘'
            };
            title.textContent = `ç·¨è¼¯ - ${blockTitles[blockId] || blockId}å€å¡Š`;
            content.innerHTML = editForms[blockId] || '<p class="text-gray-600">è¼‰å…¥ç·¨è¼¯è¡¨å–®...</p>';
            
            // å¦‚æœæ˜¯ Hero å€å¡Šï¼Œé¡¯ç¤ºç¾æœ‰åœ–ç‰‡é è¦½
            if (blockId === 'hero' && currentConfig?.content?.bgImage) {
                setTimeout(() => {
                    showHeroImagePreview(currentConfig.content.bgImage);
                }, 100);
            }
            
            // å¦‚æœæ˜¯æ›ç½è¨ˆç•«ï¼Œåˆå§‹åŒ–åˆ—è¡¨
            if (blockId === 'jar-exchange') {
                setTimeout(() => {
                    const config = window.HomepageConfig ? window.HomepageConfig.getHomepageConfig() : null;
                    const section = config ? config.sections.find(s => s.id === 'jar-exchange') : null;
                    if (section && section.content && section.content.benefits) {
                        benefitsData = [...section.content.benefits];
                    } else {
                        benefitsData = [
                            'æ¯æ¬¡å…Œæ›å¯ç²å¾— NT$ 50 æŠ˜æ‰£åˆ¸',
                            'ç´¯è¨ˆ10æ¬¡å‡ç´šç‚ºVIPæœƒå“¡',
                            'å…è²»åƒåŠ å·¥ä½œåŠå’Œæ´»å‹•'
                        ];
                    }
                    renderBenefitsList();
                }, 100);
            }
            
            modal.style.display = 'flex';
        }
        
        function closeEditModal() {
            document.getElementById('editBlockModal').style.display = 'none';
            currentEditingBlock = null;
        }
        
        function saveBlockChanges() {
            if (!currentEditingBlock) {
                alert('âŒ æ²’æœ‰æ­£åœ¨ç·¨è¼¯çš„å€å¡Š');
                return;
            }
            
            try {
                // æª¢æŸ¥æ˜¯å¦ä½¿ç”¨æ–°çš„é…ç½®é©…å‹•è¡¨å–®
                const sectionConfig = SECTION_CONFIGS[currentEditingBlock];
                if (sectionConfig) {
                    const newContent = {};
                    
                    // ç‰¹æ®Šè™•ç†æ›ç½è¨ˆç•«
                    if (currentEditingBlock === 'jar-exchange') {
                        newContent.title = document.getElementById('field-jar-exchange-title')?.value || 
                                          document.getElementById('jarExchangeTitle')?.value || '';
                        newContent.subtitle = document.getElementById('field-jar-exchange-subtitle')?.value || 
                                             document.getElementById('jarExchangeSubtitle')?.value || '';
                        newContent.description = document.getElementById('field-jar-exchange-description')?.value || 
                                                document.getElementById('jarExchangeDescription')?.value || '';
                        newContent.benefits = [...benefitsData];
                        newContent.image = document.getElementById('field-jar-exchange-image')?.value || 
                                          document.getElementById('jarExchangeImage')?.value || '';
                        newContent.ctaPrimary = {
                            text: document.getElementById('field-jar-exchange-ctaPrimaryText')?.value || 
                                  document.getElementById('jarExchangeCtaPrimary')?.value || '',
                            link: document.getElementById('field-jar-exchange-ctaPrimaryLink')?.value || 
                                  document.getElementById('jarExchangeCtaPrimaryLink')?.value || ''
                        };
                        newContent.ctaSecondary = {
                            text: document.getElementById('field-jar-exchange-ctaSecondaryText')?.value || 
                                  document.getElementById('jarExchangeCtaSecondary')?.value || '',
                            link: document.getElementById('field-jar-exchange-ctaSecondaryLink')?.value || 
                                  document.getElementById('jarExchangeCtaSecondaryLink')?.value || ''
                        };
                        
                        if (window.HomepageConfig) {
                            const success = window.HomepageConfig.updateSectionConfig('jar-exchange', { content: newContent });
                            if (success) {
                                console.log('âœ… å·²æ›´æ–°æ›ç½è¨ˆç•«é…ç½®:', newContent);
                                window.HomepageConfig.publishHomepageChanges();
                            }
                        }
                        
                        alert('âœ… æ›ç½è¨ˆç•«å€å¡Šè®Šæ›´å·²å„²å­˜ä¸¦ç™¼å¸ƒï¼\n\nè®Šæ›´å·²ç«‹å³ç”Ÿæ•ˆï¼Œè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚');
                        closeEditModal();
                        
                        if (window.HomepageConfig) {
                            const config = window.HomepageConfig.getHomepageConfig();
                            renderBlocksFromConfig(config);
                        }
                        return;
                    }
                    
                    // è™•ç†å…¶ä»–ä½¿ç”¨æ–°é…ç½®çš„å€å¡Š
                    Object.keys(sectionConfig.fields).forEach(fieldName => {
                        const fieldId = `field-${currentEditingBlock}-${fieldName}`;
                        const input = document.getElementById(fieldId);
                        if (!input) return;
                        
                        if (input.type === 'checkbox') {
                            newContent[fieldName] = input.checked;
                        } else if (input.type === 'number') {
                            newContent[fieldName] = parseFloat(input.value) || 0;
                        } else {
                            newContent[fieldName] = input.value;
                        }
                    });
                    
                    // ç‰¹æ®Šè™•ç† Hero å€å¡Šçš„åœ–ç‰‡ä¸Šå‚³
                    if (currentEditingBlock === 'hero') {
                        const uploadedImage = document.getElementById('heroImagePreview')?.src;
                        if (uploadedImage && uploadedImage.startsWith('data:image') && !uploadedImage.includes('placeholder')) {
                            newContent.bgImage = uploadedImage;
                        } else {
                            const bgImageInput = document.getElementById('field-hero-bgImage');
                            if (bgImageInput) {
                                newContent.bgImage = bgImageInput.value;
                            }
                        }
                    }
                    
                    // ä¿å­˜é…ç½®
                    if (window.HomepageConfig) {
                        const success = window.HomepageConfig.updateSectionConfig(currentEditingBlock, { content: newContent });
                        if (success) {
                            console.log(`âœ… å·²æ›´æ–° ${currentEditingBlock} é…ç½®:`, newContent);
                            window.HomepageConfig.publishHomepageChanges();
                        }
                    }
                    
                    alert(`âœ… ${currentEditingBlock} å€å¡Šè®Šæ›´å·²å„²å­˜ä¸¦ç™¼å¸ƒï¼\n\nè®Šæ›´å·²ç«‹å³ç”Ÿæ•ˆï¼Œè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚`);
                    closeEditModal();
                    
                    if (window.HomepageConfig) {
                        const config = window.HomepageConfig.getHomepageConfig();
                        renderBlocksFromConfig(config);
                    }
                    return;
                }
                
                // å‘å¾Œå…¼å®¹ï¼šè™•ç†èˆŠçš„è¡¨å–®çµæ§‹
                if (currentEditingBlock === 'hero') {
                    const title = document.getElementById('editHeroTitle')?.value || '';
                    const subtitle = document.getElementById('editHeroSubtitle')?.value || '';
                    const ctaText = document.getElementById('editHeroCtaText')?.value || '';
                    const ctaLink = document.getElementById('editHeroCtaLink')?.value || '';
                    
                    // å„ªå…ˆä½¿ç”¨ä¸Šå‚³çš„åœ–ç‰‡ï¼ˆbase64ï¼‰ï¼Œå¦å‰‡ä½¿ç”¨ URL
                    let bgImage = '';
                    const uploadedImage = document.getElementById('heroImagePreview')?.src;
                    if (uploadedImage && uploadedImage.startsWith('data:image') && !uploadedImage.includes('placeholder')) {
                        bgImage = uploadedImage; // ä½¿ç”¨ base64
                        console.log('âœ… ä½¿ç”¨ä¸Šå‚³çš„åœ–ç‰‡ï¼ˆBase64ï¼‰');
                    } else {
                        bgImage = document.getElementById('editHeroBgImage')?.value || '';
                        if (bgImage) {
                            console.log('âœ… ä½¿ç”¨åœ–ç‰‡ URL');
                        }
                    }
                    
                    // æ›´æ–°é…ç½®
                    if (window.HomepageConfig) {
                        const heroContent = {
                            title: title,
                            subtitle: subtitle,
                            ctaText: ctaText,
                            ctaLink: ctaLink,
                            bgImage: bgImage
                        };
                        
                        // æ›´æ–° homepageConfig
                        const success = window.HomepageConfig.updateSectionConfig('hero', {
                            content: heroContent
                        });
                        
                        if (success) {
                            console.log('âœ… å·²æ›´æ–° homepageConfig:', heroContent);
                            
                            // åŒæ™‚ä¿å­˜åˆ° heroContentï¼ˆå‚™ä»½ï¼‰
                            localStorage.setItem('heroContent', JSON.stringify(heroContent));
                            console.log('âœ… å·²ä¿å­˜ heroContent å‚™ä»½');
                            
                            // ç«‹å³ç™¼å¸ƒ
                            window.HomepageConfig.publishHomepageChanges();
                            console.log('âœ… å·²ç™¼å¸ƒé…ç½®');
                            
                            // è§¸ç™¼æ›´æ–°äº‹ä»¶
                            window.dispatchEvent(new CustomEvent('homepageConfigUpdated', { 
                                detail: window.HomepageConfig.getHomepageConfig() 
                            }));
                            console.log('âœ… å·²è§¸ç™¼æ›´æ–°äº‹ä»¶');
                        } else {
                            console.error('âŒ æ›´æ–° homepageConfig å¤±æ•—');
                        }
                        
                        // æ›´æ–°é¦–é å¯¦éš›å…§å®¹
                        updateHeroContent(title, subtitle, ctaText, ctaLink, bgImage);
                    }
                } else if (currentEditingBlock === 'products') {
                    // ç”¢å“ç³»åˆ—ç·¨è¼¯é‚è¼¯å·²åœ¨å°ˆç”¨ Modal ä¸­è™•ç†
                    console.log('ç”¢å“ç³»åˆ—ç·¨è¼¯åŠŸèƒ½å·²åœ¨å°ˆç”¨ç·¨è¼¯å™¨ä¸­è™•ç†');
                } else if (currentEditingBlock === 'quiz') {
                    // æ¸¬é©—ç·¨è¼¯é‚è¼¯ï¼ˆå¾…å¯¦ç¾ï¼‰
                    console.log('æ¸¬é©—ç·¨è¼¯åŠŸèƒ½å¾…å¯¦ç¾');
                    alert('âš ï¸ æ¸¬é©—ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼');
                } else if (currentEditingBlock === 'subscription') {
                    // è¨‚é–±ç·¨è¼¯é‚è¼¯ï¼ˆå¾…å¯¦ç¾ï¼‰
                    console.log('è¨‚é–±ç·¨è¼¯åŠŸèƒ½å¾…å¯¦ç¾');
                    alert('âš ï¸ è¨‚é–±ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼');
                } else if (currentEditingBlock === 'crowdfunding') {
                    // é›†è³‡é …ç›®ç·¨è¼¯é‚è¼¯
                    const projectName = document.getElementById('editCrowdfundingProjectName')?.value || '';
                    const projectDescription = document.getElementById('editCrowdfundingDescription')?.value || '';
                    const zeczecLink = document.getElementById('editCrowdfundingLink')?.value || '';
                    const coverImage = document.getElementById('editCrowdfundingImage')?.value || '';
                    
                    const crowdfundingContent = {
                        projectName: projectName,
                        projectDescription: projectDescription,
                        zeczecLink: zeczecLink,
                        coverImage: coverImage
                    };
                    
                    if (window.HomepageConfig) {
                        const success = window.HomepageConfig.updateSectionConfig('crowdfunding', {
                            content: crowdfundingContent
                        });
                        if (success) {
                            console.log('âœ… å·²æ›´æ–°é›†è³‡é …ç›®é…ç½®:', crowdfundingContent);
                        }
                    }
                } else if (currentEditingBlock === 'jar-exchange') {
                    // æ›ç½è¨ˆç•«ç·¨è¼¯é‚è¼¯ - ä½¿ç”¨æ–°çš„ä¿å­˜å‡½æ•¸
                    saveJarExchangeBlock();
                    return; // å‡½æ•¸å…§éƒ¨å·²ç¶“è™•ç†äº†é—œé–‰å’Œæç¤º
                } else if (currentEditingBlock === 'about') {
                    // é—œæ–¼æˆ‘å€‘ç·¨è¼¯é‚è¼¯
                    const title = document.getElementById('editAboutTitle')?.value || '';
                    const subtitle = document.getElementById('editAboutSubtitle')?.value || '';
                    const description = document.getElementById('editAboutDescription')?.value || '';
                    const showTeam = document.getElementById('editAboutShowTeam')?.checked || false;
                    const showMission = document.getElementById('editAboutShowMission')?.checked || false;
                    const showValues = document.getElementById('editAboutShowValues')?.checked || false;
                    
                    const aboutContent = {
                        title: title,
                        subtitle: subtitle,
                        description: description,
                        showTeam: showTeam,
                        showMission: showMission,
                        showValues: showValues
                    };
                    
                    if (window.HomepageConfig) {
                        const success = window.HomepageConfig.updateSectionConfig('about', {
                            content: aboutContent
                        });
                        if (success) {
                            console.log('âœ… å·²æ›´æ–°é—œæ–¼æˆ‘å€‘é…ç½®:', aboutContent);
                        }
                    }
                }
                
                // ç«‹å³ç™¼å¸ƒï¼ˆä¸éœ€è¦å†é»æ“Šç™¼å¸ƒæŒ‰éˆ•ï¼‰
                if (window.HomepageConfig) {
                    window.HomepageConfig.publishHomepageChanges();
                    console.log('âœ… é…ç½®å·²è‡ªå‹•ç™¼å¸ƒ');
                }
                
                alert(`âœ… ${currentEditingBlock} å€å¡Šè®Šæ›´å·²å„²å­˜ä¸¦ç™¼å¸ƒï¼\n\nè®Šæ›´å·²ç«‹å³ç”Ÿæ•ˆï¼Œè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚`);
                closeEditModal();
                
                // æ›´æ–°é¡¯ç¤º
                if (window.HomepageConfig) {
                    const config = window.HomepageConfig.getHomepageConfig();
                    renderBlocksFromConfig(config);
                }
            } catch (error) {
                console.error('å„²å­˜å¤±æ•—:', error);
                alert('âŒ å„²å­˜å¤±æ•—: ' + error.message);
            }
        }
        
        // æ›´æ–°é¦–é  Hero å…§å®¹
        function updateHeroContent(title, subtitle, ctaText, ctaLink, bgImage) {
            // æ›´æ–° localStorage ä¸­çš„é…ç½®
            const heroConfig = {
                title: title,
                subtitle: subtitle,
                ctaText: ctaText,
                ctaLink: ctaLink,
                bgImage: bgImage
            };
            
            localStorage.setItem('heroContent', JSON.stringify(heroConfig));
            
            // å¦‚æœé¦–é å·²æ‰“é–‹ï¼Œæ›´æ–°é¦–é å…§å®¹
            // é€™æœƒåœ¨é¦–é è¼‰å…¥æ™‚è‡ªå‹•æ‡‰ç”¨
        }
        
        function addNewBlock() {
            alert('æ–°å¢å€å¡ŠåŠŸèƒ½\n\nå¯é¸æ“‡çš„å€å¡Šé¡å‹ï¼š\nâ€¢ æ–‡å­—å€å¡Š\nâ€¢ åœ–ç‰‡è¼ªæ’­\nâ€¢ å½±ç‰‡å€å¡Š\nâ€¢ å®¢æˆ¶è©•åƒ¹\nâ€¢ FAQ å¸¸è¦‹å•é¡Œ\nâ€¢ è¯çµ¡è¡¨å–®\n\nå³å°‡æ¨å‡ºï¼');
        }
        
        function resetToDefault() {
            if (confirm('âš ï¸ ç¢ºå®šè¦æ¢å¾©é è¨­é…ç½®å—ï¼Ÿ\n\né€™å°‡æœƒæ¸…é™¤æ‰€æœ‰è‡ªè¨‚å…§å®¹ï¼Œæ¢å¾©åˆ°åˆå§‹ç‹€æ…‹ã€‚')) {
                alert('âœ… å·²æ¢å¾©ç‚ºé è¨­é…ç½®');
                location.reload();
            }
        }
        
        function previewWebsite() {
            if (window.HomepageConfig) {
                window.HomepageConfig.previewHomepageChanges();
            } else {
                window.open('index.html', '_blank');
            }
        }
        
        function publishChanges() {
            if (confirm('ğŸš€ ç¢ºå®šè¦ç™¼å¸ƒè®Šæ›´å—ï¼Ÿ\n\nè®Šæ›´å°‡ç«‹å³å¥—ç”¨åˆ°å‰å°ç¶²ç«™ã€‚')) {
                // é¡¯ç¤ºç™¼å¸ƒå‹•ç•«
                const publishBtn = event.target.closest('button');
                publishBtn.disabled = true;
                publishBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ç™¼å¸ƒä¸­...';
                
                setTimeout(() => {
                    // åŸ·è¡Œç™¼å¸ƒ
                    if (window.HomepageConfig) {
                        window.HomepageConfig.publishHomepageChanges();
                    }
                    
                    publishBtn.disabled = false;
                    publishBtn.innerHTML = '<i class="fas fa-upload mr-2"></i>ç™¼å¸ƒæ›´æ–°';
                    
                    // æ›´æ–°æ™‚é–“
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    if (lastUpdateEl) {
                        lastUpdateEl.textContent = new Date().toLocaleString('zh-TW');
                    }
                    
                    // æ›´æ–°å¾Œå°é¡¯ç¤º
                    const config = window.HomepageConfig.getHomepageConfig();
                    renderBlocksFromConfig(config);
                    
                    alert('âœ… ç™¼å¸ƒæˆåŠŸï¼\n\nè®Šæ›´å·²å¥—ç”¨åˆ°å‰å°ç¶²ç«™\n\nâ€¢ æ‰€æœ‰å€å¡Šé…ç½®å·²æ›´æ–°\nâ€¢ é¡¯ç¤ºé †åºå·²åŒæ­¥\nâ€¢ å…§å®¹è¨­å®šå·²ç”Ÿæ•ˆ\n\nè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚');
                }, 500);
            }
        }
        
        // ==================== æ›ç½è¨ˆç•«ç·¨è¼¯å™¨ ====================
        // æ³¨æ„ï¼šbenefitsData å·²åœ¨æ–‡ä»¶é–‹é ­è²æ˜ï¼ˆç¬¬ 432 è¡Œï¼‰ï¼Œæ­¤è™•ä¸å†é‡è¤‡è²æ˜
        
        function renderBenefitsList() {
            const container = document.getElementById('benefitsList');
            if (!container) return;
            
            container.innerHTML = benefitsData.map((benefit, index) => {
                // å®‰å…¨è½‰ç¾© HTML ç‰¹æ®Šå­—ç¬¦
                const safeValue = (benefit || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `
                    <div class="flex items-center gap-2">
                        <input 
                            type="text" 
                            value="${safeValue}" 
                            onchange="benefitsData[${index}] = this.value"
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                        >
                        <button 
                            type="button" 
                            onclick="removeBenefit(${index})" 
                            class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                        >
                    <i class="fas fa-times"></i>
                </button>
                    </div>
                `;
            }).join('');
        }

        function addBenefitItem() {
            benefitsData.push('æ–°å„ªæƒ é …ç›®');
            renderBenefitsList();
        }

        function removeBenefit(index) {
            if (confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                benefitsData.splice(index, 1);
                renderBenefitsList();
            }
        }

        function saveJarExchangeBlock() {
            const data = {
                title: document.getElementById('jarExchangeTitle')?.value || '',
                subtitle: document.getElementById('jarExchangeSubtitle')?.value || '',
                description: document.getElementById('jarExchangeDescription')?.value || '',
                benefits: benefitsData,
                image: document.getElementById('jarExchangeImage')?.value || '',
                ctaPrimary: {
                    text: document.getElementById('jarExchangeCtaPrimary')?.value || '',
                    link: document.getElementById('jarExchangeCtaPrimaryLink')?.value || ''
                },
                ctaSecondary: {
                    text: document.getElementById('jarExchangeCtaSecondary')?.value || '',
                    link: document.getElementById('jarExchangeCtaSecondaryLink')?.value || ''
                }
            };
            
            if (window.HomepageConfig) {
                const success = window.HomepageConfig.updateSectionConfig('jar-exchange', { content: data });
                if (success) {
                    console.log('âœ… å·²æ›´æ–°æ›ç½è¨ˆç•«é…ç½®:', data);
                    // ç«‹å³ç™¼å¸ƒ
                    window.HomepageConfig.publishHomepageChanges();
                    console.log('âœ… é…ç½®å·²è‡ªå‹•ç™¼å¸ƒ');
                }
            }
            
            alert('âœ… æ›ç½è¨ˆç•«å€å¡Šè®Šæ›´å·²å„²å­˜ä¸¦ç™¼å¸ƒï¼\n\nè®Šæ›´å·²ç«‹å³ç”Ÿæ•ˆï¼Œè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚');
            closeEditModal();
            
            // æ›´æ–°é¡¯ç¤º
            if (window.HomepageConfig) {
                const config = window.HomepageConfig.getHomepageConfig();
                renderBlocksFromConfig(config);
            }
        }
        
        // åœ–ç‰‡ä¸Šå‚³è™•ç†ï¼ˆé€šç”¨å‡½æ•¸ï¼‰
        function handleImageUpload(input, fieldId) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // æª¢æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 10MBï¼‰
                if (file.size > 10 * 1024 * 1024) {
                    alert('âŒ åœ–ç‰‡å¤§å°ä¸èƒ½è¶…é 10MB');
                    return;
                }
                
                // æª¢æŸ¥æ–‡ä»¶é¡å‹
                if (!file.type.match('image.*')) {
                    alert('âŒ è«‹é¸æ“‡åœ–ç‰‡æ–‡ä»¶ï¼ˆJPG, PNG, WebP, GIF ç­‰ï¼‰');
                    return;
                }
                
                // è®€å–æ–‡ä»¶ä¸¦è½‰æ›ç‚º base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    const urlInput = document.getElementById(`field-${fieldId}`);
                    if (urlInput) {
                        // å¦‚æœæ˜¯å°åœ–ç‰‡ï¼ˆ< 2MBï¼‰ï¼Œç›´æ¥ä½¿ç”¨ Base64
                        if (file.size < 2 * 1024 * 1024) {
                            urlInput.value = e.target.result;
                        } else {
                            alert('åœ–ç‰‡è¼ƒå¤§ï¼Œè«‹ä¸Šå‚³åˆ°ä¼ºæœå™¨å¾Œå°‡ URL è²¼å…¥ä¸Šæ–¹æ¬„ä½');
                        }
                    }
                };
                
                reader.onerror = function() {
                    alert('âŒ è®€å–åœ–ç‰‡å¤±æ•—ï¼Œè«‹é‡è©¦');
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.renderBenefitsList = renderBenefitsList;
        window.addBenefitItem = addBenefitItem;
        window.removeBenefit = removeBenefit;
        window.saveJarExchangeBlock = saveJarExchangeBlock;
        window.handleImageUpload = handleImageUpload;
        
        // ç”Ÿæˆæ¸¬è©¦å‡æ•¸æ“š
        function generateTestData() {
            console.log('ğŸ”„ æ­£åœ¨ç”Ÿæˆæ¸¬è©¦å‡æ•¸æ“š...');
            
            const config = window.HomepageConfig ? window.HomepageConfig.getHomepageConfig() : null;
            if (!config) {
                console.error('âŒ HomepageConfig æœªè¼‰å…¥');
                return;
            }
            
            // æ›´æ–°å„å€‹å€å¡Šçš„å…§å®¹ç‚ºæ¸¬è©¦æ•¸æ“š
            config.sections.forEach(section => {
                if (!section.content) section.content = {};
                
                switch(section.id) {
                    case 'hero':
                        section.content.title = 'ã„¨ã„¤ã€ä»Šå¤©åƒä»€éº¼';
                        section.content.subtitle = 'åƒæ¯”å—æ›´æœ‰ç¦';
                        section.content.ctaText = 'ç«‹å³é¸è³¼';
                        section.content.ctaLink = '#products';
                        section.content.bgImage = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAoADwDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=';
                        break;
                        
                    case 'toys-hero':
                        section.content.title = 'ç›Šæ™ºç©å…· Hero å€å¡Š';
                        section.content.description = 'çµ¦æ¯›å­©çš„ç›Šæ™ºæŒ‘æˆ°';
                        section.content.features = 'å‹•ç•« + CTA';
                        section.enabled = false; // é è¨­é—œé–‰ï¼Œèˆ‡åœ–ç‰‡æè¿°ä¸€è‡´
                        break;
                        
                    case 'snacks-hero':
                        section.content.title = 'æ‰‹ä½œé›¶é£Ÿ Hero å€å¡Š';
                        section.content.description = 'å°ç£å¤œå¸‚é¢¨å‘³';
                        section.enabled = false; // é è¨­é—œé–‰ï¼Œèˆ‡åœ–ç‰‡æè¿°ä¸€è‡´
                        break;
                        
                    case 'products':
                        section.content.title = 'ç”¢å“ç³»åˆ—';
                        section.content.subtitle = 'ç²¾å¿ƒæŒ‘é¸çš„ç”¢å“ï¼Œæ»¿è¶³æ¯›å­©å„ç¨®éœ€æ±‚';
                        section.content.displayMode = 'è¼ªæ’­å±•ç¤º';
                        section.content.showSnacks = true;
                        section.content.showToys = true;
                        section.content.showSubscription = true;
                        break;
                        
                    case 'quiz':
                        section.content.title = 'æ‰¾åˆ°æœ€é©åˆçš„ç”¢å“';
                        section.content.subtitle = 'é€éå°ˆæ¥­æ¸¬é©—ï¼Œç‚ºæ‚¨çš„æ¯›å­©æ¨è–¦æœ€é©åˆçš„ç”¢å“';
                        section.content.showNutritionQuiz = true;
                        section.content.showToyQuiz = true;
                        section.content.ctaText = 'ç«‹å³æ¸¬é©—';
                        break;
                        
                    case 'subscription':
                        section.content.title = 'è¨‚é–±æœå‹™';
                        section.content.subtitle = 'å®šæœŸé…é€ï¼Œæ–°é®®ç›´é”';
                        section.content.showBasicPlan = true;
                        section.content.showPremiumPlan = true;
                        section.content.showJarProgram = true;
                        break;
                        
                    case 'jar-exchange':
                        section.content.title = 'æ›ç½è¨ˆç•«';
                        section.content.subtitle = 'ç’°ä¿æ„›åœ°çƒï¼Œå›é¥‹æ„›æ¯›å­©';
                        section.content.description = 'å°‡ç»ç’ƒç½å¸¶å›åº—å…§ï¼Œäº«å—å°ˆå±¬å„ªæƒ ';
                        section.content.benefits = [
                            'æ¯æ¬¡å…Œæ›å¯ç²å¾— NT$ 50 æŠ˜æ‰£åˆ¸',
                            'ç´¯è¨ˆ10æ¬¡å‡ç´šç‚ºVIPæœƒå“¡',
                            'å…è²»åƒåŠ å·¥ä½œåŠå’Œæ´»å‹•'
                        ];
                        break;
                        
                    case 'about':
                        section.content.title = 'é—œæ–¼åŒ å¯µ';
                        section.content.subtitle = 'å¾å°ç£åˆ°ä¸–ç•Œï¼Œç‚ºæ¯›å­©å‰µé€ æ›´å¥½çš„ç”Ÿæ´»';
                        section.content.description = 'æˆ‘å€‘ç›¸ä¿¡ï¼Œæ¯ä¸€éš»æ¯›å­©éƒ½å€¼å¾—æœ€å¥½çš„ç…§é¡§ã€‚';
                        break;
                }
            });
            
            // ä¿å­˜é…ç½®
            if (window.HomepageConfig && window.HomepageConfig.saveHomepageConfig) {
                window.HomepageConfig.saveHomepageConfig(config);
            } else {
                localStorage.setItem('homepageConfig', JSON.stringify(config));
            }
            
            console.log('âœ… æ¸¬è©¦å‡æ•¸æ“šå·²ç”Ÿæˆä¸¦ä¿å­˜');
            return config;
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… é¦–é å…§å®¹ç®¡ç†ç³»çµ±å·²è¼‰å…¥');
            
            // è¼‰å…¥é…ç½®ä¸¦æ¸²æŸ“å€å¡Šåˆ—è¡¨
            if (window.HomepageConfig) {
                console.log('âœ… HomepageConfig å·²è¼‰å…¥');
                let config = window.HomepageConfig.getHomepageConfig();
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºå…¨æ–°é…ç½®ï¼ˆæ²’æœ‰è‡ªè¨‚å…§å®¹ï¼‰ï¼Œå¦‚æœæ˜¯å‰‡ç”Ÿæˆæ¸¬è©¦æ•¸æ“š
                const hasCustomData = config.sections.some(s => {
                    if (s.id === 'hero') {
                        return s.content && s.content.title && s.content.title !== 'å¾å°ç£å¤œå¸‚åˆ°å¥åº·é¤æ¡Œ';
                    }
                    return false;
                });
                
                if (!hasCustomData) {
                    console.log('ğŸ“ æª¢æ¸¬åˆ°å…¨æ–°é…ç½®ï¼Œæ­£åœ¨ç”Ÿæˆæ¸¬è©¦å‡æ•¸æ“š...');
                    config = generateTestData();
                }
                
                console.log('ğŸ“‹ è®€å–çš„é…ç½®:', config);
                console.log('ğŸ“‹ Sections æ•¸é‡:', config.sections.length);
                renderBlocksFromConfig(config);
                console.log('âœ… å€å¡Šåˆ—è¡¨æ¸²æŸ“å®Œæˆ');
            } else {
                console.error('âŒ HomepageConfig æœªè¼‰å…¥');
            }
        });
        
        // çµ±ä¸€å€å¡Šé…ç½®æ˜ å°„ï¼ˆç°¡åŒ–ä¸¦çµ±ä¸€æ‰€æœ‰å€å¡Šçš„é¡¯ç¤ºæ ¼å¼ï¼‰
        const blockConfigMap = {
            hero: {
                title: 'Hero ä¸»è¦–è¦ºå€å¡Š',
                badge: { text: 'å¿…è¦å€å¡Š', class: 'bg-blue-100 text-blue-800' },
                content: (section) => {
                    const title = section?.content?.title || 'å¾å°ç£å¤œå¸‚åˆ°å¥åº·é¤æ¡Œ';
                    const subtitle = section?.content?.subtitle || 'æ‰‹å·¥è£½ä½œï¼Œå¤©ç„¶ç„¡æ·»åŠ ';
                    const hasImage = section?.content?.bgImage ? 'æ˜¯' : 'å¦';
                    return getUnifiedBlockContent(title, subtitle, hasImage);
                }
            },
            products: {
                title: 'ç”¢å“ç³»åˆ—å€å¡Š',
                badge: { text: 'é‡è¦å€å¡Š', class: 'bg-green-100 text-green-800' },
                content: (section) => {
                    const title = section?.content?.title || 'ç”¢å“ç³»åˆ—';
                    const subtitle = section?.content?.subtitle || 'ç²¾å¿ƒæŒ‘é¸çš„ç”¢å“ï¼Œæ»¿è¶³æ¯›å­©å„ç¨®éœ€æ±‚';
                    const count = (section?.content?.showSnacks ? 1 : 0) + 
                                  (section?.content?.showToys ? 1 : 0) + 
                                  (section?.content?.showSubscription ? 1 : 0);
                    return getUnifiedBlockContent(title, subtitle, `${count} å€‹ç³»åˆ—`);
                }
            },
            quiz: {
                title: 'æ™ºèƒ½æ¸¬é©—å€å¡Š',
                badge: { text: 'ç‰¹è‰²åŠŸèƒ½', class: 'bg-purple-100 text-purple-800' },
                content: (section) => {
                    const title = section?.content?.title || 'æ‰¾åˆ°æœ€é©åˆçš„ç”¢å“';
                    const subtitle = section?.content?.subtitle || 'é€éå°ˆæ¥­æ¸¬é©—ï¼Œç‚ºæ‚¨çš„æ¯›å­©æ¨è–¦æœ€é©åˆçš„ç”¢å“';
                    const types = [];
                    if (section?.content?.showNutritionQuiz) types.push('ç‡Ÿé¤Šæ¸¬é©—');
                    if (section?.content?.showToyQuiz) types.push('ç©å…·æ¸¬é©—');
                    return getUnifiedBlockContent(title, subtitle, types.join('ã€') || 'æœªè¨­å®š');
                }
            },
            subscription: {
                title: 'è¨‚é–±æœå‹™å€å¡Š',
                badge: { text: 'ç‡Ÿæ”¶é‡é»', class: 'bg-yellow-100 text-yellow-800' },
                content: (section) => {
                    const title = section?.content?.title || 'è¨‚é–±æœå‹™';
                    const subtitle = section?.content?.subtitle || 'å®šæœŸé…é€ï¼Œæ–°é®®ç›´é”';
                    const plans = [];
                    if (section?.content?.showBasicPlan) plans.push('æ¨™æº–');
                    if (section?.content?.showPremiumPlan) plans.push('é€²éš');
                    if (section?.content?.showJarProgram) plans.push('æ›ç½');
                    return getUnifiedBlockContent(title, subtitle, `${plans.length} å€‹æ–¹æ¡ˆï¼ˆ${plans.join('ã€')}ï¼‰`);
                }
            },
            'jar-exchange': {
                title: 'æ›ç½è¨ˆç•«å€å¡Š',
                badge: { text: 'ç’°ä¿è¨ˆç•«', class: 'bg-green-100 text-green-800' },
                content: (section) => {
                    const title = section?.content?.title || 'æ›ç½è¨ˆç•«';
                    const subtitle = section?.content?.subtitle || 'ç’°ä¿æ„›åœ°çƒï¼Œå›é¥‹æ„›æ¯›å­©';
                    const benefits = section?.content?.benefits?.length || 0;
                    return getUnifiedBlockContent(title, subtitle, `${benefits} é …å„ªæƒ `);
                }
            },
            about: {
                title: 'é—œæ–¼æˆ‘å€‘å€å¡Š',
                badge: { text: 'å“ç‰Œä»‹ç´¹', class: 'bg-indigo-100 text-indigo-800' },
                content: (section) => {
                    const title = section?.content?.title || 'é—œæ–¼åŒ å¯µ';
                    const subtitle = section?.content?.subtitle || 'å¾å°ç£åˆ°ä¸–ç•Œï¼Œç‚ºæ¯›å­©å‰µé€ æ›´å¥½çš„ç”Ÿæ´»';
                    const desc = section?.content?.description || 'å“ç‰Œæ•…äº‹';
                    return getUnifiedBlockContent(title, subtitle, desc.length > 30 ? desc.substring(0, 30) + '...' : desc);
                }
            },
            'toys-hero': {
                title: 'ç›Šæ™ºç©å…· Hero å€å¡Š',
                badge: { text: 'ç”¢å“å±•ç¤º', class: 'bg-orange-100 text-orange-800' },
                content: (section) => {
                    const title = section?.content?.title || 'ç›Šæ™ºç©å…· Hero å€å¡Š';
                    const subtitle = section?.content?.description || 'çµ¦æ¯›å­©çš„ç›Šæ™ºæŒ‘æˆ°';
                    return getUnifiedBlockContent(title, subtitle, section?.enabled ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨');
                }
            },
            'snacks-hero': {
                title: 'æ‰‹ä½œé›¶é£Ÿ Hero å€å¡Š',
                badge: { text: 'ç”¢å“å±•ç¤º', class: 'bg-red-100 text-red-800' },
                content: (section) => {
                    const title = section?.content?.title || 'æ‰‹ä½œé›¶é£Ÿ Hero å€å¡Š';
                    const subtitle = section?.content?.description || 'å°ç£å¤œå¸‚é¢¨å‘³';
                    return getUnifiedBlockContent(title, subtitle, section?.enabled ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨');
                }
            },
            crowdfunding: {
                title: 'é›†è³‡é …ç›®å€å¡Š',
                badge: { text: 'é™æ™‚æ´»å‹•', class: 'bg-orange-100 text-orange-800' },
                content: (section) => {
                    const title = section?.content?.projectName || 'é›†è³‡é …ç›®';
                    const subtitle = section?.content?.projectDescription || 'å‰µæ–°ç”¢å“é–‹ç™¼ä¸­';
                    return getUnifiedBlockContent(title, subtitle, section?.enabled ? 'é€²è¡Œä¸­' : 'å·²é—œé–‰');
                }
            },
            'scientific-evidence': {
                title: 'ç§‘å­¸å¯¦è­‰å€å¡Š',
                badge: { text: 'ä¿¡ä»»å»ºç«‹', class: 'bg-blue-100 text-blue-800' },
                content: (section) => getUnifiedBlockContent('ç§‘å­¸å¯¦è­‰å€å¡Š', 'ç ”ç©¶æ•¸æ“šèˆ‡ç§‘å­¸èƒŒæ›¸', section?.enabled ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨')
            },
            'testimonials': {
                title: 'ç”¨æˆ¶è©•åƒ¹èˆ‡ç’°ä¿æˆæœå€å¡Š',
                badge: { text: 'ç¤¾æœƒè­‰æ˜', class: 'bg-green-100 text-green-800' },
                content: (section) => getUnifiedBlockContent('ç”¨æˆ¶è©•åƒ¹èˆ‡ç’°ä¿æˆæœå€å¡Š', 'å®¢æˆ¶è©•åƒ¹èˆ‡ç’°ä¿æˆæœå±•ç¤º', section?.enabled ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨')
            },
            'final-cta': {
                title: 'æœ€çµ‚è¡Œå‹•å‘¼ç±²å€å¡Š',
                badge: { text: 'è½‰æ›é‡é»', class: 'bg-red-100 text-red-800' },
                content: (section) => getUnifiedBlockContent('æœ€çµ‚è¡Œå‹•å‘¼ç±²å€å¡Š', 'å¼•å°ç”¨æˆ¶å®Œæˆè½‰æ›', section?.enabled ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨')
            }
        };
        
        // çµ±ä¸€çš„å€å¡Šå…§å®¹é¡¯ç¤ºå‡½æ•¸ï¼ˆæ‰€æœ‰å€å¡Šä½¿ç”¨ç›¸åŒçš„æ¬„ä½æ ¼å¼ï¼‰
        function getUnifiedBlockContent(field1, field2, field3) {
            return `
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-gray-600 mb-1 text-xs">æ¨™é¡Œ</p>
                        <p class="font-semibold text-gray-800">${field1 || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-gray-600 mb-1 text-xs">æè¿°</p>
                        <p class="font-semibold text-gray-800">${field2 || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-gray-600 mb-1 text-xs">ç‹€æ…‹</p>
                        <p class="font-semibold text-gray-800">${field3 || 'æœªè¨­å®š'}</p>
                    </div>
                </div>
            `;
        }
        
        // å¾é…ç½®æ¸²æŸ“å€å¡Šåˆ—è¡¨
        function renderBlocksFromConfig(config) {
            console.log('ğŸ”„ é–‹å§‹æ¸²æŸ“å€å¡Šåˆ—è¡¨ï¼Œé…ç½®:', config);
            const container = document.getElementById('contentBlocks');
            if (!container) {
                console.error('âŒ æ‰¾ä¸åˆ° contentBlocks å®¹å™¨');
                return;
            }
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // æŒ‰é †åºæ’åº sections
            const sortedSections = [...config.sections].sort((a, b) => (a.order || 999) - (b.order || 999));
            console.log('ğŸ“‹ æ’åºå¾Œçš„ sections:', sortedSections.map(s => ({ id: s.id, order: s.order, enabled: s.enabled })));
            
            // ç‚ºæ¯å€‹ section å‰µå»ºå€å¡Š
            sortedSections.forEach(section => {
                const blockConfig = blockConfigMap[section.id];
                if (!blockConfig) return;
                
                // å‰µå»ºå€å¡Šå…ƒç´ 
                const block = document.createElement('div');
                block.className = 'content-block bg-white rounded-2xl border border-gray-200 p-6 draggable-item';
                block.setAttribute('data-block-id', section.id);
                block.setAttribute('draggable', 'true');
                block.style.transition = 'transform 0.2s';
                
                // è¨ˆç®—ç•¶å‰ä½ç½®
                const currentIndex = sortedSections.findIndex(s => s.id === section.id);
                const isFirst = currentIndex === 0;
                const isLast = currentIndex === sortedSections.length - 1;
                
                // æ§‹å»ºå…§å®¹
                block.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm font-semibold">${currentIndex + 1}</span>
                            <h3 class="text-xl font-bold text-gray-800">${blockConfig.title}</h3>
                            <span class="px-3 py-1 ${blockConfig.badge.class} rounded-full text-xs font-semibold">${blockConfig.badge.text}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="flex flex-col space-y-1">
                                <button onclick="moveBlockUp('${section.id}')" ${isFirst ? 'disabled' : ''} class="px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition text-xs disabled:opacity-50 disabled:cursor-not-allowed" title="ä¸Šç§»">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button onclick="moveBlockDown('${section.id}')" ${isLast ? 'disabled' : ''} class="px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition text-xs disabled:opacity-50 disabled:cursor-not-allowed" title="ä¸‹ç§»">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <button onclick="editBlock('${section.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold">
                                <i class="fas fa-edit mr-1"></i>ç·¨è¼¯
                            </button>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" ${section.enabled ? 'checked' : ''} class="toggle-checkbox sr-only peer" data-section-id="${section.id}">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                    ${typeof blockConfig.content === 'function' ? blockConfig.content(section) : blockConfig.content}
                `;
                
                container.appendChild(block);
            });
            
            console.log(`âœ… å·²æ¸²æŸ“ ${container.children.length} å€‹å€å¡Š`);
            
            // ç¶å®šé–‹é—œäº‹ä»¶
            container.querySelectorAll('.toggle-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const sectionId = this.getAttribute('data-section-id');
                    const isEnabled = this.checked;
                    console.log(`ğŸ”„ åˆ‡æ›å€å¡Š ${sectionId} é¡¯ç¤ºç‹€æ…‹: ${isEnabled ? 'å•Ÿç”¨' : 'ç¦ç”¨'}`);
                    
                    if (window.HomepageConfig) {
                        // æ›´æ–°é…ç½®
                        const config = window.HomepageConfig.getHomepageConfig();
                        const section = config.sections.find(s => s.id === sectionId);
                        if (section) {
                            section.enabled = isEnabled;
                            window.HomepageConfig.saveHomepageConfig(config);
                            console.log(`âœ… å€å¡Š ${sectionId} ç‹€æ…‹å·²æ›´æ–°ç‚º: ${isEnabled ? 'å•Ÿç”¨' : 'ç¦ç”¨'}`);
                            
                            // ç«‹å³ç™¼å¸ƒè®Šæ›´
                            window.HomepageConfig.publishHomepageChanges();
                            console.log(`âœ… å·²ç™¼å¸ƒè®Šæ›´ï¼Œå‰å°æ‡‰ç«‹å³æ›´æ–°`);
                            
                            // é‡æ–°æ¸²æŸ“å€å¡Šåˆ—è¡¨ä»¥åæ˜ æ–°ç‹€æ…‹
                            renderBlocksFromConfig(config);
                        } else {
                            console.error(`âŒ æ‰¾ä¸åˆ°å€å¡Š: ${sectionId}`);
                        }
                    } else {
                        console.error('âŒ HomepageConfig æœªè¼‰å…¥');
                    }
                });
            });
            
        }
        
        // æ»¾å‹•åˆ°æŒ‡å®šå€å¡Šä¸¦é«˜äº®é¡¯ç¤ºï¼ˆå¿«é€Ÿå°èˆªï¼‰
        window.scrollToBlock = function(blockId) {
            console.log('ğŸ“ æ»¾å‹•åˆ°å€å¡Š:', blockId);
            const block = document.querySelector(`[data-block-id="${blockId}"]`);
            if (block) {
                // æ»¾å‹•åˆ°å€å¡Šä½ç½®
                block.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // é«˜äº®é¡¯ç¤ºï¼ˆæ·»åŠ é–ƒçˆæ•ˆæœï¼‰
                block.classList.add('active');
                block.style.animation = 'pulse 2s ease-in-out';
                
                // 2 ç§’å¾Œç§»é™¤é«˜äº®
                setTimeout(() => {
                    block.classList.remove('active');
                    block.style.animation = '';
                }, 2000);
                
                console.log('âœ… å·²æ»¾å‹•åˆ°å€å¡Š:', blockId);
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å€å¡Š:', blockId);
                alert(`æ‰¾ä¸åˆ°ã€Œç”¢å“ç³»åˆ—ã€å€å¡Šï¼Œè«‹ç¢ºèªå€å¡Šæ˜¯å¦å­˜åœ¨æˆ–é‡æ–°æ•´ç†é é¢`);
            }
        };
        
        // ä¸Šç§»å€å¡Šï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.moveBlockUp = function(sectionId) {
            console.log('ä¸Šç§»å€å¡Š:', sectionId);
            if (!window.HomepageConfig) {
                console.error('HomepageConfig æœªè¼‰å…¥');
                return;
            }
            
            const config = window.HomepageConfig.getHomepageConfig();
            const section = config.sections.find(s => s.id === sectionId);
            if (!section) {
                console.error('æ‰¾ä¸åˆ°å€å¡Š:', sectionId);
                return;
            }
            
            // æ‰¾åˆ°å‰ä¸€å€‹å€å¡Šä¸¦äº¤æ›é †åº
            const currentOrder = section.order;
            if (currentOrder <= 1) {
                console.log('å·²ç¶“æ˜¯æœ€å‰é¢äº†');
                return; // å·²ç¶“æ˜¯æœ€å‰é¢äº†
            }
            
            const prevSection = config.sections.find(s => s.order === currentOrder - 1);
            if (prevSection) {
                // äº¤æ›é †åº
                section.order = currentOrder - 1;
                prevSection.order = currentOrder;
                
                // ç¢ºä¿æ‰€æœ‰ sections éƒ½æœ‰æœ‰æ•ˆçš„ order
                config.sections.forEach(s => {
                    if (!s.order || s.order < 1) {
                        s.order = 1;
                    }
                });
                
                // æŒ‰ order æ’åº
                config.sections.sort((a, b) => (a.order || 999) - (b.order || 999));
                
                // é‡æ–°åˆ†é… orderï¼ˆç¢ºä¿é€£çºŒä¸”å”¯ä¸€ï¼‰
                config.sections.forEach((s, index) => {
                    s.order = index + 1;
                });
                
                // ä¿å­˜é…ç½®
                window.HomepageConfig.saveHomepageConfig(config);
                console.log('âœ… é †åºå·²æ›´æ–°');
                
                // é‡æ–°æ¸²æŸ“
                renderBlocksFromConfig(config);
            }
        };
        
        // ä¸‹ç§»å€å¡Šï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.moveBlockDown = function(sectionId) {
            console.log('ä¸‹ç§»å€å¡Š:', sectionId);
            if (!window.HomepageConfig) {
                console.error('HomepageConfig æœªè¼‰å…¥');
                return;
            }
            
            const config = window.HomepageConfig.getHomepageConfig();
            const section = config.sections.find(s => s.id === sectionId);
            if (!section) {
                console.error('æ‰¾ä¸åˆ°å€å¡Š:', sectionId);
                return;
            }
            
            // æ‰¾åˆ°å¾Œä¸€å€‹å€å¡Šä¸¦äº¤æ›é †åº
            const maxOrder = Math.max(...config.sections.map(s => s.order));
            const currentOrder = section.order;
            if (currentOrder >= maxOrder) {
                console.log('å·²ç¶“æ˜¯æœ€å¾Œé¢äº†');
                return; // å·²ç¶“æ˜¯æœ€å¾Œé¢äº†
            }
            
            const nextSection = config.sections.find(s => s.order === currentOrder + 1);
            if (nextSection) {
                // äº¤æ›é †åº
                section.order = currentOrder + 1;
                nextSection.order = currentOrder;
                
                // ç¢ºä¿æ‰€æœ‰ sections éƒ½æœ‰æœ‰æ•ˆçš„ order
                config.sections.forEach(s => {
                    if (!s.order || s.order < 1) {
                        s.order = 1;
                    }
                });
                
                // æŒ‰ order æ’åº
                config.sections.sort((a, b) => (a.order || 999) - (b.order || 999));
                
                // é‡æ–°åˆ†é… orderï¼ˆç¢ºä¿é€£çºŒä¸”å”¯ä¸€ï¼‰
                config.sections.forEach((s, index) => {
                    s.order = index + 1;
                });
                
                // ä¿å­˜é…ç½®
                window.HomepageConfig.saveHomepageConfig(config);
                console.log('âœ… é †åºå·²æ›´æ–°');
                
                // é‡æ–°æ¸²æŸ“
                renderBlocksFromConfig(config);
            }
        };
        
        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½ï¼ˆä¿ç•™ä»¥å‘å¾Œå…¼å®¹ï¼Œä½†ç¾åœ¨ä¸»è¦ä½¿ç”¨æŒ‰éˆ•ï¼‰
        function initDragAndDrop() {
            const container = document.getElementById('contentBlocks');
            if (!container) return;
            
            let draggedElement = null;
            let draggedOverElement = null;
            
            // ç‚ºæ¯å€‹å€å¡Šç¶å®šæ‹–æ‹½äº‹ä»¶
            function bindDragEvents(block) {
                // æ‹–æ‹½é–‹å§‹ - ç¶å®šåˆ°æ•´å€‹å€å¡Š
                block.addEventListener('dragstart', (e) => {
                    // å¦‚æœé»æ“Šçš„æ˜¯æŒ‰éˆ•æˆ–è¼¸å…¥æ¡†ï¼Œä¸è§¸ç™¼æ‹–æ‹½
                    if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.closest('button') || e.target.closest('input')) {
                        e.preventDefault();
                        return false;
                    }
                    
                    draggedElement = block;
                    block.style.opacity = '0.5';
                    block.style.cursor = 'grabbing';
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', block.getAttribute('data-block-id'));
                    
                    // æ·»åŠ æ‹–æ‹½ä¸­çš„æ¨£å¼
                    block.classList.add('dragging');
                });
                
                // æ‹–æ‹½çµæŸ
                block.addEventListener('dragend', (e) => {
                    if (draggedElement) {
                        draggedElement.style.opacity = '1';
                        draggedElement.style.cursor = '';
                        draggedElement.classList.remove('dragging');
                        draggedElement = null;
                    }
                    // æ¸…é™¤æ‰€æœ‰æ‹–æ‹½é«˜äº®
                    container.querySelectorAll('.draggable-item').forEach(el => {
                        el.classList.remove('drag-over');
                        el.style.borderTop = '';
                    });
                });
            }
            
            // ç‚ºæ‰€æœ‰ç¾æœ‰å€å¡Šç¶å®šäº‹ä»¶
            container.querySelectorAll('.draggable-item').forEach(block => {
                bindDragEvents(block);
            });
            
            // æ‹–æ‹½ç¶“é
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const target = e.target.closest('.draggable-item');
                if (target && target !== draggedElement && draggedElement) {
                    draggedOverElement = target;
                    
                    // æ¸…é™¤æ‰€æœ‰é«˜äº®
                    container.querySelectorAll('.draggable-item').forEach(el => {
                        if (el !== draggedElement) {
                            el.classList.remove('drag-over');
                            el.style.borderTop = '';
                        }
                    });
                    
                    // é«˜äº®ç•¶å‰ç›®æ¨™
                    target.classList.add('drag-over');
                    target.style.borderTop = '3px solid #3B82F6';
                    target.style.backgroundColor = '#EFF6FF';
                }
            });
            
            // æ‹–æ‹½é›¢é–‹
            container.addEventListener('dragleave', (e) => {
                const target = e.target.closest('.draggable-item');
                if (target && target !== draggedElement) {
                    target.classList.remove('drag-over');
                    target.style.borderTop = '';
                    target.style.backgroundColor = '';
                }
            });
            
            // æ”¾ç½®
            container.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                if (!draggedElement || !draggedOverElement) return;
                
                // ç§»é™¤é«˜äº®
                container.querySelectorAll('.draggable-item').forEach(el => {
                    el.classList.remove('drag-over');
                    el.style.borderTop = '';
                    el.style.backgroundColor = '';
                });
                
                // ç²å–æ–°çš„é †åº
                const allBlocks = Array.from(container.querySelectorAll('.draggable-item'));
                const draggedIndex = allBlocks.indexOf(draggedElement);
                const targetIndex = allBlocks.indexOf(draggedOverElement);
                
                if (draggedIndex !== targetIndex && draggedIndex !== -1 && targetIndex !== -1) {
                    // é‡æ–°æ’åˆ— DOM
                    if (draggedIndex < targetIndex) {
                        container.insertBefore(draggedElement, draggedOverElement.nextSibling);
                    } else {
                        container.insertBefore(draggedElement, draggedOverElement);
                    }
                    
                    // æ›´æ–°é…ç½®ä¸­çš„é †åº
                    updateOrderFromDOM();
                    
                    // é‡æ–°ç¶å®šæ‹–æ‹½äº‹ä»¶ï¼ˆå› ç‚º DOM é †åºæ”¹è®Šäº†ï¼‰
                    container.querySelectorAll('.draggable-item').forEach(block => {
                        // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ä¸¦é‡æ–°ç¶å®š
                        const newBlock = block.cloneNode(true);
                        block.parentNode.replaceChild(newBlock, block);
                        bindDragEvents(newBlock);
                    });
                }
                
                draggedOverElement = null;
            });
        }
        
        // æ ¹æ“š DOM é †åºæ›´æ–°é…ç½®
        function updateOrderFromDOM() {
            if (!window.HomepageConfig) return;
            
            const container = document.getElementById('contentBlocks');
            const blocks = Array.from(container.querySelectorAll('.draggable-item'));
            const newOrder = blocks.map(block => block.getAttribute('data-block-id'));
            
            // æ›´æ–°é…ç½®
            window.HomepageConfig.reorderSections(newOrder);
            
            console.log('âœ… å€å¡Šé †åºå·²æ›´æ–°:', newOrder);
        }
        
        // æ ¹æ“šé…ç½®æ›´æ–°UIï¼ˆä¿ç•™ä»¥å‘å¾Œå…¼å®¹ï¼Œä½†ç¾åœ¨ä¸»è¦ä½¿ç”¨ renderBlocksFromConfigï¼‰
        function updateUIFromConfig(config) {
            // é‡æ–°æ¸²æŸ“æ•´å€‹åˆ—è¡¨ä»¥åæ˜ é…ç½®è®Šæ›´
            renderBlocksFromConfig(config);
        }
        
        // è™•ç†åœ–ç‰‡æ–‡ä»¶ï¼ˆé€šç”¨å‡½æ•¸ï¼Œæ”¯æŒæ‹–æ‹½å’Œé»æ“Šä¸Šå‚³ï¼‰
        function processImageFile(file) {
            if (!file) return;
            
            // æª¢æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 10MBï¼Œå› ç‚ºæˆ‘å€‘æœƒä½¿ç”¨ IndexedDBï¼‰
            if (file.size > 10 * 1024 * 1024) {
                alert('âŒ åœ–ç‰‡å¤§å°ä¸èƒ½è¶…é 10MB');
                return;
            }
            
            // æª¢æŸ¥æ–‡ä»¶é¡å‹
            if (!file.type.match('image.*')) {
                alert('âŒ è«‹é¸æ“‡åœ–ç‰‡æ–‡ä»¶ï¼ˆJPG, PNG, WebP, GIF ç­‰ï¼‰');
                return;
            }
            
            // è®€å–æ–‡ä»¶ä¸¦è½‰æ›ç‚º base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('heroImagePreview');
                const previewArea = document.getElementById('heroImagePreviewArea');
                const previewContainer = document.getElementById('heroImagePreviewContainer');
                
                if (preview && previewArea && previewContainer) {
                    preview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    previewArea.classList.add('hidden');
                    
                    // å¦‚æœåœ–ç‰‡å¤ªå¤§ï¼ˆ> 2MBï¼‰ï¼Œä½¿ç”¨ IndexedDB å­˜å„²
                    if (file.size > 2 * 1024 * 1024) {
                        saveImageToIndexedDB(file, e.target.result).then(imageRef => {
                            const urlInput = document.getElementById('editHeroBgImage');
                            if (urlInput) {
                                urlInput.value = imageRef;
                                urlInput.placeholder = 'å·²ä¸Šå‚³åœ–ç‰‡ï¼ˆIndexedDBï¼‰';
                            }
                        });
                    } else {
                        // å°åœ–ç‰‡ç›´æ¥ä½¿ç”¨ Base64
                        const urlInput = document.getElementById('editHeroBgImage');
                        if (urlInput) {
                            urlInput.value = e.target.result;
                            urlInput.placeholder = 'å·²ä¸Šå‚³åœ–ç‰‡ï¼ˆBase64ï¼‰';
                        }
                    }
                    
                    console.log('âœ… åœ–ç‰‡å·²ä¸Šå‚³ä¸¦é è¦½');
                }
            };
            
            reader.onerror = function() {
                alert('âŒ è®€å–åœ–ç‰‡å¤±æ•—ï¼Œè«‹é‡è©¦');
            };
            
            reader.readAsDataURL(file);
        }
        
        // è™•ç† Hero åœ–ç‰‡ä¸Šå‚³ï¼ˆé»æ“Šä¸Šå‚³ï¼‰
        function handleHeroImageUpload(event) {
            const file = event.target.files[0];
            processImageFile(file);
        }
        
        // è™•ç†æ‹–æ‹½ä¸Šå‚³
        function handleHeroImageDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('heroImageUploadArea');
            const dragOverlay = document.getElementById('heroImageDragOverlay');
            
            uploadArea.classList.remove('drag-over');
            if (dragOverlay) dragOverlay.classList.add('hidden');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processImageFile(files[0]);
            }
        }
        
        // è™•ç†æ‹–æ‹½æ‡¸åœ
        function handleHeroImageDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('heroImageUploadArea');
            const dragOverlay = document.getElementById('heroImageDragOverlay');
            
            uploadArea.classList.add('drag-over');
            if (dragOverlay) dragOverlay.classList.remove('hidden');
        }
        
        // è™•ç†æ‹–æ‹½é›¢é–‹
        function handleHeroImageDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('heroImageUploadArea');
            const dragOverlay = document.getElementById('heroImageDragOverlay');
            
            uploadArea.classList.remove('drag-over');
            if (dragOverlay) dragOverlay.classList.add('hidden');
        }
        
        // ä½¿ç”¨ IndexedDB å­˜å„²å¤§åœ–ç‰‡
        function saveImageToIndexedDB(file, base64Data) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HeroImagesDB', 1);
                
                request.onerror = () => {
                    console.warn('IndexedDB ä¸å¯ç”¨ï¼Œä½¿ç”¨ Base64');
                    const urlInput = document.getElementById('editHeroBgImage');
                    if (urlInput) {
                        urlInput.value = base64Data;
                    }
                    resolve(base64Data);
                };
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['images'], 'readwrite');
                    const store = transaction.objectStore('images');
                    
                    const imageData = {
                        id: 'hero-bg-image',
                        data: base64Data,
                        timestamp: Date.now()
                    };
                    
                    const putRequest = store.put(imageData);
                    putRequest.onsuccess = () => {
                        console.log('âœ… åœ–ç‰‡å·²ä¿å­˜åˆ° IndexedDB');
                        resolve('indexeddb://hero-bg-image');
                    };
                    
                    putRequest.onerror = () => {
                        console.warn('IndexedDB ä¿å­˜å¤±æ•—ï¼Œä½¿ç”¨ Base64');
                        const urlInput = document.getElementById('editHeroBgImage');
                        if (urlInput) {
                            urlInput.value = base64Data;
                        }
                        resolve(base64Data);
                    };
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('images')) {
                        db.createObjectStore('images', { keyPath: 'id' });
                    }
                };
            });
        }
        
        // å¾ IndexedDB è®€å–åœ–ç‰‡
        function loadImageFromIndexedDB(imageId) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HeroImagesDB', 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['images'], 'readonly');
                    const store = transaction.objectStore('images');
                    const getRequest = store.get(imageId);
                    
                    getRequest.onsuccess = () => {
                        if (getRequest.result) {
                            resolve(getRequest.result.data);
                        } else {
                            reject('åœ–ç‰‡ä¸å­˜åœ¨');
                        }
                    };
                    
                    getRequest.onerror = () => {
                        reject('è®€å–å¤±æ•—');
                    };
                };
                
                request.onerror = () => {
                    reject('IndexedDB ä¸å¯ç”¨');
                };
            });
        }
        
        // æ¸…é™¤åœ–ç‰‡é è¦½
        function clearHeroImagePreview() {
            const preview = document.getElementById('heroImagePreview');
            const previewArea = document.getElementById('heroImagePreviewArea');
            const previewContainer = document.getElementById('heroImagePreviewContainer');
            const fileInput = document.getElementById('editHeroBgFile');
            const urlInput = document.getElementById('editHeroBgImage');
            
            if (preview) {
                preview.src = '';
            }
            if (previewContainer) {
                previewContainer.classList.add('hidden');
            }
            if (previewArea) {
                previewArea.classList.remove('hidden');
            }
            if (fileInput) {
                fileInput.value = '';
            }
            if (urlInput) {
                urlInput.value = '';
                urlInput.placeholder = 'https://example.com/image.jpg';
            }
        }
        
        // ç·¨è¼¯å€å¡Šæ™‚ï¼Œå¦‚æœæœ‰ç¾æœ‰åœ–ç‰‡ï¼Œé¡¯ç¤ºé è¦½
        function showHeroImagePreview(imageUrl) {
            if (!imageUrl) return;
            
            const preview = document.getElementById('heroImagePreview');
            const previewArea = document.getElementById('heroImagePreviewArea');
            const previewContainer = document.getElementById('heroImagePreviewContainer');
            
            if (preview && previewArea && previewContainer) {
                // å¦‚æœæ˜¯ base64 æˆ– http URLï¼Œé¡¯ç¤ºé è¦½
                if (imageUrl.startsWith('data:image') || imageUrl.startsWith('http')) {
                    preview.src = imageUrl;
                    previewContainer.classList.remove('hidden');
                    previewArea.classList.add('hidden');
                    
                    // æ›´æ–° URL è¼¸å…¥æ¡†
                    const urlInput = document.getElementById('editHeroBgImage');
                    if (urlInput) {
                        urlInput.value = imageUrl;
                    }
                }
            }
        }

        // ==================== ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨ ====================
        
        // ä¸‰å€‹ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
        let selectedProductsToys = [];
        let selectedProductsSnacks = [];
        let selectedProductsSubscription = [];
        let allProducts = []; // ç”¢å“é¸æ“‡å™¨ä½¿ç”¨çš„æ‰€æœ‰ç”¢å“æ•¸æ“š
        let currentProductSeries = 'toys'; // ç•¶å‰é¸æ“‡çš„ç³»åˆ—ï¼štoys, snacks, subscription
        
        // æ‰“é–‹ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨
        function openProductsModal() {
            console.log('ğŸ” æ‰“é–‹ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨...');
            
            // å…ˆé¡¯ç¤º Modalï¼Œç¢ºä¿ DOM å…ƒç´ å¯ç”¨
            const modal = document.getElementById('productsModal');
            if (!modal) {
                console.error('âŒ æ‰¾ä¸åˆ°ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨ Modal');
                alert('ç·¨è¼¯å™¨è¼‰å…¥å¤±æ•—ï¼Œæ‰¾ä¸åˆ° Modal å…ƒç´ ');
                return;
            }
            
            // å…ˆç§»é™¤ hidden é¡åˆ¥ï¼Œè®“å…ƒç´ å¯è¦‹ï¼ˆä½†å¯èƒ½é‚„ä¸å¯è¦‹ï¼Œå› ç‚ºå…§å®¹é‚„æ²’è¼‰å…¥ï¼‰
            modal.classList.remove('hidden');
            
            // ç­‰å¾…ä¸€å°æ®µæ™‚é–“ç¢ºä¿ DOM å·²æ¸²æŸ“
            setTimeout(() => {
                // è¼‰å…¥ç¾æœ‰é…ç½®
                let currentConfig = null;
                if (window.HomepageConfig) {
                    try {
                        const config = window.HomepageConfig.getHomepageConfig();
                        console.log('ğŸ“‹ è¼‰å…¥çš„é…ç½®:', config);
                        currentConfig = config.sections.find(s => s.id === 'products');
                        console.log('ğŸ“¦ ç”¢å“ç³»åˆ—é…ç½®:', currentConfig);
                    } catch (error) {
                        console.error('âŒ è¼‰å…¥é…ç½®å¤±æ•—:', error);
                    }
                } else {
                    console.warn('âš ï¸ HomepageConfig æœªè¼‰å…¥');
                }
                
                // å¡«å……è¡¨å–®ï¼ˆç¢ºä¿å…ƒç´ å­˜åœ¨ï¼‰
                const blockTitleEl = document.getElementById('blockTitle');
                const blockSubtitleEl = document.getElementById('blockSubtitle');
                const blockDescriptionEl = document.getElementById('blockDescription');
                
                if (!blockTitleEl || !blockSubtitleEl) {
                    console.error('âŒ æ‰¾ä¸åˆ°è¡¨å–®å…ƒç´ ï¼Œè«‹æª¢æŸ¥ Modal HTML çµæ§‹');
                    console.error('blockTitleEl:', blockTitleEl, 'blockSubtitleEl:', blockSubtitleEl);
                    alert('ç·¨è¼¯å™¨è¼‰å…¥å¤±æ•—ï¼Œæ‰¾ä¸åˆ°è¡¨å–®å…ƒç´ ã€‚è«‹æª¢æŸ¥ Console æŸ¥çœ‹è©³ç´°éŒ¯èª¤ã€‚');
                    return;
                }
                
                console.log('âœ… è¡¨å–®å…ƒç´ å·²æ‰¾åˆ°ï¼Œé–‹å§‹å¡«å……å…§å®¹');
                
                // å¦‚æœæœ‰é…ç½®ï¼Œä½¿ç”¨é…ç½®å€¼ï¼›å¦å‰‡ä½¿ç”¨é è¨­å€¼
                if (currentConfig && currentConfig.content) {
                const content = currentConfig.content;
                console.log('âœ… ä½¿ç”¨ç¾æœ‰é…ç½®:', content);
                
                blockTitleEl.value = content.title || 'ä¸‰å¤§ç”¢å“ç³»åˆ—';
                blockSubtitleEl.value = content.subtitle || 'æ»¿è¶³ä¸åŒéœ€æ±‚';
                if (blockDescriptionEl) blockDescriptionEl.value = content.description || '';
                
                const displayModeEl = document.getElementById('displayMode');
                if (displayModeEl) displayModeEl.value = content.displayMode || 'carousel';
                
                const displayCountEl = document.getElementById('displayCount');
                if (displayCountEl) displayCountEl.value = content.displayCount || 3;
                
                const sortOrderEl = document.getElementById('sortOrder');
                if (sortOrderEl) sortOrderEl.value = content.sortOrder || 'custom';
                
                const showPriceEl = document.getElementById('showPrice');
                if (showPriceEl) showPriceEl.checked = content.showPrice !== false;
                
                const showButtonEl = document.getElementById('showButton');
                if (showButtonEl) showButtonEl.checked = content.showButton !== false;
                
                const buttonTextEl = document.getElementById('buttonText');
                if (buttonTextEl) buttonTextEl.value = content.buttonText || 'æŸ¥çœ‹æ›´å¤š';
                
                const buttonLinkEl = document.getElementById('buttonLink');
                if (buttonLinkEl) buttonLinkEl.value = content.buttonLink || '/products.html';
                
                const bgColorEl = document.getElementById('bgColor');
                const bgColorTextEl = document.getElementById('bgColorText');
                if (bgColorEl) bgColorEl.value = content.bgColor || '#FFFFFF';
                if (bgColorTextEl) bgColorTextEl.value = content.bgColor || '#FFFFFF';
                
                const spacingEl = document.getElementById('spacing');
                if (spacingEl) spacingEl.value = content.spacing || 'medium';
                
                const blockIdEl = document.getElementById('blockId');
                if (blockIdEl) blockIdEl.value = content.blockId || 'products-section';
                
                const schemaTypeEl = document.getElementById('schemaType');
                if (schemaTypeEl) schemaTypeEl.value = content.schemaType || 'Product';
                
                // è¼‰å…¥ä¸‰å€‹ç³»åˆ—çš„å·²é¸ç”¢å“
                selectedProductsToys = Array.isArray(content.productsToys) ? content.productsToys : [];
                selectedProductsSnacks = Array.isArray(content.productsSnacks) ? content.productsSnacks : [];
                selectedProductsSubscription = Array.isArray(content.productsSubscription) ? content.productsSubscription : [];
                console.log('ğŸ“¦ å·²é¸ç”¢å“ - ç©å…·:', selectedProductsToys.length, 'å€‹');
                console.log('ğŸ“¦ å·²é¸ç”¢å“ - é›¶é£Ÿ:', selectedProductsSnacks.length, 'å€‹');
                console.log('ğŸ“¦ å·²é¸ç”¢å“ - è¨‚é–±:', selectedProductsSubscription.length, 'å€‹');
                
                // è¼‰å…¥ç³»åˆ—é¡¯ç¤ºè¨­å®š
                const enableToysEl = document.getElementById('enableSeriesToys');
                const enableSnacksEl = document.getElementById('enableSeriesSnacks');
                const enableSubscriptionEl = document.getElementById('enableSeriesSubscription');
                if (enableToysEl) enableToysEl.checked = content.showToys !== false;
                if (enableSnacksEl) enableSnacksEl.checked = content.showSnacks !== false;
                if (enableSubscriptionEl) enableSubscriptionEl.checked = content.showSubscription !== false;
                
                // æ¸²æŸ“ä¸‰å€‹ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
                renderSeriesProducts('toys');
                renderSeriesProducts('snacks');
                renderSeriesProducts('subscription');
                
                // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹æ¨™ç±¤
                if (typeof window.switchProductSeriesTab === 'function') {
                    window.switchProductSeriesTab('toys');
                }
            } else {
                console.log('â„¹ï¸ ä½¿ç”¨é è¨­å€¼');
                // é è¨­å€¼
                blockTitleEl.value = 'ä¸‰å¤§ç”¢å“ç³»åˆ—';
                blockSubtitleEl.value = 'æ»¿è¶³ä¸åŒéœ€æ±‚';
                if (blockDescriptionEl) blockDescriptionEl.value = '';
                
                const displayModeEl = document.getElementById('displayMode');
                if (displayModeEl) displayModeEl.value = 'carousel';
                
                const displayCountEl = document.getElementById('displayCount');
                if (displayCountEl) displayCountEl.value = 3;
                
                const sortOrderEl = document.getElementById('sortOrder');
                if (sortOrderEl) sortOrderEl.value = 'custom';
                
                const showPriceEl = document.getElementById('showPrice');
                if (showPriceEl) showPriceEl.checked = true;
                
                const showButtonEl = document.getElementById('showButton');
                if (showButtonEl) showButtonEl.checked = true;
                
                const buttonTextEl = document.getElementById('buttonText');
                if (buttonTextEl) buttonTextEl.value = 'æŸ¥çœ‹æ›´å¤š';
                
                const buttonLinkEl = document.getElementById('buttonLink');
                if (buttonLinkEl) buttonLinkEl.value = '/products.html';
                
                const bgColorEl = document.getElementById('bgColor');
                const bgColorTextEl = document.getElementById('bgColorText');
                if (bgColorEl) bgColorEl.value = '#FFFFFF';
                if (bgColorTextEl) bgColorTextEl.value = '#FFFFFF';
                
                const spacingEl = document.getElementById('spacing');
                if (spacingEl) spacingEl.value = 'medium';
                
                const blockIdEl = document.getElementById('blockId');
                if (blockIdEl) blockIdEl.value = 'products-section';
                
                const schemaTypeEl = document.getElementById('schemaType');
                if (schemaTypeEl) schemaTypeEl.value = 'Product';
                
                // é è¨­ç‚ºç©ºåˆ—è¡¨ï¼ˆå¦‚æœæ²’æœ‰é…ç½®ï¼‰
                selectedProductsToys = [];
                selectedProductsSnacks = [];
                selectedProductsSubscription = [];
                
                // é è¨­æ‰€æœ‰ç³»åˆ—éƒ½å•Ÿç”¨
                const enableToysEl = document.getElementById('enableSeriesToys');
                const enableSnacksEl = document.getElementById('enableSeriesSnacks');
                const enableSubscriptionEl = document.getElementById('enableSeriesSubscription');
                if (enableToysEl) enableToysEl.checked = true;
                if (enableSnacksEl) enableSnacksEl.checked = true;
                if (enableSubscriptionEl) enableSubscriptionEl.checked = true;
                
                // é è¨­ç›Šæ™ºç©å…·ç³»åˆ—å…§å®¹
                const toysTitleEl = document.getElementById('toysSeriesTitle');
                const toysDescEl = document.getElementById('toysSeriesDescription');
                const toysResearchEl = document.getElementById('toysResearchText');
                const toysRiskEl = document.getElementById('toysRiskText');
                const toysCtaTextEl = document.getElementById('toysCtaText');
                const toysCtaLinkEl = document.getElementById('toysCtaLink');
                
                if (toysTitleEl) toysTitleEl.value = 'ğŸ§  ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—';
                if (toysDescEl) toysDescEl.value = 'è®“æ¯›å­©å‹•è…¦å‹•æ‰‹ï¼Œå»¶ç·©èªçŸ¥é€€åŒ–ï¼';
                if (toysResearchEl) toysResearchEl.value = 'ç¶­ä¹Ÿç´å¤§å­¸ç ”ç©¶è­‰å¯¦ï¼šç›Šæ™ºåˆºæ¿€å¯å»¶ç·©å¯µç‰©èªçŸ¥é€€åŒ–';
                if (toysRiskEl) toysRiskEl.value = 'è¶…é 50% é«˜é½¡çŠ¬é¢è‡¨å¤±æ™ºé¢¨éšª';
                if (toysCtaTextEl) toysCtaTextEl.value = 'ä¸ç¢ºå®šé¸å“ªæ¬¾ï¼Ÿ2åˆ†é˜æ‰¾å‡ºæœ€é©åˆçš„ç©å…·';
                if (toysCtaLinkEl) toysCtaLinkEl.value = 'quiz-toy.html';
            }
            
                // æ¸²æŸ“ä¸‰å€‹ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
                renderSeriesProducts('toys');
                renderSeriesProducts('snacks');
                renderSeriesProducts('subscription');
                
                // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹æ¨™ç±¤
                if (typeof window.switchProductSeriesTab === 'function') {
                    window.switchProductSeriesTab('toys');
                } else {
                    // å¦‚æœå‡½æ•¸é‚„æ²’å®šç¾©ï¼Œå»¶é²åŸ·è¡Œ
                    setTimeout(() => {
                        if (typeof window.switchProductSeriesTab === 'function') {
                            window.switchProductSeriesTab('toys');
                        }
                    }, 100);
                }
                
                // èƒŒæ™¯é¡è‰²åŒæ­¥ï¼ˆç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ï¼Œé¿å…é‡è¤‡ç¶å®šï¼‰
                const bgColorEl = document.getElementById('bgColor');
                const bgColorTextEl = document.getElementById('bgColorText');
                if (bgColorEl && bgColorTextEl) {
                    // ç§»é™¤èˆŠçš„ç›£è½å™¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                    const newBgColorEl = bgColorEl.cloneNode(true);
                    bgColorEl.parentNode.replaceChild(newBgColorEl, bgColorEl);
                    
                    newBgColorEl.addEventListener('input', function(e) {
                        if (bgColorTextEl) {
                            bgColorTextEl.value = e.target.value;
                        }
                    });
                }
                
                console.log('âœ… ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨å·²æ‰“é–‹ï¼Œå…§å®¹å·²å¡«å……');
            }, 100);
        }
        
        // é—œé–‰ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨
        function closeProductsModal() {
            document.getElementById('productsModal').classList.add('hidden');
        }
        
        // æ¸²æŸ“å·²é¸ç”¢å“åˆ—è¡¨ï¼ˆå·²æ£„ç”¨ï¼Œæ”¹ç”¨ renderSeriesProductsï¼‰
        // æ­¤å‡½æ•¸å·²è¢«ç§»é™¤ï¼Œè«‹ä½¿ç”¨ renderSeriesProducts æ›¿ä»£
        
        // æ‰“é–‹ç”¢å“é¸æ“‡å™¨ï¼ˆå¾ç•¶å‰ç³»åˆ—çš„å·²é¸ç”¢å“é–‹å§‹ï¼‰
        function openProductSelector() {
            // å…ˆå°‡ç•¶å‰ç³»åˆ—çš„å·²é¸ç”¢å“è¼‰å…¥åˆ° selectedProducts
            selectedProducts = [...getCurrentSeriesProducts()];
            try {
                loadProductsForSelector();
                renderProductSelector();
                const modal = document.getElementById('productSelectorModal');
                const productsModal = document.getElementById('productsModal');
                
                if (modal) {
                    // æš«æ™‚é™ä½ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨çš„ z-index
                    if (productsModal) {
                        productsModal.style.zIndex = '50';
                    }
                    
                    // ç¢ºä¿ç”¢å“é¸æ“‡å™¨ Modal é¡¯ç¤ºåœ¨æœ€å‰æ–¹
                    modal.style.setProperty('z-index', '10000', 'important');
                    modal.classList.remove('hidden');
                    
                    // å°‡ Modal ç§»åˆ° body æœ€å¾Œï¼Œç¢ºä¿ DOM é †åºä¹Ÿæ˜¯æœ€å¾Œ
                    if (modal.parentNode !== document.body) {
                        document.body.appendChild(modal);
                    }
                    
                    console.log('âœ… ç”¢å“é¸æ“‡å™¨å·²æ‰“é–‹ï¼Œz-index:', window.getComputedStyle(modal).zIndex);
                } else {
                    console.error('âŒ æ‰¾ä¸åˆ°ç”¢å“é¸æ“‡å™¨ Modal');
                    alert('ç”¢å“é¸æ“‡å™¨è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
                }
            } catch (error) {
                console.error('âŒ æ‰“é–‹ç”¢å“é¸æ“‡å™¨å¤±æ•—:', error);
                alert('æ‰“é–‹ç”¢å“é¸æ“‡å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }
        
        // è¼‰å…¥ç”¢å“æ•¸æ“šï¼ˆå¾ admin-products.html çš„ localStorageï¼‰
        function loadProductsForSelector() {
            const STORAGE_KEY = 'jiangchong_admin_products';
            const stored = localStorage.getItem(STORAGE_KEY);
            
            if (stored) {
                try {
                    allProducts = JSON.parse(stored);
                    console.log('âœ… è¼‰å…¥ç”¢å“æ•¸æ“š:', allProducts.length, 'å€‹ç”¢å“');
                } catch (error) {
                    console.error('âŒ è§£æç”¢å“æ•¸æ“šå¤±æ•—:', error);
                    allProducts = [];
                }
            } else {
                console.warn('âš ï¸ æœªæ‰¾åˆ°ç”¢å“æ•¸æ“šï¼Œè«‹å…ˆåœ¨ç”¢å“ç®¡ç†é é¢æ·»åŠ ç”¢å“');
                allProducts = [];
            }
        }
        
        // æ¸²æŸ“ç”¢å“é¸æ“‡å™¨
        function renderProductSelector() {
            const container = document.getElementById('productSelectorList');
            if (!container) {
                console.error('âŒ æ‰¾ä¸åˆ°ç”¢å“é¸æ“‡å™¨å®¹å™¨');
                return;
            }
            
            const filtered = getFilteredProductsForSelector();
            
            if (filtered.length === 0) {
                const hasProducts = Array.isArray(allProducts) && allProducts.length > 0;
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">${hasProducts ? 'æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç”¢å“' : 'å°šæœªæ·»åŠ ä»»ä½•ç”¢å“'}</p>
                        <p class="text-gray-400 text-sm mt-2">${hasProducts ? 'è«‹èª¿æ•´æœå°‹æ¢ä»¶æˆ–åˆ†é¡ç¯©é¸' : 'è«‹å…ˆåœ¨ç”¢å“ç®¡ç†é é¢æ·»åŠ ç”¢å“'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(product => {
                const isSelected = selectedProducts.some(p => p.id === product.id);
                const categoryNames = {
                    'snacks': 'æ‰‹ä½œé›¶é£Ÿ',
                    'toys': 'ç›Šæ™ºç©å…·',
                    'subscription': 'è¨‚é–±ç½ç½',
                    'crowdfunding': 'é›†è³‡é …ç›®'
                };
                
                return `
                    <div class="product-selector-item bg-white border-2 rounded-xl p-4 transition-all ${isSelected ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-purple-300'}" data-product-id="${product.id}">
                        <div class="flex items-center space-x-4">
                            <input type="checkbox" 
                                   ${isSelected ? 'checked' : ''} 
                                   onchange="toggleProductSelection('${product.id}', this.checked)"
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                            <img src="${product.imageUrl || 'https://via.placeholder.com/100'}" 
                                 alt="${product.name}"
                                 class="w-20 h-20 object-cover rounded-lg"
                                 onerror="this.src='https://via.placeholder.com/100'">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <h4 class="font-bold text-gray-800">${product.name}</h4>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">
                                        ${categoryNames[product.category] || product.category}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${(product.description || 'ç„¡æè¿°').substring(0, 80)}...</p>
                                <div class="flex items-center space-x-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">SKU:</span>
                                        <span class="font-semibold text-gray-700">${product.sku || 'N/A'}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">åƒ¹æ ¼:</span>
                                        <span class="font-bold text-red-600">NT$ ${(product.price || 0).toLocaleString()}</span>
                                        ${product.originalPrice > 0 ? `<span class="text-gray-400 line-through ml-2">NT$ ${product.originalPrice.toLocaleString()}</span>` : ''}
                                    </div>
                                    <div>
                                        <span class="text-gray-500">åº«å­˜:</span>
                                        <span class="font-semibold ${product.stock > 0 ? 'text-green-600' : 'text-red-600'}">${product.stock || 0}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">ç‹€æ…‹:</span>
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                            product.status === 'active' ? 'bg-green-100 text-green-700' :
                                            product.status === 'inactive' ? 'bg-gray-100 text-gray-700' :
                                            'bg-red-100 text-red-700'
                                        }">
                                            ${product.status === 'active' ? 'ä¸Šæ¶ä¸­' : product.status === 'inactive' ? 'å·²ä¸‹æ¶' : 'å·²å”®å®Œ'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // æ›´æ–°å·²é¸æ•¸é‡å’Œç¯©é¸çµæœæ•¸é‡
            updateSelectedCount();
            const filteredCount = document.getElementById('filteredProductsCount');
            if (filteredCount) {
                filteredCount.textContent = filtered.length;
            }
        }
        
        // ç¯©é¸ç”¢å“ï¼ˆç”¨æ–¼ç”¢å“é¸æ“‡å™¨ï¼‰
        function getFilteredProductsForSelector() {
            if (!Array.isArray(allProducts) || allProducts.length === 0) {
                return [];
            }
            
            const search = document.getElementById('productSelectorSearch')?.value.toLowerCase() || '';
            const category = document.getElementById('productSelectorCategory')?.value || '';
            const status = document.getElementById('productSelectorStatus')?.value || '';
            
            return allProducts.filter(product => {
                if (!product) return false;
                
                const matchSearch = !search || 
                    (product.name && product.name.toLowerCase().includes(search)) || 
                    (product.sku && product.sku.toLowerCase().includes(search)) ||
                    (product.description && product.description.toLowerCase().includes(search));
                const matchCategory = !category || product.category === category;
                const matchStatus = !status || product.status === status;
                
                return matchSearch && matchCategory && matchStatus;
            });
        }
        
        // åˆ‡æ›ç”¢å“é¸æ“‡
        function toggleProductSelection(productId, isSelected) {
            if (!productId) {
                console.error('âŒ ç”¢å“ ID ç‚ºç©º');
                return;
            }
            
            const product = allProducts.find(p => p && p.id === productId);
            if (!product) {
                console.error('âŒ æ‰¾ä¸åˆ°ç”¢å“:', productId);
                return;
            }
            
            if (isSelected) {
                // æ·»åŠ åˆ°å·²é¸åˆ—è¡¨
                if (!selectedProducts.some(p => p.id === productId)) {
                    const categoryNames = {
                        'snacks': 'æ‰‹ä½œé›¶é£Ÿ',
                        'toys': 'ç›Šæ™ºç©å…·',
                        'subscription': 'è¨‚é–±ç½ç½',
                        'crowdfunding': 'é›†è³‡é …ç›®'
                    };
                    
                    selectedProducts.push({
                        id: product.id,
                        name: product.name,
                        category: categoryNames[product.category] || product.category,
                        price: product.price,
                        image: product.imageUrl || 'https://via.placeholder.com/100',
                        enabled: true
                    });
                }
            } else {
                // å¾å·²é¸åˆ—è¡¨ç§»é™¤
                selectedProducts = selectedProducts.filter(p => p.id !== productId);
            }
            
            renderProductSelector();
            updateSelectedCount();
        }
        
        // æ‰¹é‡é¸æ“‡/å–æ¶ˆé¸æ“‡
        function toggleSelectAllProducts() {
            const checkbox = document.getElementById('selectAllProducts');
            const filtered = getFilteredProductsForSelector();
            
            filtered.forEach(product => {
                const isSelected = selectedProducts.some(p => p.id === product.id);
                if (checkbox.checked && !isSelected) {
                    toggleProductSelection(product.id, true);
                } else if (!checkbox.checked && isSelected) {
                    toggleProductSelection(product.id, false);
                }
            });
        }
        
        // æ›´æ–°å·²é¸æ•¸é‡
        function updateSelectedCount() {
            const count = selectedProducts.length;
            const countElement = document.getElementById('selectedProductsCount');
            const countBottom = document.getElementById('selectedCountBottom');
            if (countElement) {
                countElement.textContent = count;
            }
            if (countBottom) {
                countBottom.textContent = count;
            }
        }
        
        // é—œé–‰ç”¢å“é¸æ“‡å™¨
        function closeProductSelector() {
            const modal = document.getElementById('productSelectorModal');
            const productsModal = document.getElementById('productsModal');
            
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // æ¢å¾©ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨çš„ z-index
            if (productsModal) {
                productsModal.style.zIndex = '';
            }
        }
        
        // åˆ‡æ›ç”¢å“ç³»åˆ—æ¨™ç±¤ï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.switchProductSeriesTab = function(series) {
            currentProductSeries = series;
            
            // æ›´æ–°æ¨™ç±¤æ¨£å¼
            ['toys', 'snacks', 'subscription'].forEach(s => {
                const capitalized = s.charAt(0).toUpperCase() + s.slice(1);
                const tabBtn = document.getElementById(`seriesTab${capitalized}`);
                const content = document.getElementById(`seriesContent${capitalized}`);
                
                if (tabBtn && content) {
                    if (s === series) {
                        tabBtn.classList.add('border-orange-500', 'text-orange-600');
                        tabBtn.classList.remove('border-transparent', 'text-gray-600');
                        content.classList.remove('hidden');
                    } else {
                        tabBtn.classList.remove('border-orange-500', 'text-orange-600');
                        tabBtn.classList.add('border-transparent', 'text-gray-600');
                        content.classList.add('hidden');
                    }
                }
            });
        };
        
        // ç‚ºç‰¹å®šç³»åˆ—æ‰“é–‹ç”¢å“é¸æ“‡å™¨ï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.openProductSelectorForSeries = function(series) {
            currentProductSeries = series;
            if (typeof openProductSelector === 'function') {
                openProductSelector();
            } else {
                console.error('âŒ openProductSelector å‡½æ•¸æœªå®šç¾©');
                alert('ç”¢å“é¸æ“‡å™¨åŠŸèƒ½è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™å†è©¦');
            }
        };
        
        // ç¢ºèªé¸æ“‡
        function confirmProductSelection() {
            // ç²å–ç•¶å‰ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
            const currentProducts = getCurrentSeriesProducts();
            
            // å°‡ selectedProducts åˆä½µåˆ°ç•¶å‰ç³»åˆ—
            selectedProducts.forEach(product => {
                if (!currentProducts.some(p => p.id === product.id)) {
                    currentProducts.push(product);
                }
            });
            
            // æ›´æ–°å°æ‡‰ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
            if (currentProductSeries === 'toys') {
                selectedProductsToys = [...currentProducts];
            } else if (currentProductSeries === 'snacks') {
                selectedProductsSnacks = [...currentProducts];
            } else if (currentProductSeries === 'subscription') {
                selectedProductsSubscription = [...currentProducts];
            }
            
            // æ¸…ç©º selectedProductsï¼ˆå› ç‚ºå·²ç¶“æ·»åŠ åˆ°å°æ‡‰ç³»åˆ—ï¼‰
            selectedProducts = [];
            
            closeProductSelector();
            renderSeriesProducts(currentProductSeries);
            
            // æ¢å¾©ç”¢å“ç³»åˆ—ç·¨è¼¯å™¨çš„ z-index
            const productsModal = document.getElementById('productsModal');
            if (productsModal) {
                productsModal.style.zIndex = '';
            }
        }
        
        // ç²å–ç•¶å‰ç³»åˆ—çš„ç”¢å“åˆ—è¡¨
        function getCurrentSeriesProducts() {
            if (currentProductSeries === 'toys') {
                return selectedProductsToys;
            } else if (currentProductSeries === 'snacks') {
                return selectedProductsSnacks;
            } else if (currentProductSeries === 'subscription') {
                return selectedProductsSubscription;
            }
            return [];
        }
        
        // æ¸²æŸ“ç‰¹å®šç³»åˆ—çš„ç”¢å“åˆ—è¡¨
        function renderSeriesProducts(series) {
            const containerId = `selectedProducts${series.charAt(0).toUpperCase() + series.slice(1)}`;
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let products = [];
            if (series === 'toys') {
                products = selectedProductsToys;
            } else if (series === 'snacks') {
                products = selectedProductsSnacks;
            } else if (series === 'subscription') {
                products = selectedProductsSubscription;
            }
            
            if (!products || products.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">å°šæœªé¸æ“‡ç”¢å“ï¼Œé»æ“Šã€Œé¸æ“‡ç”¢å“ã€æŒ‰éˆ•æ·»åŠ </p>';
                return;
            }
            
            container.innerHTML = products.map((product, index) => `
                <div class="product-item bg-gray-50 rounded-xl p-4 flex items-center justify-between" data-product-id="${product.id}">
                    <div class="flex items-center space-x-4 flex-1">
                        <i class="fas fa-grip-vertical text-gray-400 drag-handle cursor-move"></i>
                        <img src="${product.image || product.imageUrl || 'https://via.placeholder.com/100'}" 
                             class="w-16 h-16 object-cover rounded-lg" 
                             onerror="this.src='https://via.placeholder.com/100'">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">${product.name}</h5>
                            <p class="text-sm text-gray-600">${product.category || ''} â€¢ NT$ ${product.price || 0}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" ${product.enabled !== false ? 'checked' : ''} 
                                   onchange="toggleSeriesProductEnabled('${series}', ${index}, this.checked)"
                                   class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                        <button onclick="removeSeriesProduct('${series}', ${index})" 
                                class="text-red-500 hover:text-red-700 transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // åˆ‡æ›ç³»åˆ—é¡¯ç¤º/éš±è—ï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.toggleSeriesVisibility = function(series, enabled) {
            console.log(`ğŸ”„ åˆ‡æ› ${series} ç³»åˆ—é¡¯ç¤ºç‹€æ…‹:`, enabled);
            
            // æ›´æ–° checkbox ç‹€æ…‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const checkboxId = `enableSeries${series.charAt(0).toUpperCase() + series.slice(1)}`;
            const checkbox = document.getElementById(checkboxId);
            if (checkbox && checkbox.checked !== enabled) {
                checkbox.checked = enabled;
            }
            
            // é€™è£¡åªæ˜¯æ›´æ–° UI ç‹€æ…‹ï¼Œå¯¦éš›ä¿å­˜æœƒåœ¨é»æ“Šã€Œå„²å­˜ã€æ™‚é€²è¡Œ
            console.log(`âœ… ${series} ç³»åˆ—é¡¯ç¤ºç‹€æ…‹å·²æ›´æ–°ç‚º: ${enabled}`);
        };
        
        // åˆ‡æ›ç³»åˆ—ç”¢å“çš„å•Ÿç”¨ç‹€æ…‹ï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.toggleSeriesProductEnabled = function(series, index, enabled) {
            if (series === 'toys' && selectedProductsToys[index]) {
                selectedProductsToys[index].enabled = enabled;
            } else if (series === 'snacks' && selectedProductsSnacks[index]) {
                selectedProductsSnacks[index].enabled = enabled;
            } else if (series === 'subscription' && selectedProductsSubscription[index]) {
                selectedProductsSubscription[index].enabled = enabled;
            }
        };
        
        // ç§»é™¤ç³»åˆ—ç”¢å“ï¼ˆæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼‰
        window.removeSeriesProduct = function(series, index) {
            if (confirm('ç¢ºå®šè¦ç§»é™¤æ­¤ç”¢å“å—ï¼Ÿ')) {
                if (series === 'toys') {
                    selectedProductsToys.splice(index, 1);
                } else if (series === 'snacks') {
                    selectedProductsSnacks.splice(index, 1);
                } else if (series === 'subscription') {
                    selectedProductsSubscription.splice(index, 1);
                }
                if (typeof renderSeriesProducts === 'function') {
                    renderSeriesProducts(series);
                }
            }
        };
        
        // ç”¢å“é¸æ“‡å™¨æœå°‹å’Œç¯©é¸
        function filterProductsInSelector() {
            renderProductSelector();
        }
        
        // ç§»é™¤ç”¢å“
        function removeProductFromList(index) {
            if (confirm('ç¢ºå®šè¦ç§»é™¤æ­¤ç”¢å“å—ï¼Ÿ')) {
                selectedProducts.splice(index, 1);
                renderSelectedProducts();
            }
        }
        
        // åˆ‡æ›ç”¢å“å•Ÿç”¨ç‹€æ…‹
        function toggleProductEnabled(index, enabled) {
            if (selectedProducts[index]) {
                selectedProducts[index].enabled = enabled;
            }
        }
        
        // ç”¢å“ç³»åˆ—è¡¨å–®æäº¤
        document.getElementById('productsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('blockTitle').value,
                subtitle: document.getElementById('blockSubtitle').value,
                description: document.getElementById('blockDescription').value,
                displayMode: document.getElementById('displayMode').value,
                displayCount: parseInt(document.getElementById('displayCount').value),
                sortOrder: document.getElementById('sortOrder').value,
                showPrice: document.getElementById('showPrice').checked,
                showButton: document.getElementById('showButton').checked,
                buttonText: document.getElementById('buttonText').value,
                buttonLink: document.getElementById('buttonLink').value,
                bgColor: document.getElementById('bgColor').value,
                spacing: document.getElementById('spacing').value,
                blockId: document.getElementById('blockId').value,
                schemaType: document.getElementById('schemaType').value,
                productsToys: selectedProductsToys,
                productsSnacks: selectedProductsSnacks,
                productsSubscription: selectedProductsSubscription,
                showToys: document.getElementById('enableSeriesToys').checked,
                showSnacks: document.getElementById('enableSeriesSnacks').checked,
                showSubscription: document.getElementById('enableSeriesSubscription').checked,
                // ç›Šæ™ºç©å…·ç³»åˆ—å…§å®¹
                toysTitle: document.getElementById('toysSeriesTitle')?.value || 'ğŸ§  ç›Šæ™ºç©å…·é˜²è€ç³»åˆ—',
                toysDescription: document.getElementById('toysSeriesDescription')?.value || 'è®“æ¯›å­©å‹•è…¦å‹•æ‰‹ï¼Œå»¶ç·©èªçŸ¥é€€åŒ–ï¼',
                toysResearchText: document.getElementById('toysResearchText')?.value || 'ç¶­ä¹Ÿç´å¤§å­¸ç ”ç©¶è­‰å¯¦ï¼šç›Šæ™ºåˆºæ¿€å¯å»¶ç·©å¯µç‰©èªçŸ¥é€€åŒ–',
                toysRiskText: document.getElementById('toysRiskText')?.value || 'è¶…é 50% é«˜é½¡çŠ¬é¢è‡¨å¤±æ™ºé¢¨éšª',
                toysCtaText: document.getElementById('toysCtaText')?.value || 'ä¸ç¢ºå®šé¸å“ªæ¬¾ï¼Ÿ2åˆ†é˜æ‰¾å‡ºæœ€é©åˆçš„ç©å…·',
                toysCtaLink: document.getElementById('toysCtaLink')?.value || 'quiz-toy.html'
            };
            
            console.log('å„²å­˜ç”¢å“ç³»åˆ—è¨­å®šï¼š', formData);
            
            // ä¿å­˜åˆ° HomepageConfig
            if (window.HomepageConfig) {
                const success = window.HomepageConfig.updateSectionConfig('products', { content: formData });
                if (success) {
                    console.log('âœ… ç”¢å“ç³»åˆ—é…ç½®å·²æ›´æ–°');
                    window.HomepageConfig.publishHomepageChanges();
                }
            }
            
            // ä¿å­˜åˆ° LocalStorageï¼ˆå‚™ä»½ï¼‰
            localStorage.setItem('homepage_products_config', JSON.stringify(formData));
            
            // é¡¯ç¤ºæˆåŠŸé€šçŸ¥
            alert('âœ… ç”¢å“ç³»åˆ—è¨­å®šå·²å„²å­˜ä¸¦ç™¼å¸ƒï¼\n\nè®Šæ›´å·²ç«‹å³ç”Ÿæ•ˆï¼Œè«‹é‡æ–°æ•´ç†é¦–é æŸ¥çœ‹æ•ˆæœã€‚');
            
            // é—œé–‰ Modal
            closeProductsModal();
            
            // æ›´æ–°å€å¡Šé¡¯ç¤º
            if (window.HomepageConfig) {
                const config = window.HomepageConfig.getHomepageConfig();
                renderBlocksFromConfig(config);
            }
        });
        
        // é»æ“Š Modal å¤–éƒ¨é—œé–‰
        document.getElementById('productsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProductsModal();
            }
        });
    </script>
</body>
</html>
