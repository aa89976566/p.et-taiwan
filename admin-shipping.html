<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物流設定 - 匠寵後台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .sidebar-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 成功提示 -->
    <div id="successToast" class="hidden fixed top-20 right-6 z-50 bg-green-500 text-white px-6 py-4 rounded-lg shadow-xl">
        <div class="flex items-center space-x-3">
            <i class="fas fa-check-circle text-2xl"></i>
            <div>
                <p class="font-semibold">儲存成功！</p>
                <p class="text-sm opacity-90">物流設定已更新</p>
            </div>
        </div>
    </div>

    <!-- 頂部導航 -->
    <nav class="bg-white border border-gray-200 fixed w-full top-0 z-50">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-paw text-red-500 text-2xl"></i>
                    <h1 class="text-xl font-bold text-gray-800">物流設定管理</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="testShipping()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                        <i class="fas fa-vial mr-2"></i>測試結帳
                    </button>
                    <button onclick="saveSettings()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                        <i class="fas fa-save mr-2"></i>儲存設定
                    </button>
                    <a href="admin-dashboard.html" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-times text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex pt-16">
        <!-- 側邊欄 -->
        <aside class="w-64 bg-white h-screen border border-gray-200 fixed overflow-y-auto">
            <div class="p-6">
                <h2 class="text-sm font-semibold text-gray-400 uppercase mb-4">物流管理</h2>
                <nav class="space-y-2">
                    <a href="admin-shipping.html" class="sidebar-item active flex items-center space-x-3 px-4 py-3 rounded-lg">
                        <i class="fas fa-shipping-fast"></i>
                        <span>物流設定</span>
                    </a>
                    <a href="admin-orders.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition">
                        <i class="fas fa-shopping-cart"></i>
                        <span>訂單管理</span>
                    </a>
                </nav>

                <h2 class="text-sm font-semibold text-gray-400 uppercase mb-4 mt-8">返回</h2>
                <a href="admin-dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition">
                    <i class="fas fa-arrow-left"></i>
                    <span>返回儀表板</span>
                </a>
            </div>
        </aside>

        <!-- 主要內容 -->
        <main class="flex-1 ml-64 p-8">
            <div class="max-w-6xl mx-auto">
                <!-- 頁面標題 -->
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">物流設定</h2>
                    <p class="text-gray-600 mt-2">設定網站的配送方式、運費和物流選項</p>
                </div>

                <!-- 免運門檻設定 -->
                <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-gift text-yellow-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">免運門檻設定</h3>
                            <p class="text-sm text-gray-600">設定滿額免運的門檻金額</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">免運門檻（元）</label>
                        <input type="number" id="freeShippingThreshold" value="1000" placeholder="0 = 不啟用" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500">
                        <p class="text-sm text-gray-500 mt-1">購物金額達到此門檻時，將自動免運費</p>
                    </div>
                </div>

                <!-- 7-11 超商取貨 -->
                <div class="bg-white rounded-2xl shadow-md p-6 mb-6 border-2 border-orange-200">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-store text-orange-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">7-11 超商取貨</h3>
                                <p class="text-sm text-gray-600">送至 7-ELEVEN 門市</p>
                            </div>
                        </div>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="sevenElevenEnabled" checked class="w-5 h-5">
                            <span class="font-medium">啟用</span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">運費（元）</label>
                            <input type="number" id="sevenElevenFee" value="60" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">配送時間</label>
                            <input type="text" id="sevenElevenTime" value="2-3 個工作天" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="sevenElevenRecommended" checked class="w-5 h-5">
                                <span class="text-sm font-medium text-gray-700">標示為「推薦」選項</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 全家超商取貨 -->
                <div class="bg-white rounded-2xl shadow-md p-6 mb-6 border-2 border-green-200">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-store text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">全家超商取貨</h3>
                                <p class="text-sm text-gray-600">送至全家便利商店</p>
                            </div>
                        </div>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="familyEnabled" checked class="w-5 h-5">
                            <span class="font-medium">啟用</span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">運費（元）</label>
                            <input type="number" id="familyFee" value="60" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">配送時間</label>
                            <input type="text" id="familyTime" value="2-3 個工作天" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                </div>

                <!-- 即時預覽 -->
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl shadow-md p-6 text-white">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-eye mr-2"></i>前端顯示預覽
                    </h3>
                    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 space-y-3">
                        <div id="preview711" class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-store text-2xl"></i>
                                <div class="flex items-center space-x-2">
                                    <p class="font-semibold">7-11 超商取貨</p>
                                    <span id="previewRecommended" class="px-2 py-1 bg-yellow-400 text-yellow-900 text-xs rounded-full">推薦</span>
                                </div>
                            </div>
                            <span class="font-bold text-xl" id="preview711Fee">NT$ 60</span>
                        </div>
                        <div id="previewFamily" class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-store text-2xl"></i>
                                <div>
                                    <p class="font-semibold">全家超商取貨</p>
                                    <p class="text-sm opacity-90" id="previewFamilyTime">2-3 個工作天到店</p>
                                </div>
                            </div>
                            <span class="font-bold text-xl" id="previewFamilyFee">NT$ 60</span>
                        </div>
                        <div id="previewFreeShipping" class="hidden text-center py-2 bg-yellow-400 text-yellow-900 rounded font-semibold">
                            <i class="fas fa-gift mr-2"></i>滿 <span id="previewThreshold">1000</span> 元免運
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 物流設定資料
        let shippingConfig = {
            sevenEleven: {
                enabled: true,
                fee: 60,
                time: '2-3 個工作天',
                recommended: true
            },
            family: {
                enabled: true,
                fee: 60,
                time: '2-3 個工作天'
            },
            freeShipping: {
                threshold: 1000
            }
        };

        // 更新預覽
        function updatePreview() {
            // 7-11
            const fee711 = document.getElementById('sevenElevenFee').value;
            document.getElementById('preview711Fee').textContent = `NT$ ${fee711}`;
            const recommended = document.getElementById('sevenElevenRecommended').checked;
            document.getElementById('previewRecommended').style.display = recommended ? 'inline-block' : 'none';

            // 全家
            const familyFee = document.getElementById('familyFee').value;
            const familyTime = document.getElementById('familyTime').value;
            document.getElementById('previewFamilyFee').textContent = `NT$ ${familyFee}`;
            document.getElementById('previewFamilyTime').textContent = familyTime + '到店';

            // 免運門檻
            const threshold = parseInt(document.getElementById('freeShippingThreshold').value);
            if (threshold > 0) {
                document.getElementById('previewFreeShipping').classList.remove('hidden');
                document.getElementById('previewThreshold').textContent = threshold;
            } else {
                document.getElementById('previewFreeShipping').classList.add('hidden');
            }
        }

        // 監聽輸入變化
        document.querySelectorAll('input, textarea').forEach(el => {
            el.addEventListener('input', updatePreview);
            el.addEventListener('change', updatePreview);
        });

        // 儲存設定
        function saveSettings() {
            // 收集設定資料
            shippingConfig = {
                sevenEleven: {
                    enabled: document.getElementById('sevenElevenEnabled').checked,
                    fee: parseInt(document.getElementById('sevenElevenFee').value),
                    days: document.getElementById('sevenElevenTime').value.replace(/個工作天/, '').trim(),
                    recommended: document.getElementById('sevenElevenRecommended').checked
                },
                family: {
                    enabled: document.getElementById('familyEnabled').checked,
                    fee: parseInt(document.getElementById('familyFee').value),
                    days: document.getElementById('familyTime').value.replace(/個工作天/, '').trim()
                },
                freeShipping: {
                    enabled: true,
                    threshold: parseInt(document.getElementById('freeShippingThreshold').value) || 0
                }
            };

            // 儲存到 localStorage（前端同步使用的鍵名）
            localStorage.setItem('shippingSettings', JSON.stringify(shippingConfig));
            localStorage.setItem('jiangchong_shipping', JSON.stringify(shippingConfig));
            localStorage.setItem('jiangchong_shipping_updated', new Date().toISOString());
            
            // 觸發 storage 事件通知其他分頁
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'shippingSettings',
                newValue: JSON.stringify(shippingConfig),
                url: window.location.href
            }));

            // 顯示成功提示
            const toast = document.getElementById('successToast');
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
            
            console.log('✅ 物流設定已儲存並同步到前端');
        }

        // 測試結帳頁面
        function testShipping() {
            saveSettings();
            window.open('checkout.html', '_blank');
        }

        // 頁面載入時恢復設定
        window.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('jiangchong_shipping');
            if (saved) {
                try {
                    shippingConfig = JSON.parse(saved);
                    
                    // 恢復 7-11 設定
                    document.getElementById('sevenElevenEnabled').checked = shippingConfig.sevenEleven.enabled;
                    document.getElementById('sevenElevenFee').value = shippingConfig.sevenEleven.fee;
                    document.getElementById('sevenElevenTime').value = shippingConfig.sevenEleven.time;
                    document.getElementById('sevenElevenRecommended').checked = shippingConfig.sevenEleven.recommended;
                    
                    // 恢復全家設定
                    document.getElementById('familyEnabled').checked = shippingConfig.family.enabled;
                    document.getElementById('familyFee').value = shippingConfig.family.fee;
                    document.getElementById('familyTime').value = shippingConfig.family.time;
                    
                    // 恢復免運設定
                    document.getElementById('freeShippingThreshold').value = shippingConfig.freeShipping.threshold;
                    
                    updatePreview();
                } catch (e) {
                    console.error('載入設定失敗:', e);
                }
            }
        });
    </script>
</body>
</html>
