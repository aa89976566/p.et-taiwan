<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="åŒ å¯µè€çŠ¬è…¦åŠ›æ¸¬é©— - åŸºæ–¼ç¶­ä¹Ÿç´å¤§å­¸ç ”ç©¶ï¼Œè©•ä¼°èªçŸ¥å¥åº·">
    <title>è€çŠ¬è…¦åŠ›æ¸¬é©— - åŒ å¯µ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - å¯æ„›åœ“é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Zen+Maru+Gothic:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- æ•¸æ“šç®¡ç†ç³»çµ± -->
    <script src="js/data-store.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/quiz-system.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD93D',
                        orange: '#FF8C42',
                        dark: '#2C3E50',
                        light: '#F7F9FC'
                    },
                    fontFamily: {
                        'sans': ['Zen Maru Gothic', 'Noto Sans TC', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-gradient-to-br from-orange-50 to-yellow-50">
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white shadow-md z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="flex items-center space-x-2">
                    <i class="fas fa-paw text-primary text-3xl"></i>
                    <span class="text-2xl font-bold text-dark">åŒ å¯µ</span>
                </a>
                <a href="index.html" class="text-gray-600 hover:text-primary transition">
                    <i class="fas fa-times text-2xl"></i>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-24 pb-16">
        <div class="container mx-auto px-4 max-w-4xl">
            
            <!-- Progress Bar -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-semibold text-gray-600" id="progress-text">æ­¥é©Ÿ 1 / 12</span>
                    <span class="text-sm text-gray-500" id="progress-percentage">8%</span>
                </div>
                <div class="quiz-progress">
                    <div class="quiz-progress-bar" id="progress-bar" style="width: 8%; background: linear-gradient(90deg, #FF8C42, #FFD93D);"></div>
                </div>
            </div>
            
            <!-- Quiz Container -->
            <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12" id="quiz-container">
                
                <!-- Welcome Screen -->
                <div id="welcome-screen" class="text-center">
                    <div class="relative w-32 h-32 mx-auto mb-6">
                        <div class="absolute inset-0 rounded-full animate-pulse opacity-20" style="background: linear-gradient(135deg, #FF8C42, #FFD93D);"></div>
                        <div class="relative w-32 h-32 rounded-full flex items-center justify-center shadow-xl" style="background: linear-gradient(135deg, #FF8C42, #FFD93D);">
                            <i class="fas fa-brain text-white text-5xl"></i>
                        </div>
                    </div>
                    <div class="inline-block text-white px-4 py-2 rounded-full text-sm font-bold mb-3" style="background: linear-gradient(90deg, #FF8C42, #FFD93D);">
                        <i class="fas fa-flask mr-1"></i>ç§‘å­¸ç ”ç©¶èƒŒæ›¸
                    </div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-3">ğŸ§© ç†Ÿé½¡å¯µç‰©è…¦åŠ›æ¸¬é©—</h1>
                    <p class="text-xl text-gray-600 mb-2"><strong>4 åˆ†é˜</strong> ç§‘å­¸è©•ä¼°ï¼Œæ‰¾åˆ°æœ€é©åˆçš„ç›Šæ™ºç©å…·</p>
                    <p class="text-lg font-semibold mb-6" style="color: #FF8C42;">
                        <i class="fas fa-gift mr-1"></i>å®Œæˆå¾Œé€ <span class="text-primary">15% æŠ˜æ‰£ç¢¼</span>
                    </p>
                    
                    <!-- Scientific Backing -->
                    <div class="bg-orange-50 border-l-4 border-orange-400 rounded-xl p-6 mb-6 text-left max-w-2xl mx-auto">
                        <div class="flex items-start">
                            <i class="fas fa-university text-orange-400 text-3xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="font-bold text-lg mb-2">ç§‘å­¸ç ”ç©¶èƒŒæ›¸</h3>
                                <p class="text-gray-700 mb-2">æœ¬æ¸¬é©—åŸºæ–¼<strong>ç¶­ä¹Ÿç´å¤§å­¸ Clever Dog Lab</strong> çš„ç ”ç©¶è¨­è¨ˆ</p>
                                <p class="text-sm text-gray-600">ç ”ç©¶è­‰å¯¦ï¼šå®šæœŸçš„èªçŸ¥åˆºæ¿€å¯ä»¥å»¶ç·©ç†Ÿé½¡æ¯›å­©çš„èªçŸ¥é€€åŒ–ï¼Œç›Šæ™ºç©å…·èƒ½æœ‰æ•ˆç¶­æŒå¤§è…¦æ´»åŠ›</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Warning for Senior Pets -->
                    <div class="bg-red-50 border-l-4 border-red-400 rounded-xl p-6 mb-6 text-left max-w-2xl mx-auto">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-400 text-2xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="font-bold mb-2">é‡è¦æé†’</h3>
                                <p class="text-gray-700">è¶…é <strong class="text-red-600">50%</strong> çš„ç†Ÿé½¡æ¯›å­©ï¼ˆç‹— 7 æ­²ä»¥ä¸Šã€è²“ 10 æ­²ä»¥ä¸Šï¼‰é¢è‡¨èªçŸ¥åŠŸèƒ½ä¸‹é™çš„é¢¨éšª</p>
                                <p class="text-sm text-gray-600 mt-2">æ—©æœŸç™¼ç¾èˆ‡ä»‹å…¥èƒ½æœ‰æ•ˆæ”¹å–„ç”Ÿæ´»å“è³ª</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-light rounded-2xl p-6 mb-8 text-left max-w-2xl mx-auto">
                        <h3 class="font-bold text-lg mb-4 flex items-center">
                            <i class="fas fa-clipboard-list mr-2" style="color: #FF8C42;"></i>
                            æ¸¬é©—åŒ…å«
                        </h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <i class="fas fa-check-circle mr-3 mt-1" style="color: #FF8C42;"></i>
                                <span>åŸºæœ¬è³‡è¨Šï¼ˆå¹´é½¡ã€å“ç¨®ã€å¥åº·ç‹€æ³ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle mr-3 mt-1" style="color: #FF8C42;"></i>
                                <span>èªçŸ¥åŠŸèƒ½è©•ä¼°ï¼ˆè¨˜æ†¶åŠ›ã€å­¸ç¿’èƒ½åŠ›ã€å°ˆæ³¨åŠ›ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle mr-3 mt-1" style="color: #FF8C42;"></i>
                                <span>è¡Œç‚ºè§€å¯Ÿï¼ˆè¿·è·¯ã€ç„¦æ…®ã€ç¡çœ ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle mr-3 mt-1" style="color: #FF8C42;"></i>
                                <span>æ´»å‹•èƒ½åŠ›è©•ä¼°</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle mr-3 mt-1" style="color: #FF8C42;"></i>
                                <span>å€‹äººåŒ–ç›Šæ™ºç©å…·æ¨è–¦</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="flex items-center justify-center gap-4 mb-8">
                        <div class="flex items-center">
                            <i class="fas fa-clock mr-2" style="color: #FF8C42;"></i>
                            <span class="text-sm text-gray-600">ç´„ 4 åˆ†é˜</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-flask mr-2" style="color: #FF8C42;"></i>
                            <span class="text-sm text-gray-600">ç§‘å­¸ç ”ç©¶</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-paw mr-2" style="color: #FF8C42;"></i>
                            <span class="text-sm text-gray-600">ç†Ÿé½¡æ¯›å­©é©ç”¨</span>
                        </div>
                    </div>
                    
                    <button onclick="startQuiz()" class="text-white px-12 py-4 rounded-full text-lg font-bold hover:shadow-2xl transition transform hover:scale-105 relative overflow-hidden group" style="background: linear-gradient(135deg, #FF8C42, #FFD93D);">
                        <span class="relative z-10">ğŸš€ ç«‹å³é–‹å§‹ <i class="fas fa-arrow-right ml-2"></i></span>
                        <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition"></div>
                    </button>
                </div>
                
                <!-- Question Screens -->
                <div id="question-screen" class="hidden">
                    <!-- Question will be dynamically inserted here -->
                </div>
                
                <!-- Loading Screen -->
                <div id="loading-screen" class="hidden text-center py-12">
                    <div class="spinner mx-auto mb-6" style="border-top-color: #FF8C42;"></div>
                    <h3 class="text-2xl font-bold mb-2">æ­£åœ¨åˆ†ææ‚¨æ¯›å­©çš„èªçŸ¥ç‹€æ³...</h3>
                    <p class="text-gray-600">è«‹ç¨å€™ï¼Œæˆ‘å€‘æ­£åœ¨æ ¹æ“šç§‘å­¸ç ”ç©¶ç‚ºæ‚¨æ¨è–¦æœ€é©åˆçš„ç›Šæ™ºç©å…·</p>
                </div>
                
            </div>
            
            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-8" id="nav-buttons" style="display: none;">
                <button onclick="previousQuestion()" id="prev-btn" class="bg-gray-200 text-dark px-8 py-3 rounded-full font-semibold hover:bg-gray-300 transition">
                    <i class="fas fa-arrow-left mr-2"></i>ä¸Šä¸€é¡Œ
                </button>
                <button onclick="nextQuestion()" id="next-btn" class="text-white px-8 py-3 rounded-full font-semibold hover:opacity-90 transition" style="background: linear-gradient(135deg, #FF8C42, #FFD93D);">
                    ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
            
        </div>
    </main>
    
    <!-- Quiz Data & Logic -->
    <script>
        // Quiz Questions Data - Based on Vienna University Research
        const quizData = [
            {
                id: 1,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©æ˜¯ï¼Ÿ',
                type: 'choice',
                icon: 'fa-paw',
                options: [
                    { value: 'dog', label: 'ç‹—ç‹— ğŸ•', icon: 'fa-dog' },
                    { value: 'cat', label: 'è²“å’ª ğŸ±', icon: 'fa-cat' }
                ]
            },
            {
                id: 2,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©å«ä»€éº¼åå­—ï¼Ÿ',
                type: 'text',
                placeholder: 'è«‹è¼¸å…¥å¯µç‰©åå­—',
                icon: 'fa-heart',
                required: true
            },
            {
                id: 3,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©ç›®å‰å¹¾æ­²ï¼Ÿ',
                type: 'number',
                icon: 'fa-birthday-cake',
                placeholder: 'è«‹è¼¸å…¥å¹´é½¡',
                unit: 'æ­²',
                min: 1,
                hint: 'æœ¬æ¸¬é©—é©ç”¨æ–¼ç†Ÿé½¡æ¯›å­©ï¼ˆç‹— 7 æ­²ä»¥ä¸Šã€è²“ 10 æ­²ä»¥ä¸Šï¼‰'
            },
            {
                id: 4,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©çš„é«”å‹ï¼Ÿ',
                type: 'choice',
                icon: 'fa-paw',
                options: [
                    { value: 'small', label: 'å°å‹', desc: 'é«”é‡ < 10kg' },
                    { value: 'medium', label: 'ä¸­å‹', desc: 'é«”é‡ 10-25kg' },
                    { value: 'large', label: 'å¤§å‹', desc: 'é«”é‡ > 25kg' }
                ]
            },
            {
                id: 5,
                category: 'cognitive',
                question: 'ä½ çš„æ¯›å­©æœ€è¿‘æ˜¯å¦å‡ºç¾ä»¥ä¸‹æƒ…æ³ï¼Ÿ',
                subtitle: 'ï¼ˆèªçŸ¥åŠŸèƒ½è©•ä¼°ï¼‰',
                type: 'multi-choice',
                icon: 'fa-brain',
                options: [
                    { value: 'none', label: 'æ²’æœ‰ä»¥ä¸‹æƒ…æ³' },
                    { value: 'disoriented', label: 'åœ¨ç†Ÿæ‚‰çš„åœ°æ–¹è¿·è·¯æˆ–å›°æƒ‘' },
                    { value: 'forget_people', label: 'å¿˜è¨˜ç†Ÿæ‚‰çš„äººæˆ–å¯µç‰©' },
                    { value: 'forget_commands', label: 'å¿˜è¨˜å·²å­¸æœƒçš„æŒ‡ä»¤' },
                    { value: 'stare', label: 'ç¶“å¸¸ç™¼å‘†æˆ–å‡è¦–ç©ºé–“' },
                    { value: 'stuck', label: 'èµ°è·¯æ™‚æ’åˆ°ç‰©å“æˆ–å¡åœ¨è§’è½' }
                ]
            },
            {
                id: 6,
                category: 'cognitive',
                question: 'ä½ çš„æ¯›å­©çš„å­¸ç¿’èˆ‡è¨˜æ†¶èƒ½åŠ›ï¼Ÿ',
                type: 'choice',
                icon: 'fa-graduation-cap',
                options: [
                    { value: 'good', label: 'å¾ˆå¥½', desc: 'èƒ½å¿«é€Ÿå­¸ç¿’æ–°æŒ‡ä»¤ï¼Œè¨˜å¾—èˆŠæŒ‡ä»¤' },
                    { value: 'normal', label: 'æ­£å¸¸', desc: 'éœ€è¦ä¸€äº›æ™‚é–“å­¸ç¿’ï¼Œå¶çˆ¾å¿˜è¨˜' },
                    { value: 'declining', label: 'é€€åŒ–ä¸­', desc: 'é›£ä»¥å­¸ç¿’æ–°äº‹ç‰©ï¼Œç¶“å¸¸å¿˜è¨˜' }
                ]
            },
            {
                id: 7,
                category: 'behavior',
                question: 'ä½ çš„æ¯›å­©çš„ç¡çœ æ¨¡å¼ï¼Ÿ',
                type: 'choice',
                icon: 'fa-bed',
                options: [
                    { value: 'normal', label: 'æ­£å¸¸', desc: 'ç™½å¤©æ´»å‹•ï¼Œæ™šä¸Šç¡è¦º' },
                    { value: 'reversed', label: 'æ—¥å¤œé¡›å€’', desc: 'æ™šä¸Šä¸ç¡è¦ºï¼Œç™½å¤©æ˜ç¡' },
                    { value: 'restless', label: 'ç¡çœ ä¸å®‰', desc: 'ç¶“å¸¸é†’ä¾†ï¼Œç¡çœ å“è³ªå·®' }
                ]
            },
            {
                id: 8,
                category: 'behavior',
                question: 'ä½ çš„æ¯›å­©æœ€è¿‘çš„æƒ…ç·’ç‹€æ…‹ï¼Ÿ',
                type: 'multi-choice',
                icon: 'fa-heart',
                options: [
                    { value: 'normal', label: 'æ­£å¸¸å¿«æ¨‚' },
                    { value: 'anxious', label: 'å®¹æ˜“ç„¦æ…®æˆ–ç·Šå¼µ' },
                    { value: 'aggressive', label: 'æ¯”ä»¥å‰æ›´å®¹æ˜“ç”Ÿæ°£æˆ–æ”»æ“Š' },
                    { value: 'apathy', label: 'å°äº‹ç‰©å¤±å»èˆˆè¶£' },
                    { value: 'clingy', label: 'è®Šå¾—ç‰¹åˆ¥é»äººæˆ–éœ€è¦é™ªä¼´' }
                ]
            },
            {
                id: 9,
                category: 'behavior',
                question: 'ä½ çš„æ¯›å­©çš„äº’å‹•æ„é¡˜ï¼Ÿ',
                type: 'choice',
                icon: 'fa-users',
                options: [
                    { value: 'active', label: 'ä¸»å‹•äº’å‹•', desc: 'å–œæ­¡èˆ‡äººå’Œå…¶ä»–å¯µç‰©äº’å‹•' },
                    { value: 'moderate', label: 'é©åº¦äº’å‹•', desc: 'å¶çˆ¾æœƒä¸»å‹•ï¼Œä½†ä¸å¦‚ä»¥å‰' },
                    { value: 'withdrawn', label: 'è¿´é¿äº’å‹•', desc: 'ç¶“å¸¸èº²é¿æˆ–ä¸ç†äºº' }
                ]
            },
            {
                id: 10,
                category: 'physical',
                question: 'ä½ çš„æ¯›å­©çš„æ´»å‹•èƒ½åŠ›ï¼Ÿ',
                type: 'choice',
                icon: 'fa-running',
                options: [
                    { value: 'good', label: 'è‰¯å¥½', desc: 'è¡Œå‹•è‡ªå¦‚ï¼Œæ²’æœ‰æ˜é¡¯å•é¡Œ' },
                    { value: 'moderate', label: 'ä¸­ç­‰', desc: 'è¡Œå‹•ç¨æ…¢ï¼Œå¶çˆ¾ä¸ç©©' },
                    { value: 'limited', label: 'å—é™', desc: 'æœ‰é—œç¯€å•é¡Œæˆ–è¡Œå‹•å›°é›£' }
                ]
            },
            {
                id: 11,
                category: 'physical',
                question: 'ä½ çš„æ¯›å­©çš„è¦–åŠ›å’Œè½åŠ›ï¼Ÿ',
                type: 'multi-choice',
                icon: 'fa-eye',
                options: [
                    { value: 'normal', label: 'è¦–åŠ›å’Œè½åŠ›éƒ½æ­£å¸¸' },
                    { value: 'vision_decline', label: 'è¦–åŠ›é€€åŒ–' },
                    { value: 'hearing_decline', label: 'è½åŠ›é€€åŒ–' },
                    { value: 'both_decline', label: 'è¦–åŠ›å’Œè½åŠ›éƒ½é€€åŒ–' }
                ]
            },
            {
                id: 12,
                category: 'preference',
                question: 'ä½ çš„æ¯›å­©æœ€å–œæ­¡çš„æ´»å‹•é¡å‹ï¼Ÿ',
                type: 'multi-choice',
                icon: 'fa-puzzle-piece',
                options: [
                    { value: 'sniffing', label: 'å—…èæ¢ç´¢' },
                    { value: 'fetch', label: 'è¿½é€æ’¿æ‹¾' },
                    { value: 'puzzle', label: 'è§£è¬éŠæˆ²' },
                    { value: 'chewing', label: 'å’€åš¼ç©å…·' },
                    { value: 'quiet', label: 'å®‰éœé™ªä¼´' }
                ]
            },
            {
                id: 13,
                category: 'preference',
                question: 'ä½ å¸Œæœ›ç›Šæ™ºç©å…·èƒ½å¹«åŠ©æ”¹å–„ä»€éº¼ï¼Ÿ',
                type: 'multi-choice',
                icon: 'fa-target',
                options: [
                    { value: 'memory', label: 'è¨˜æ†¶åŠ›' },
                    { value: 'focus', label: 'å°ˆæ³¨åŠ›' },
                    { value: 'anxiety', label: 'ç„¦æ…®æƒ…ç·’' },
                    { value: 'boredom', label: 'ç„¡èŠæ„Ÿ' },
                    { value: 'interaction', label: 'äº’å‹•æ„é¡˜' }
                ]
            }
        ];
        
        // Quiz State
        let currentQuestion = 0;
        let answers = {};
        let quizStarted = false;
        
        // Start Quiz
        function startQuiz() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            document.getElementById('nav-buttons').style.display = 'flex';
            quizStarted = true;
            showQuestion(0);
        }
        
        // Show Question
        function showQuestion(index) {
            const question = quizData[index];
            const questionScreen = document.getElementById('question-screen');
            
            let optionsHTML = '';
            
            if (question.type === 'text' || question.type === 'number') {
                optionsHTML = `
                    <input 
                        type="${question.type}" 
                        id="answer-input"
                        class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl text-lg focus:outline-none transition"
                        style="focus:border-color: #FF8C42;"
                        placeholder="${question.placeholder}"
                        ${question.min ? `min="${question.min}"` : ''}
                        ${question.max ? `max="${question.max}"` : ''}
                        value="${answers[question.id] || ''}"
                        onkeypress="if(event.key === 'Enter') nextQuestion()"
                    >
                    ${question.hint ? `<p class="text-sm text-gray-500 mt-2"><i class="fas fa-info-circle mr-1"></i>${question.hint}</p>` : ''}
                    ${question.unit ? `<span class="text-gray-500 mt-2 inline-block">${question.unit}</span>` : ''}
                `;
            } else if (question.type === 'choice') {
                optionsHTML = question.options.map(option => `
                    <div class="answer-option ${answers[question.id] === option.value ? 'selected' : ''}" 
                         onclick="selectOption('${option.value}')"
                         style="${answers[question.id] === option.value ? 'border-color: #FF8C42; background-color: #fff5f0;' : ''}">
                        <div class="flex items-center">
                            ${option.icon ? `<i class="fas ${option.icon} text-2xl mr-4" style="color: #FF8C42;"></i>` : ''}
                            <div class="flex-1">
                                <div class="font-semibold text-lg">${option.label}</div>
                                ${option.desc ? `<div class="text-sm text-gray-600 mt-1">${option.desc}</div>` : ''}
                            </div>
                            <i class="fas fa-check-circle text-2xl ${answers[question.id] === option.value ? '' : 'opacity-0'}" style="color: #FF8C42;"></i>
                        </div>
                    </div>
                `).join('');
            } else if (question.type === 'multi-choice') {
                optionsHTML = question.options.map(option => `
                    <div class="answer-option ${(answers[question.id] || []).includes(option.value) ? 'selected' : ''}" 
                         onclick="toggleMultiOption('${option.value}')"
                         style="${(answers[question.id] || []).includes(option.value) ? 'border-color: #FF8C42; background-color: #fff5f0;' : ''}">
                        <div class="flex items-center">
                            <div class="flex-1">
                                <div class="font-semibold">${option.label}</div>
                            </div>
                            <input type="checkbox" 
                                   class="custom-checkbox" 
                                   ${(answers[question.id] || []).includes(option.value) ? 'checked' : ''}
                                   onchange="event.stopPropagation()">
                        </div>
                    </div>
                `).join('');
            }
            
            questionScreen.innerHTML = `
                <div class="mb-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center mr-4" style="background: linear-gradient(135deg, #FF8C42, #FFD93D);">
                            <i class="fas ${question.icon} text-white text-xl"></i>
                        </div>
                        <span class="text-sm font-semibold text-gray-500">å•é¡Œ ${index + 1} / ${quizData.length}</span>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">${question.question}</h2>
                    ${question.subtitle ? `<p class="text-gray-600 mb-2">${question.subtitle}</p>` : ''}
                    ${question.required === false ? '<p class="text-sm text-gray-500">ï¼ˆé¸å¡«ï¼‰</p>' : ''}
                </div>
                <div class="space-y-3">
                    ${optionsHTML}
                </div>
            `;
            
            // Update progress
            updateProgress(index);
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            const nextBtn = document.getElementById('next-btn');
            nextBtn.innerHTML = index === quizData.length - 1 ? 'æŸ¥çœ‹çµæœ <i class="fas fa-arrow-right ml-2"></i>' : 'ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right ml-2"></i>';
            
            // Auto-focus input
            if (question.type === 'text' || question.type === 'number') {
                setTimeout(() => document.getElementById('answer-input')?.focus(), 100);
            }
        }
        
        // Update Progress
        function updateProgress(index) {
            const progress = ((index + 1) / quizData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `æ­¥é©Ÿ ${index + 1} / ${quizData.length}`;
            document.getElementById('progress-percentage').textContent = Math.round(progress) + '%';
        }
        
        // Select Option (Single Choice)
        function selectOption(value) {
            const question = quizData[currentQuestion];
            answers[question.id] = value;
            showQuestion(currentQuestion);
            setTimeout(() => nextQuestion(), 300);
        }
        
        // Toggle Multi Option (Multiple Choice)
        function toggleMultiOption(value) {
            const question = quizData[currentQuestion];
            if (!answers[question.id]) {
                answers[question.id] = [];
            }
            
            const index = answers[question.id].indexOf(value);
            if (index > -1) {
                answers[question.id].splice(index, 1);
            } else {
                if (value === 'none' || value === 'normal') {
                    answers[question.id] = [value];
                } else {
                    const noneIndex = answers[question.id].indexOf('none');
                    if (noneIndex > -1) answers[question.id].splice(noneIndex, 1);
                    const normalIndex = answers[question.id].indexOf('normal');
                    if (normalIndex > -1) answers[question.id].splice(normalIndex, 1);
                    answers[question.id].push(value);
                }
            }
            
            showQuestion(currentQuestion);
        }
        
        // é©—è­‰ç­”æ¡ˆ
        function validateAnswer(question, answer) {
            // é©—è­‰å¹´ç´€ï¼ˆå•é¡Œ 3 - å…·é«”å¹´é½¡ï¼‰
            if (question.id === 3) {
                const age = parseFloat(answer);
                if (isNaN(age) || age <= 0) {
                    return { valid: false, message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„å¹´é½¡' };
                }
                if (age > 30) {
                    return { valid: false, message: 'å¹´ç´€ä¸èƒ½è¶…é 30 æ­²ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º' };
                }
                if (age < 1) {
                    return { valid: false, message: 'å¹´é½¡éå°ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º' };
                }
                return { valid: true };
            }
            
            return { valid: true };
        }
        
        // Next Question
        function nextQuestion() {
            const question = quizData[currentQuestion];
            let answerValue = null;
            
            if (question.type === 'text' || question.type === 'number') {
                const input = document.getElementById('answer-input');
                if (input && input.value.trim()) {
                    answerValue = input.value.trim();
                    answers[question.id] = answerValue;
                } else if (question.required !== false) {
                    alert('è«‹å¡«å¯«ç­”æ¡ˆ');
                    return;
                } else {
                    // é¸å¡«é¡Œï¼Œå…è¨±ç©ºç™½
                    answers[question.id] = '';
                }
            } else if (!answers[question.id] && question.required !== false) {
                alert('è«‹é¸æ“‡ç­”æ¡ˆ');
                return;
            } else {
                answerValue = answers[question.id];
            }
            
            // åŸ·è¡Œé©—è­‰
            if (answerValue !== null && answerValue !== '') {
                const validation = validateAnswer(question, answerValue);
                if (!validation.valid) {
                    alert(validation.message);
                    return;
                }
            }
            
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                finishQuiz();
            }
        }
        
        // Previous Question
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }
        
        // Finish Quiz
        function finishQuiz() {
            document.getElementById('question-screen').style.display = 'none';
            document.getElementById('nav-buttons').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'block';
            
            localStorage.setItem('toyQuizAnswers', JSON.stringify(answers));
            
            // ä¿å­˜æ¸¬é©—çµæœåˆ°æ•¸æ“šç³»çµ±
            setTimeout(() => {
                if (window.saveQuizResult) {
                    const quizData = {
                        quizType: 'toy',
                        petInfo: {
                            age: answers.age || 'unknown'
                        },
                        answers: answers,
                        result: {
                            category: 'toy_quiz',
                            completedAt: new Date().toISOString()
                        }
                    };
                    window.saveQuizResult(quizData);
                    console.log('âœ… ç©å…·æ¸¬é©—çµæœå·²ä¿å­˜');
                }
                
                // Redirect to results
                window.location.href = 'quiz-result.html?type=toy';
            }, 3000);
        }
        
        // Prevent accidental page leave
        window.addEventListener('beforeunload', function(e) {
            if (quizStarted && currentQuestion < quizData.length - 1) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
    
</body>
</html>
