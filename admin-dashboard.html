<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>儀表板 - 匠寵後台管理系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .sidebar {
            transition: all 0.3s ease;
        }
        
        .sidebar-collapsed {
            width: 80px;
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background: rgba(230, 57, 70, 0.1);
            border-left: 4px solid #E63946;
        }
        
        .sidebar-item.active {
            background: rgba(230, 57, 70, 0.15);
            border-left: 4px solid #E63946;
            font-weight: 600;
        }
        
        .kpi-card {
            transition: all 0.3s ease;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .trend-up {
            color: #10B981;
        }
        
        .trend-down {
            color: #EF4444;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 頂部導航欄 -->
    <nav class="bg-white border border-gray-200 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between px-6 py-4">
            <!-- Logo & 標題 -->
            <div class="flex items-center space-x-4">
                <button onclick="toggleSidebar()" class="text-gray-600 hover:text-gray-800 lg:hidden">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-400 rounded-xl flex items-center justify-center">
                        <i class="fas fa-paw text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">匠寵後台</h1>
                        <p class="text-xs text-gray-500">管理系統</p>
                    </div>
                </div>
            </div>

            <!-- 右側功能 -->
            <div class="flex items-center space-x-4">
                <!-- 搜尋 -->
                <div class="hidden md:block relative">
                    <input 
                        type="text" 
                        placeholder="搜尋..." 
                        class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent w-64"
                    >
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>

                <!-- 通知 -->
                <button class="relative text-gray-600 hover:text-gray-800">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">
                        3
                    </span>
                </button>

                <!-- 用戶選單 -->
                <div class="flex items-center space-x-3 border-l pl-4">
                    <div class="hidden md:block text-right">
                        <p class="text-sm font-semibold text-gray-800" id="adminName">超級管理員</p>
                        <p class="text-xs text-gray-500" id="adminRole">Super Admin</p>
                    </div>
                    <button onclick="showUserMenu()" class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">A</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 側邊欄 -->
    <aside id="sidebar" class="sidebar fixed left-0 top-16 bottom-0 w-64 bg-white border border-gray-200 overflow-y-auto z-40">
    <div class="p-4">
        <nav class="space-y-2">
            <a href="admin-dashboard.html" class="sidebar-item active flex items-center space-x-3 px-4 py-3 rounded-lg">
                <i class="fas fa-chart-line text-lg w-6"></i>
                <span>儀表板</span>
            </a>
            <div class="sidebar-section">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">用戶管理</p>
                <a href="admin-users.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-users text-lg w-6"></i>
                    <span>用戶列表</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">商品管理</p>
                <a href="admin-products.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-box text-lg w-6"></i>
                    <span>產品列表</span>
                </a>
                <a href="admin-orders.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-shopping-cart text-lg w-6"></i>
                    <span>訂單管理</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">15</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">物流管理</p>
                <a href="admin-shipping.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-shipping-fast text-lg w-6"></i>
                    <span>物流設定</span>
                </a>
                <a href="checkout.html" target="_blank" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-truck text-lg w-6"></i>
                    <span>測試結帳流程</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">測驗系統</p>
                <a href="admin-quizzes.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-clipboard-list text-lg w-6"></i>
                    <span>測驗列表</span>
                </a>
                <a href="admin-quiz-stats.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-chart-pie text-lg w-6"></i>
                    <span>測驗統計</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">訂閱服務</p>
                <a href="admin-subscription-management.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-sync-alt text-lg w-6"></i>
                    <span>訂閱管理</span>
                </a>
                <a href="admin-subscription-options.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-list-alt text-lg w-6"></i>
                    <span>訂閱選項</span>
                </a>
                <a href="admin-jar-program.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-recycle text-lg w-6"></i>
                    <span>換罐計畫</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">數據分析</p>
                <a href="admin-analytics.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-chart-bar text-lg w-6"></i>
                    <span>營收報表</span>
                </a>
            </div>
            <div class="sidebar-section mt-4">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">系統設定</p>
                
                <a href="admin-website-settings.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-palette text-lg w-6"></i>
                    <span>網站佈局</span>
                </a>
                <a href="admin-payment.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-credit-card text-lg w-6"></i>
                    <span>金流設定</span>
                </a>
                <a href="admin-settings.html" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-cog text-lg w-6"></i>
                    <span>系統設定</span>
                </a>
                <a href="admin-login.html" onclick="logout()" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600">
                    <i class="fas fa-sign-out-alt text-lg w-6"></i>
                    <span>登出</span>
                </a>
            </div>
        </nav>
    </div>
</aside>

    <!-- 主要內容區 -->
    <main class="ml-64 mt-16 p-6">
        <!-- 頁面標題與標籤頁切換 -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">儀表板</h2>
                    <p class="text-gray-600 mt-1">歡迎回來，<span id="welcomeName">管理員</span>！</p>
                </div>
                <!-- 標籤頁切換 -->
                <div class="flex items-center space-x-2 bg-gray-100 rounded-lg p-1">
                    <button onclick="switchTab('overview')" id="tab-overview" class="tab-btn px-6 py-2 rounded-md font-semibold transition-colors bg-white text-gray-800 shadow-sm">
                        <i class="fas fa-chart-line mr-2"></i>數據概覽
                    </button>
                    <button onclick="switchTab('content')" id="tab-content" class="tab-btn px-6 py-2 rounded-md font-semibold transition-colors text-gray-600 hover:text-gray-800">
                        <i class="fas fa-edit mr-2"></i>首頁內容管理
                    </button>
                </div>
            </div>
        </div>

        <!-- 數據概覽標籤頁 -->
        <div id="overview-tab" class="tab-content">
        <!-- KPI 卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- 今日營收 -->
            <div class="kpi-card bg-white rounded-2xl shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" onclick="window.location.href='admin-analytics.html'">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-white text-xl"></i>
                    </div>
                    <span class="trend-up text-sm font-semibold">
                        <i class="fas fa-arrow-up"></i> 12.5%
                    </span>
                </div>
                <p class="text-gray-600 text-sm mb-1">今日營收</p>
                <p class="text-3xl font-bold text-gray-800">NT$ 48,520</p>
                <p class="text-xs text-gray-500 mt-2">較昨日增加 NT$ 5,400</p>
            </div>

            <!-- 新增會員 -->
            <div class="kpi-card bg-white rounded-2xl shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" onclick="window.location.href='admin-users.html'">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-user-plus text-white text-xl"></i>
                    </div>
                    <span class="trend-up text-sm font-semibold">
                        <i class="fas fa-arrow-up"></i> 8.3%
                    </span>
                </div>
                <p class="text-gray-600 text-sm mb-1">新增會員</p>
                <p class="text-3xl font-bold text-gray-800">23</p>
                <p class="text-xs text-gray-500 mt-2">本週新增 156 人</p>
            </div>

            <!-- 待處理訂單 -->
            <div class="kpi-card bg-white rounded-2xl shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" onclick="window.location.href='admin-orders.html'">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-shopping-cart text-white text-xl"></i>
                    </div>
                    <span class="trend-down text-sm font-semibold">
                        <i class="fas fa-arrow-down"></i> 5.2%
                    </span>
                </div>
                <p class="text-gray-600 text-sm mb-1">待處理訂單</p>
                <p class="text-3xl font-bold text-gray-800">15</p>
                <p class="text-xs text-gray-500 mt-2">需儘快處理</p>
            </div>

            <!-- 完成測驗 -->
            <div class="kpi-card bg-white rounded-2xl shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" onclick="window.location.href='admin-quiz-stats.html'">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-clipboard-check text-white text-xl"></i>
                    </div>
                    <span class="trend-up text-sm font-semibold">
                        <i class="fas fa-arrow-up"></i> 15.8%
                    </span>
                </div>
                <p class="text-gray-600 text-sm mb-1">完成測驗</p>
                <p class="text-3xl font-bold text-gray-800">89</p>
                <p class="text-xs text-gray-500 mt-2">本月共 342 份</p>
            </div>
        </div>

        <!-- 圖表區 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- 營收趨勢圖 -->
            <div class="bg-white rounded-2xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">營收趨勢 (過去 30 天)</h3>
                <canvas id="revenueChart"></canvas>
            </div>

            <!-- 產品銷售排行 -->
            <div class="bg-white rounded-2xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">產品銷售排行 (本月)</h3>
                <canvas id="productChart"></canvas>
            </div>
        </div>

        <!-- 最新動態 & 待辦事項 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- 最新動態 -->
            <div class="bg-white rounded-2xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-clock text-blue-500 mr-2"></i>
                    最新動態
                </h3>
                <div class="space-y-4">
                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-shopping-cart text-green-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">新訂單 #12345</p>
                            <p class="text-xs text-gray-600">張小明購買了壕大大雞排 x 3</p>
                            <p class="text-xs text-gray-400 mt-1">5 分鐘前</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user-plus text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">新會員註冊</p>
                            <p class="text-xs text-gray-600">李小華加入會員</p>
                            <p class="text-xs text-gray-400 mt-1">15 分鐘前</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition">
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-clipboard-check text-purple-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">完成測驗</p>
                            <p class="text-xs text-gray-600">王大明為毛毛完成營養測驗</p>
                            <p class="text-xs text-gray-400 mt-1">1 小時前</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition">
                        <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-sync-alt text-orange-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">訂閱續訂</p>
                            <p class="text-xs text-gray-600">陳小美的營養罐訂閱已續訂</p>
                            <p class="text-xs text-gray-400 mt-1">2 小時前</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <a href="#" class="text-sm text-blue-500 hover:text-blue-600 font-semibold">
                        查看全部 <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- 待辦事項 -->
            <div class="bg-white rounded-2xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-tasks text-orange-500 mr-2"></i>
                    待辦事項
                </h3>
                <div class="space-y-3">
                    <div class="flex items-center space-x-3 p-3 border border-red-200 bg-red-50 rounded-lg">
                        <input type="checkbox" class="w-5 h-5 text-red-500 rounded">
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">處理 15 筆待確認訂單</p>
                            <p class="text-xs text-red-600 mt-1">
                                <i class="fas fa-exclamation-circle mr-1"></i>緊急
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3 p-3 border border-orange-200 bg-orange-50 rounded-lg">
                        <input type="checkbox" class="w-5 h-5 text-orange-500 rounded">
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">回覆 8 則客戶詢問</p>
                            <p class="text-xs text-orange-600 mt-1">
                                <i class="fas fa-clock mr-1"></i>今日內完成
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3 p-3 border border-gray-200 bg-gray-50 rounded-lg">
                        <input type="checkbox" class="w-5 h-5 text-gray-500 rounded">
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">更新產品庫存資訊</p>
                            <p class="text-xs text-gray-600 mt-1">
                                <i class="fas fa-info-circle mr-1"></i>一般
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3 p-3 border border-gray-200 bg-gray-50 rounded-lg">
                        <input type="checkbox" class="w-5 h-5 text-gray-500 rounded">
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800">審核新會員申請</p>
                            <p class="text-xs text-gray-600 mt-1">
                                <i class="fas fa-info-circle mr-1"></i>一般
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <button class="w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-500 transition">
                        <i class="fas fa-plus mr-2"></i>新增待辦事項
                    </button>
                </div>
            </div>
        </div>
        </div>
        <!-- 結束數據概覽標籤頁 -->

        <!-- 首頁內容管理標籤頁 -->
        <div id="content-tab" class="tab-content hidden">
            <!-- 快速操作 -->
            <div class="bg-white rounded-2xl border border-gray-200 p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button onclick="addNewBlock()" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                            <i class="fas fa-plus mr-2"></i>新增區塊
                        </button>
                        <button onclick="resetToDefault()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            <i class="fas fa-undo mr-2"></i>恢復預設
                        </button>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="previewWebsite()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">
                            <i class="fas fa-eye mr-2"></i>預覽網站
                        </button>
                        <button onclick="publishChanges()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                            <i class="fas fa-upload mr-2"></i>發布更新
                        </button>
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-info-circle mr-1"></i>
                            最後更新: <span id="lastUpdate">2024-12-21 14:30</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 內容區塊列表 -->
            <div class="space-y-4" id="contentBlocks">
                <!-- 區塊將動態載入 -->
            </div>
            
            <!-- 首頁內容管理功能將在此處動態載入 -->
            <div id="content-management-placeholder" class="text-center py-12">
                <div class="bg-white rounded-2xl border border-gray-200 p-8 max-w-2xl mx-auto">
                    <i class="fas fa-edit text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">首頁內容管理</h3>
                    <p class="text-gray-600 mb-6">管理前台首頁的各個內容區塊</p>
                    <button onclick="window.location.href='admin-homepage.html'" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                        <i class="fas fa-external-link-alt mr-2"></i>前往完整功能頁面
                    </button>
                    <p class="text-xs text-gray-500 mt-4">提示：完整的區塊編輯功能請在專用頁面使用</p>
                </div>
            </div>
        </div>
        <!-- 結束首頁內容管理標籤頁 -->
    </main>

    <!-- 引入數據管理系統 -->
    <script src="js/data-store.js"></script>
    <script src="js/mock-data.js"></script>
    
    <!-- 首頁配置管理系統（僅在需要時載入） -->
    <script src="js/config.js"></script>
    <script src="js/homepage-config.js"></script>

    <script>
        // 標籤頁切換功能
        function switchTab(tabName) {
            // 隱藏所有標籤頁內容
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // 重置所有標籤按鈕樣式
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-gray-800', 'shadow-sm');
                btn.classList.add('text-gray-600');
            });
            
            // 顯示選中的標籤頁
            const targetTab = document.getElementById(`${tabName}-tab`);
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // 設置按鈕樣式
            const targetBtn = document.getElementById(`tab-${tabName}`);
            if (targetBtn) {
                targetBtn.classList.remove('text-gray-600');
                targetBtn.classList.add('bg-white', 'text-gray-800', 'shadow-sm');
            }
            
            // 如果切換到內容管理，載入功能
            if (tabName === 'content') {
                loadContentManagement();
            }
        }
        
        // 載入首頁內容管理功能
        function loadContentManagement() {
            // 檢查是否已經載入
            if (window.contentManagementLoaded) {
                return;
            }
            
            // 這裡可以動態載入 admin-homepage.html 的功能
            // 或者將功能直接嵌入到 dashboard
            console.log('載入首頁內容管理功能...');
            
            // 標記為已載入
            window.contentManagementLoaded = true;
            
            // 如果是第一次載入，初始化內容管理
            if (window.HomepageConfig && typeof renderBlocksFromConfig === 'function') {
                const config = window.HomepageConfig.getHomepageConfig();
                renderBlocksFromConfig(config);
            }
        }
        
        // 首頁內容管理的快捷函數（重定向到完整頁面）
        function addNewBlock() {
            window.location.href = 'admin-homepage.html';
        }
        
        function resetToDefault() {
            if (confirm('確定要恢復預設配置嗎？')) {
                window.location.href = 'admin-homepage.html';
            }
        }
        
        function previewWebsite() {
            window.open('index.html', '_blank');
        }
        
        function publishChanges() {
            window.location.href = 'admin-homepage.html';
        }
        
        function loadContentManagement() {
            // 重定向到完整的首頁內容管理頁面
            window.location.href = 'admin-homepage.html';
        }
        
        // 檢查登入狀態
        window.addEventListener('DOMContentLoaded', () => {
            const adminUser = JSON.parse(localStorage.getItem('adminUser'));
            
            if (!adminUser) {
                // 未登入，導向登入頁
                window.location.href = 'admin-login.html';
            } else {
                // 顯示用戶資訊
                document.getElementById('adminName').textContent = adminUser.name;
                document.getElementById('welcomeName').textContent = adminUser.name;
                
                const roleMap = {
                    'super_admin': 'Super Admin',
                    'admin': 'Admin',
                    'customer_service': 'Customer Service',
                    'warehouse': 'Warehouse'
                };
                document.getElementById('adminRole').textContent = roleMap[adminUser.role] || adminUser.role;
                
                // 載入即時數據
                loadRealTimeData();
            }
        });

        // 登出功能
        function logout() {
            if (confirm('確定要登出嗎？')) {
                localStorage.removeItem('adminUser');
                localStorage.removeItem('adminToken');
                window.location.href = 'admin-login.html';
            }
        }

        // 切換側邊欄（手機版）
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }

        // 顯示用戶選單
        function showUserMenu() {
            alert('用戶選單功能開發中');
        }

        // 載入即時數據
        function loadRealTimeData() {
            const stats = window.StatsService.getTodayStats();
            const monthStats = window.StatsService.getMonthStats();
            
            // 更新 KPI 卡片數據
            updateKPICards(stats, monthStats);
            
            // 繪製圖表
            drawRevenueChart();
            drawProductChart();
        }

        // 更新 KPI 卡片
        function updateKPICards(stats, monthStats) {
            // 今日營收
            document.querySelector('.kpi-card:nth-child(1) .text-3xl').textContent = 
                'NT$ ' + stats.todayRevenue.toLocaleString();
            
            // 新增會員
            document.querySelector('.kpi-card:nth-child(2) .text-3xl').textContent = 
                stats.todayNewUsers;
            
            // 待處理訂單
            document.querySelector('.kpi-card:nth-child(3) .text-3xl').textContent = 
                stats.pendingOrders;
            
            // 完成測驗
            document.querySelector('.kpi-card:nth-child(4) .text-3xl').textContent = 
                stats.todayQuizzes;
            document.querySelector('.kpi-card:nth-child(4) .text-xs').textContent = 
                `本月共 ${monthStats.monthQuizzes} 份`;
        }

        // 營收趨勢圖
        function drawRevenueChart() {
            const revenueTrend = window.StatsService.getRevenueTrend(30);
            const labels = revenueTrend.map(d => d.date);
            const data = revenueTrend.map(d => d.revenue);
            
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            const revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '營收 (NT$)',
                        data: data,
                        borderColor: '#E63946',
                        backgroundColor: 'rgba(230, 57, 70, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'NT$ ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // 產品銷售排行圖
        function drawProductChart() {
            const topProducts = window.StatsService.getTopProducts(5);
            const labels = topProducts.map(p => p.name);
            const data = topProducts.map(p => p.salesCount);
            
            const productCtx = document.getElementById('productChart').getContext('2d');
            const productChart = new Chart(productCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                datasets: [{
                    label: '銷售數量',
                    data: data,
                    backgroundColor: [
                        'rgba(230, 57, 70, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(20, 184, 166, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(168, 85, 247, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        }
    </script>
</body>
</html>
