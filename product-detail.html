<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="åŒ å¯µ - ç”¢å“è©³æƒ…é é¢">
    <title>ç”¢å“è©³æƒ… - åŒ å¯µ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Local Cart System -->
    <script src="js/local-cart.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD93D',
                        dark: '#2C3E50',
                        light: '#F7F9FC'
                    },
                    fontFamily: {
                        'sans': ['Nunito', 'Noto Sans TC', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        * { font-family: 'Nunito', 'Noto Sans TC', sans-serif; }
        
        .product-image-main {
            transition: transform 0.3s ease;
        }
        .product-image-main:hover {
            transform: scale(1.05);
        }
        
        .thumbnail {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .thumbnail:hover {
            transform: scale(1.1);
            border-color: #FF6B6B;
        }
        .thumbnail.active {
            border-color: #FF6B6B;
            border-width: 3px;
        }
    </style>
</head>
<body class="bg-white">
    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="fixed top-0 w-full bg-white shadow-md z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- Logo -->
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="images/logo.svg" alt="åŒ å¯µ Logo" class="h-10 w-10 object-contain">
                    <span class="text-2xl font-bold text-dark">åŒ å¯µ</span>
                </a>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="products.html" class="text-dark hover:text-primary transition">ç”¢å“ç³»åˆ—</a>
                    <a href="index.html#crowdfunding" class="text-dark hover:text-primary transition">é›†è³‡é …ç›®</a>
                    <a href="index.html#quiz" class="text-dark hover:text-primary transition">æ‰¾é©åˆæ–¹æ¡ˆ</a>
                    <a href="index.html#jar-exchange" class="text-dark hover:text-primary transition">æ›ç½è¨ˆç•«</a>
                    <a href="index.html#subscription" class="text-dark hover:text-primary transition">è¨‚é–±æ–¹æ¡ˆ</a>
                    <a href="index.html#about" class="text-dark hover:text-primary transition">é—œæ–¼æˆ‘å€‘</a>
                    
                    <!-- è³¼ç‰©è»Š -->
                    <div class="flex items-center space-x-3">
                        <button onclick="toggleCart()" class="relative text-dark hover:text-primary transition">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cart-badge" class="absolute -top-2 -right-2 bg-primary text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">
                                0
                            </span>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="md:hidden text-dark">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div class="hidden md:hidden mt-4 pb-4" id="mobile-menu">
                <a href="products.html" class="block py-2 text-dark hover:text-primary transition">ç”¢å“ç³»åˆ—</a>
                <a href="index.html#crowdfunding" class="block py-2 text-dark hover:text-primary transition">é›†è³‡é …ç›®</a>
                <a href="index.html#quiz" class="block py-2 text-dark hover:text-primary transition">æ‰¾é©åˆæ–¹æ¡ˆ</a>
                <a href="index.html#jar-exchange" class="block py-2 text-dark hover:text-primary transition">æ›ç½è¨ˆç•«</a>
                <a href="index.html#subscription" class="block py-2 text-dark hover:text-primary transition">è¨‚é–±æ–¹æ¡ˆ</a>
                <a href="index.html#about" class="block py-2 text-dark hover:text-primary transition">é—œæ–¼æˆ‘å€‘</a>
            </div>
        </div>
    </nav>
    
    <!-- å°èˆªæ¬„ä½”ä½ -->
    <div class="h-20"></div>

    <!-- éºµåŒ…å±‘å°èˆª -->
    <div class="bg-white border-b border-gray-200 py-4">
        <div class="container mx-auto px-4">
            <div class="flex items-center space-x-2 text-sm">
                <a href="index.html" class="text-gray-600 hover:text-primary transition">é¦–é </a>
                <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                <a href="products.html" class="text-gray-600 hover:text-primary transition">ç”¢å“åˆ—è¡¨</a>
                <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                <span id="breadcrumb-category" class="text-gray-600">ç”¢å“åˆ†é¡</span>
                <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                <span id="breadcrumb-product" class="text-primary font-semibold">ç”¢å“åç¨±</span>
            </div>
        </div>
    </div>

    <!-- ç”¢å“è©³æƒ…å…§å®¹ -->
    <div class="container mx-auto px-4 py-8" id="product-detail-container">
        <!-- è¼‰å…¥ä¸­ -->
        <div id="loading" class="text-center py-20">
            <i class="fas fa-spinner text-4xl text-primary animate-spin"></i>
            <p class="mt-4 text-gray-600">è¼‰å…¥ä¸­...</p>
        </div>
        
        <!-- ç”¢å“ä¸å­˜åœ¨ -->
        <div id="not-found" class="hidden text-center py-20">
            <i class="fas fa-exclamation-triangle text-6xl text-gray-300 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-600 mb-2">æ‰¾ä¸åˆ°ç”¢å“</h2>
            <p class="text-gray-500 mb-6">è«‹æª¢æŸ¥ç”¢å“ ID æ˜¯å¦æ­£ç¢º</p>
            <a href="products.html" class="inline-block bg-primary text-white px-6 py-3 rounded-lg hover:bg-red-600 transition">
                <i class="fas fa-arrow-left mr-2"></i>è¿”å›ç”¢å“åˆ—è¡¨
            </a>
        </div>
        
        <!-- ç”¢å“å…§å®¹ï¼ˆå‹•æ…‹ç”Ÿæˆï¼‰ -->
        <div id="product-content" class="hidden">
            <!-- ç”¢å“ä¸»å€ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-8">
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- å·¦å´ï¼šç”¢å“åœ–ç‰‡ -->
                    <div>
                        <div class="mb-4">
                            <img id="product-main-image" src="" alt="" class="w-full rounded-lg product-image-main">
                        </div>
                        <div id="product-thumbnails" class="grid grid-cols-5 gap-2">
                            <!-- ç¸®åœ–å°‡å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- å³å´ï¼šç”¢å“è³‡è¨Š -->
                    <div>
                        <div class="mb-4">
                            <div id="product-tags" class="flex flex-wrap gap-2 mb-3">
                                <!-- æ¨™ç±¤å°‡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <h1 id="product-title" class="text-3xl md:text-4xl font-bold text-dark mb-2"></h1>
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="flex items-center">
                                    <div id="product-rating" class="flex text-yellow-400 mr-2"></div>
                                    <span id="product-rating-text" class="text-gray-600"></span>
                                </div>
                                <span class="text-gray-400">|</span>
                                <span id="product-sales" class="text-gray-600"></span>
                                <span class="text-gray-400">|</span>
                                <span id="product-reviews" class="text-gray-600"></span>
                            </div>
                        </div>
                        
                        <div class="border-t border-b border-gray-200 py-6 mb-6">
                            <div class="flex items-baseline space-x-3 mb-2">
                                <span id="product-price" class="text-4xl font-bold text-primary"></span>
                                <span id="product-original-price" class="text-2xl text-gray-400 line-through"></span>
                            </div>
                            <p id="product-description" class="text-gray-700 leading-relaxed"></p>
                        </div>
                        
                        <!-- è¦æ ¼é¸æ“‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
                        <div id="product-specs" class="mb-6 hidden">
                            <label class="block text-gray-700 font-semibold mb-3">é¸æ“‡è¦æ ¼ï¼š</label>
                            <div id="specs-options" class="flex flex-wrap gap-3">
                                <!-- è¦æ ¼é¸é …å°‡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <!-- æ•¸é‡é¸æ“‡ -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">æ•¸é‡ï¼š</label>
                            <div class="flex items-center border-2 border-gray-300 rounded-lg w-fit">
                                <button onclick="decreaseQuantity()" class="px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" id="product-quantity" value="1" min="1" 
                                       class="w-20 text-center border-x-2 border-gray-300 py-2 focus:outline-none">
                                <button onclick="increaseQuantity()" class="px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰éˆ• -->
                        <div class="flex space-x-4">
                            <button onclick="addToCart()" class="flex-1 bg-gradient-to-r from-primary to-secondary text-white px-6 py-4 rounded-lg font-bold hover:shadow-lg transition">
                                <i class="fas fa-shopping-cart mr-2"></i>åŠ å…¥è³¼ç‰©è»Š
                            </button>
                            <button onclick="buyNow()" class="flex-1 bg-orange-500 text-white px-6 py-4 rounded-lg font-bold hover:bg-orange-600 transition">
                                <i class="fas fa-bolt mr-2"></i>ç«‹å³è³¼è²·
                            </button>
                        </div>
                        
                        <!-- æœå‹™èªªæ˜ -->
                        <div class="mt-6 space-y-3 pt-6 border-t border-gray-200">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>åº«å­˜å……è¶³</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-truck text-blue-500 mr-2"></i>
                                <span>å…é‹è²»ï¼ˆæ»¿ NT$1,000ï¼‰</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-shield-alt text-purple-500 mr-2"></i>
                                <span>ä¸ƒå¤©é‘‘è³æœŸ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç”¢å“è©³ç´°è³‡è¨Š -->
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-dark mb-6">ç”¢å“è©³ç´°è³‡è¨Š</h2>
                <div id="product-details" class="prose max-w-none">
                    <!-- è©³ç´°è³‡è¨Šå°‡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç”¢å“æ•¸æ“šï¼ˆå°è±¡æ ¼å¼ï¼Œä»¥ ID ç‚º keyï¼‰
        const PRODUCTS = {
            'chicken-crisp': {
                id: 'chicken-crisp',
                name: 'æ‰‹ä½œé›è‚‰è„†ç‰‡',
                category: 'snacks',
                categoryName: 'æ‰‹ä½œé›¶é£Ÿ',
                price: 180,
                originalPrice: 250,
                images: [
                    'https://picsum.photos/800/800?random=11',
                    'https://picsum.photos/800/800?random=21',
                    'https://picsum.photos/800/800?random=31',
                    'https://picsum.photos/800/800?random=41',
                    'https://picsum.photos/800/800?random=51'
                ],
                description: 'ç²¾é¸å°ç£é›èƒ¸è‚‰ï¼Œä½æº«çƒ˜çƒ¤ä¿ç•™ç‡Ÿé¤Šï¼Œå¯Œå«è›‹ç™½è³ªï¼Œé©åˆè¨“ç·´çå‹µã€‚æ¡ç”¨æ–°é®®é›èƒ¸è‚‰ï¼Œç¶“éç²¾å¿ƒè™•ç†ï¼Œä¿ç•™é£Ÿæçš„å¤©ç„¶é¢¨å‘³å’Œç‡Ÿé¤Šåƒ¹å€¼ã€‚',
                rating: 4.8,
                sales: 856,
                reviews: 128,
                tags: ['ç†±éŠ·', 'æ¨è–¦'],
                stock: 999,
                specs: ['100g', '200g', '500g']
            },
            'sweet-potato': {
                id: 'sweet-potato',
                name: 'åœ°ç“œé¤…ä¹¾',
                category: 'snacks',
                categoryName: 'æ‰‹ä½œé›¶é£Ÿ',
                price: 150,
                originalPrice: 200,
                images: [
                    'https://picsum.photos/800/800?random=12',
                    'https://picsum.photos/800/800?random=22',
                    'https://picsum.photos/800/800?random=32',
                    'https://picsum.photos/800/800?random=42',
                    'https://picsum.photos/800/800?random=52'
                ],
                description: 'å¤©ç„¶åœ°ç“œæ‰‹å·¥è£½ä½œï¼Œç„¡æ·»åŠ ç³–åˆ†ï¼Œå¯Œå«è†³é£Ÿçº–ç¶­ï¼Œå¥åº·ç¾å‘³ã€‚é¸ç”¨å°ç£å„ªè³ªåœ°ç“œï¼Œç¶“éä½æº«çƒ˜çƒ¤ï¼Œä¿ç•™åœ°ç“œçš„å¤©ç„¶ç”œå‘³å’Œç‡Ÿé¤Šã€‚',
                rating: 4.6,
                sales: 623,
                reviews: 95,
                tags: ['æ–°å“'],
                stock: 999,
                specs: ['100g', '200g']
            },
            'beef-jerky': {
                id: 'beef-jerky',
                name: 'ç‰›è‚‰ä¹¾',
                category: 'snacks',
                categoryName: 'æ‰‹ä½œé›¶é£Ÿ',
                price: 280,
                originalPrice: 350,
                images: [
                    'https://picsum.photos/800/800?random=13',
                    'https://picsum.photos/800/800?random=23',
                    'https://picsum.photos/800/800?random=33',
                    'https://picsum.photos/800/800?random=43',
                    'https://picsum.photos/800/800?random=53'
                ],
                description: 'ç´è¥¿è˜­è‰é£¼ç‰›è‚‰ï¼Œæ…¢ç«çƒ˜çƒ¤ï¼Œå£æ„ŸQå½ˆï¼Œå¯Œå«å„ªè³ªè›‹ç™½è³ªã€‚æ¡ç”¨é ‚ç´šç´è¥¿è˜­è‰é£¼ç‰›è‚‰ï¼Œç¶“éç‰¹æ®Šå·¥è—è™•ç†ï¼Œä¿ç•™ç‰›è‚‰çš„é®®ç¾å’Œç‡Ÿé¤Šã€‚',
                rating: 4.9,
                sales: 1234,
                reviews: 201,
                tags: ['ç†±éŠ·', 'é™æ™‚å„ªæƒ '],
                stock: 999,
                specs: ['100g', '200g', '500g']
            },
            'puzzle-toy': {
                id: 'puzzle-toy',
                name: 'ç›Šæ™ºæ‹¼åœ–ç©å…·',
                category: 'toys',
                categoryName: 'ç›Šæ™ºç©å…·',
                price: 450,
                originalPrice: 600,
                images: [
                    'https://picsum.photos/800/800?random=14',
                    'https://picsum.photos/800/800?random=24',
                    'https://picsum.photos/800/800?random=34',
                    'https://picsum.photos/800/800?random=44',
                    'https://picsum.photos/800/800?random=54'
                ],
                description: 'åŸºæ–¼ç¶­ä¹Ÿç´å¤§å­¸ç ”ç©¶ï¼Œè¨“ç·´ç‹—ç‹—æ™ºåŠ›ï¼Œå»¶ç·©è€åŒ–ï¼Œå¢é€²è¦ªå­äº’å‹•ã€‚è¨­è¨ˆç²¾å·§ï¼Œé›£åº¦é©ä¸­ï¼Œé©åˆå„å¹´é½¡å±¤çš„ç‹—ç‹—ä½¿ç”¨ã€‚',
                rating: 4.7,
                sales: 432,
                reviews: 67,
                tags: ['æ¨è–¦'],
                stock: 999,
                specs: ['åˆç´š', 'ä¸­ç´š', 'é«˜ç´š']
            },
            'snuffle-mat': {
                id: 'snuffle-mat',
                name: 'å—…èå¢Š',
                category: 'toys',
                categoryName: 'ç›Šæ™ºç©å…·',
                price: 380,
                originalPrice: 500,
                images: [
                    'https://picsum.photos/800/800?random=15',
                    'https://picsum.photos/800/800?random=25',
                    'https://picsum.photos/800/800?random=35',
                    'https://picsum.photos/800/800?random=45',
                    'https://picsum.photos/800/800?random=55'
                ],
                description: 'åˆºæ¿€ç‹—ç‹—å—…è¦ºï¼Œæ¶ˆè€—ç²¾åŠ›ï¼Œæ¸›ç·©ç„¦æ…®ï¼Œé©åˆå„å¹´é½¡å±¤ã€‚æ¡ç”¨ç’°ä¿æè³ªè£½ä½œï¼Œå®‰å…¨ç„¡æ¯’ï¼Œæ˜“æ–¼æ¸…æ´—ã€‚',
                rating: 4.5,
                sales: 345,
                reviews: 52,
                tags: ['æ–°å“'],
                stock: 999,
                specs: ['å°', 'ä¸­', 'å¤§']
            },
            'memory-game': {
                id: 'memory-game',
                name: 'è¨˜æ†¶æŒ‰éˆ•çµ„',
                category: 'toys',
                categoryName: 'ç›Šæ™ºç©å…·',
                price: 580,
                originalPrice: 750,
                images: [
                    'https://picsum.photos/800/800?random=16',
                    'https://picsum.photos/800/800?random=26',
                    'https://picsum.photos/800/800?random=36',
                    'https://picsum.photos/800/800?random=46',
                    'https://picsum.photos/800/800?random=56'
                ],
                description: 'è¨“ç·´ç‹—ç‹—è¨˜æ†¶åŠ›èˆ‡åæ‡‰ï¼Œäº’å‹•æ€§å¼·ï¼Œå¢é€²äººçŠ¬é—œä¿‚ã€‚é©åˆè¨“ç·´å’ŒéŠæˆ²ï¼Œè®“ç‹—ç‹—åœ¨ç©æ¨‚ä¸­å­¸ç¿’ã€‚',
                rating: 4.8,
                sales: 567,
                reviews: 89,
                tags: ['ç†±éŠ·', 'æ¨è–¦'],
                stock: 999,
                specs: ['åŸºç¤ç‰ˆ', 'é€²éšç‰ˆ']
            },
            'subscription-basic': {
                id: 'subscription-basic',
                name: 'åŸºç¤è¨‚é–±æ–¹æ¡ˆ',
                category: 'subscription',
                categoryName: 'è¨‚é–±æ–¹æ¡ˆ',
                price: 699,
                originalPrice: 0,
                images: [
                    'https://picsum.photos/800/800?random=17',
                    'https://picsum.photos/800/800?random=27',
                    'https://picsum.photos/800/800?random=37',
                    'https://picsum.photos/800/800?random=47',
                    'https://picsum.photos/800/800?random=57'
                ],
                description: 'æ¯æœˆé…é€ 2 ç½æ–°é®®ç‡Ÿé¤Šç½é ­ï¼Œæ»¿è¶³æ¯›å­©åŸºæœ¬ç‡Ÿé¤Šéœ€æ±‚ã€‚åŒ…å«å¤šç¨®å£å‘³ï¼Œç‡Ÿé¤Šå‡è¡¡ï¼Œé©åˆæ—¥å¸¸é¤µé£Ÿã€‚',
                rating: 4.6,
                sales: 234,
                reviews: 38,
                tags: [],
                stock: 999,
                specs: []
            },
            'subscription-premium': {
                id: 'subscription-premium',
                name: 'å°Šäº«è¨‚é–±æ–¹æ¡ˆ',
                category: 'subscription',
                categoryName: 'è¨‚é–±æ–¹æ¡ˆ',
                price: 1299,
                originalPrice: 0,
                images: [
                    'https://picsum.photos/800/800?random=18',
                    'https://picsum.photos/800/800?random=28',
                    'https://picsum.photos/800/800?random=38',
                    'https://picsum.photos/800/800?random=48',
                    'https://picsum.photos/800/800?random=58'
                ],
                description: 'æ¯æœˆé…é€ 4 ç½ + é›¶é£Ÿ + ç©å…·ï¼Œå…¨æ–¹ä½ç…§é¡§æ¯›å­©å¥åº·ã€‚åŒ…å«ç‡Ÿé¤Šç½é ­ã€æ‰‹ä½œé›¶é£Ÿå’Œç›Šæ™ºç©å…·ï¼Œä¸€æ¬¡æ»¿è¶³æ‰€æœ‰éœ€æ±‚ã€‚',
                rating: 4.9,
                sales: 456,
                reviews: 72,
                tags: ['æ¨è–¦', 'ç†±éŠ·'],
                stock: 999,
                specs: []
            }
        };

        let currentProduct = null;
        let selectedImageIndex = 0;
        let selectedSpec = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“¦ ç”¢å“è©³æƒ…é åˆå§‹åŒ–...');
            
            // å¾ URL è®€å–ç”¢å“ ID
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId) {
                showNotFound();
                return;
            }
            
            // è¼‰å…¥ç”¢å“æ•¸æ“š
            loadProduct(productId);
            
            // æ›´æ–°è³¼ç‰©è»Šå¾½ç« 
            updateCartBadge();
            
            // ç›£è½è³¼ç‰©è»Šæ›´æ–°äº‹ä»¶
            window.addEventListener('cartUpdated', function() {
                updateCartBadge();
            });
        });

        // è¼‰å…¥ç”¢å“
        function loadProduct(productId) {
            currentProduct = PRODUCTS[productId];
            
            if (!currentProduct) {
                console.error('æ‰¾ä¸åˆ°ç”¢å“:', productId);
                showNotFound();
                return;
            }
            
            console.log('âœ… è¼‰å…¥ç”¢å“:', currentProduct);
            
            // éš±è—è¼‰å…¥ä¸­ï¼Œé¡¯ç¤ºç”¢å“å…§å®¹
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('product-content').classList.remove('hidden');
            
            // æ¸²æŸ“ç”¢å“è³‡è¨Š
            renderProduct();
        }

        // æ¸²æŸ“ç”¢å“è³‡è¨Š
        function renderProduct() {
            if (!currentProduct) return;
            
            // æ›´æ–°éºµåŒ…å±‘
            document.getElementById('breadcrumb-category').textContent = currentProduct.categoryName || 'ç”¢å“åˆ†é¡';
            document.getElementById('breadcrumb-product').textContent = currentProduct.name;
            
            // æ›´æ–°æ¨™é¡Œ
            document.getElementById('product-title').textContent = currentProduct.name;
            
            // æ›´æ–°æ¨™ç±¤
            const tagsContainer = document.getElementById('product-tags');
            tagsContainer.innerHTML = currentProduct.tags.map(tag => 
                `<span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-sm font-semibold">${tag}</span>`
            ).join('');
            
            // æ›´æ–°è©•åˆ†
            const rating = Math.floor(currentProduct.rating);
            const ratingContainer = document.getElementById('product-rating');
            ratingContainer.innerHTML = Array(5).fill(0).map((_, i) => 
                i < rating ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>'
            ).join('');
            document.getElementById('product-rating-text').textContent = `${currentProduct.rating} åˆ†`;
            
            // æ›´æ–°éŠ·å”®å’Œè©•åƒ¹
            document.getElementById('product-sales').textContent = `å·²å”® ${currentProduct.sales}`;
            document.getElementById('product-reviews').textContent = `${currentProduct.reviews || 0} å‰‡è©•åƒ¹`;
            
            // æ›´æ–°åƒ¹æ ¼
            document.getElementById('product-price').textContent = `NT$ ${currentProduct.price}`;
            if (currentProduct.originalPrice > 0) {
                document.getElementById('product-original-price').textContent = `NT$ ${currentProduct.originalPrice}`;
                document.getElementById('product-original-price').classList.remove('hidden');
            } else {
                document.getElementById('product-original-price').classList.add('hidden');
            }
            
            // æ›´æ–°æè¿°
            document.getElementById('product-description').textContent = currentProduct.description;
            
            // æ›´æ–°åœ–ç‰‡
            if (currentProduct.images && currentProduct.images.length > 0) {
                document.getElementById('product-main-image').src = currentProduct.images[0];
                document.getElementById('product-main-image').alt = currentProduct.name;
                
                // æ¸²æŸ“ç¸®åœ–
                const thumbnailsContainer = document.getElementById('product-thumbnails');
                thumbnailsContainer.innerHTML = currentProduct.images.map((img, index) => 
                    `<img src="${img}" alt="${currentProduct.name}" 
                          class="thumbnail w-full h-20 object-cover rounded-lg border-2 ${index === 0 ? 'active' : 'border-gray-200'}"
                          onclick="selectImage(${index})">`
                ).join('');
            } else if (currentProduct.image) {
                // å¦‚æœåªæœ‰å–®å¼µåœ–ç‰‡
                document.getElementById('product-main-image').src = currentProduct.image;
                document.getElementById('product-main-image').alt = currentProduct.name;
                document.getElementById('product-thumbnails').innerHTML = '';
            }
            
            // æ›´æ–°è¦æ ¼ï¼ˆå¦‚æœæœ‰ï¼‰
            if (currentProduct.specs && currentProduct.specs.length > 0) {
                document.getElementById('product-specs').classList.remove('hidden');
                const specsContainer = document.getElementById('specs-options');
                specsContainer.innerHTML = currentProduct.specs.map((spec, index) => 
                    `<button onclick="selectSpec('${spec}')" 
                            class="spec-option px-4 py-2 border-2 border-gray-300 rounded-lg hover:border-primary transition ${index === 0 ? 'border-primary bg-primary bg-opacity-10' : ''}">
                        ${spec}
                    </button>`
                ).join('');
                selectedSpec = currentProduct.specs[0];
            } else {
                document.getElementById('product-specs').classList.add('hidden');
            }
            
            // æ›´æ–°è©³ç´°è³‡è¨Š
            const detailsContainer = document.getElementById('product-details');
            detailsContainer.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-bold mb-4">ç”¢å“ç‰¹è‰²</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><i class="fas fa-check text-primary mr-2"></i>${currentProduct.description}</li>
                            <li><i class="fas fa-check text-primary mr-2"></i>é«˜å“è³ªåŸæ–™ï¼Œå®‰å…¨ç„¡æ·»åŠ </li>
                            <li><i class="fas fa-check text-primary mr-2"></i>é©åˆå„å¹´é½¡å±¤çš„æ¯›å­©</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">ç”¢å“è³‡è¨Š</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>åˆ†é¡ï¼š</strong>${currentProduct.categoryName}</li>
                            <li><strong>è©•åˆ†ï¼š</strong>${currentProduct.rating} / 5.0</li>
                            <li><strong>å·²å”®ï¼š</strong>${currentProduct.sales} ä»¶</li>
                            <li><strong>åº«å­˜ï¼š</strong>${currentProduct.stock === 999 ? 'å……è¶³' : currentProduct.stock}</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // é¸æ“‡åœ–ç‰‡
        function selectImage(index) {
            selectedImageIndex = index;
            if (currentProduct && currentProduct.images) {
                document.getElementById('product-main-image').src = currentProduct.images[index];
                
                // æ›´æ–°ç¸®åœ–ç‹€æ…‹
                document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                    if (i === index) {
                        thumb.classList.add('active');
                        thumb.classList.remove('border-gray-200');
                    } else {
                        thumb.classList.remove('active');
                        thumb.classList.add('border-gray-200');
                    }
                });
            }
        }

        // é¸æ“‡è¦æ ¼
        function selectSpec(spec) {
            selectedSpec = spec;
            document.querySelectorAll('.spec-option').forEach(btn => {
                if (btn.textContent.trim() === spec) {
                    btn.classList.add('border-primary', 'bg-primary', 'bg-opacity-10');
                    btn.classList.remove('border-gray-300');
                } else {
                    btn.classList.remove('border-primary', 'bg-primary', 'bg-opacity-10');
                    btn.classList.add('border-gray-300');
                }
            });
        }

        // æ•¸é‡å¢æ¸›
        function increaseQuantity() {
            const input = document.getElementById('product-quantity');
            input.value = parseInt(input.value) + 1;
        }

        function decreaseQuantity() {
            const input = document.getElementById('product-quantity');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
            }
        }

        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart() {
            if (!currentProduct) {
                console.error('æ²’æœ‰é¸æ“‡çš„ç”¢å“');
                return;
            }
            
            const quantity = parseInt(document.getElementById('product-quantity').value) || 1;
            
            console.log('ğŸ›’ åŠ å…¥è³¼ç‰©è»Š:', currentProduct, 'æ•¸é‡:', quantity);
            
            // å„ªå…ˆä½¿ç”¨å…¨å±€ addToCart å‡½æ•¸
            if (window.addToCart && typeof window.addToCart === 'function') {
                try {
                    window.addToCart(
                        currentProduct.id,
                        currentProduct.name,
                        currentProduct.price,
                        currentProduct.images ? currentProduct.images[0] : currentProduct.image || '',
                        quantity
                    );
                    updateCartBadge();
                    showNotification(`å·²åŠ å…¥è³¼ç‰©è»Šï¼š${currentProduct.name} x ${quantity}`, 'success');
                } catch (error) {
                    console.error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
                    showNotification('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                }
            }
            // å‚™ç”¨æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨ localCart
            else if (window.localCart && typeof window.localCart.addItem === 'function') {
                try {
                    window.localCart.addItem(
                        currentProduct.id,
                        currentProduct.name,
                        currentProduct.price,
                        currentProduct.images ? currentProduct.images[0] : currentProduct.image || '',
                        quantity
                    );
                    updateCartBadge();
                    showNotification(`å·²åŠ å…¥è³¼ç‰©è»Šï¼š${currentProduct.name} x ${quantity}`, 'success');
                } catch (error) {
                    console.error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
                    showNotification('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                }
            } else {
                console.error('è³¼ç‰©è»Šç³»çµ±æœªè¼‰å…¥');
                showNotification('è³¼ç‰©è»Šç³»çµ±æœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
            }
        }

        // ç«‹å³è³¼è²·
        function buyNow() {
            if (!currentProduct) {
                console.error('æ²’æœ‰é¸æ“‡çš„ç”¢å“');
                return;
            }
            
            const quantity = parseInt(document.getElementById('product-quantity').value) || 1;
            
            // å…ˆåŠ å…¥è³¼ç‰©è»Š
            addToCart();
            
            // è·³è½‰åˆ°çµå¸³é é¢
            setTimeout(() => {
                window.location.href = 'checkout.html';
            }, 500);
        }

        // åˆ‡æ›è³¼ç‰©è»Š
        function toggleCart() {
            if (window.localCart && typeof window.localCart.toggleCart === 'function') {
                window.localCart.toggleCart();
            } else {
                window.location.href = 'cart.html';
            }
        }
        
        // æ‰‹æ©Ÿç‰ˆé¸å–®åˆ‡æ›
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }

        // æ›´æ–°è³¼ç‰©è»Šå¾½ç« 
        function updateCartBadge() {
            let count = 0;
            
            if (window.localCart && typeof window.localCart.getItemCount === 'function') {
                count = window.localCart.getItemCount() || 0;
            } else {
                try {
                    const cartData = localStorage.getItem('jiangchong_cart');
                    if (cartData) {
                        const cart = JSON.parse(cartData);
                        count = cart.reduce((total, item) => {
                            return total + (parseInt(item.quantity) || 1);
                        }, 0);
                    }
                } catch (error) {
                    console.error('è®€å–è³¼ç‰©è»Šå¤±æ•—:', error);
                }
            }
            
            const badge = document.getElementById('cart-badge');
            if (badge) {
                badge.textContent = count;
                
                if (count > 0) {
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // é¡¯ç¤ºæ‰¾ä¸åˆ°ç”¢å“
        function showNotFound() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('not-found').classList.remove('hidden');
        }
    </script>
</body>
</html>

