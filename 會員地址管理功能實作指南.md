# ğŸ  æœƒå“¡åœ°å€ç®¡ç†åŠŸèƒ½ - å®Œæ•´å¯¦ä½œæŒ‡å—

## ğŸ“‹ åŠŸèƒ½èªªæ˜

æœƒå“¡å¯ä»¥ï¼š
- âœ… æ–°å¢å¤šå€‹æ”¶ä»¶åœ°å€
- âœ… ç·¨è¼¯ç¾æœ‰åœ°å€
- âœ… åˆªé™¤åœ°å€
- âœ… è¨­å®šé è¨­åœ°å€
- âœ… åœ¨çµå¸³æ™‚é¸æ“‡æ”¶ä»¶åœ°å€

---

## ğŸ—„ï¸ æ­¥é©Ÿ 1ï¼šå‰µå»ºè³‡æ–™è¡¨

### åœ¨ Railway åŸ·è¡Œ SQL

æ‰“é–‹ä½ çš„ **Mac Terminal**ï¼ŒåŸ·è¡Œï¼š

```bash
cd "/Users/ming/Desktop/keyboard clicking/p.et/ç¶²ç«™"
railway link
railway run psql
```

é€²å…¥ PostgreSQL å¾Œï¼Œè¤‡è£½è²¼ä¸Šä»¥ä¸‹ SQLï¼š

```sql
-- å‰µå»ºæœƒå“¡åœ°å€è¡¨
CREATE TABLE IF NOT EXISTS user_addresses (
    id VARCHAR(255) PRIMARY KEY,
    "userId" VARCHAR(255) NOT NULL,
    "recipientName" VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    city VARCHAR(100) NOT NULL,
    district VARCHAR(100) NOT NULL,
    address TEXT NOT NULL,
    "postalCode" VARCHAR(10),
    "isDefault" BOOLEAN DEFAULT false,
    "createdAt" BIGINT NOT NULL,
    "updatedAt" BIGINT NOT NULL,
    FOREIGN KEY ("userId") REFERENCES users(id) ON DELETE CASCADE
);

-- å‰µå»ºç´¢å¼•
CREATE INDEX idx_user_addresses_user_id ON user_addresses("userId");
CREATE INDEX idx_user_addresses_default ON user_addresses("userId", "isDefault");

-- é©—è­‰è¡¨å·²å‰µå»º
\d user_addresses

-- é€€å‡º
\q
```

---

## ğŸ”§ æ­¥é©Ÿ 2ï¼šè¨»å†Šå¾Œç«¯è·¯ç”±

ä¿®æ”¹ `backend/server.js`ï¼ŒåŠ å…¥åœ°å€è·¯ç”±ï¼š

### æ‰¾åˆ°é€™ä¸€æ®µï¼ˆå¤§ç´„åœ¨ç¬¬ 30-40 è¡Œï¼‰ï¼š

```javascript
const authRoutes = require('./routes/auth');
const productRoutes = require('./routes/products');
// ... å…¶ä»–è·¯ç”±
```

### åœ¨ä¸‹é¢åŠ å…¥ï¼š

```javascript
const addressRoutes = require('./routes/addresses');
```

### æ‰¾åˆ°é€™ä¸€æ®µï¼ˆå¤§ç´„åœ¨ç¬¬ 60-70 è¡Œï¼‰ï¼š

```javascript
app.use('/api/auth', authRoutes);
app.use('/api/products', productRoutes);
// ... å…¶ä»–è·¯ç”±
```

### åœ¨ä¸‹é¢åŠ å…¥ï¼š

```javascript
app.use('/api/addresses', addressRoutes);
```

---

## ğŸ“± æ­¥é©Ÿ 3ï¼šæ›´æ–°æœƒå“¡ä¸­å¿ƒé é¢

### æ–¹æ³• Aï¼šä¿®æ”¹ç¾æœ‰çš„ `member-center.html`

åœ¨æœƒå“¡ä¸­å¿ƒé é¢åŠ å…¥ã€Œåœ°å€ç®¡ç†ã€å€å¡Šã€‚

### æ–¹æ³• Bï¼šå‰µå»ºç¨ç«‹çš„åœ°å€ç®¡ç†é é¢

å‰µå»ºæ–°æª”æ¡ˆ `member-addresses.html`ï¼ˆå…§å®¹è¦‹ä¸‹æ–¹ï¼‰ã€‚

---

## ğŸ¨ æ­¥é©Ÿ 4ï¼šå‰ç«¯ HTML ç¯„ä¾‹

å‰µå»º `member-addresses.html`ï¼š

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å€ç®¡ç† - åŒ å¯µ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .address-list {
            display: grid;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .address-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
        }
        
        .address-card.default {
            border-color: #4CAF50;
            background-color: #f1f8f4;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .badge-primary {
            background-color: #4CAF50;
            color: white;
        }
        
        .address-info h4 {
            margin: 0.5rem 0;
        }
        
        .address-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åœ°å€ç®¡ç†</h1>
        
        <button onclick="addressManager.showAddForm()" class="btn btn-primary">
            + æ–°å¢åœ°å€
        </button>
        
        <div id="addressList" class="address-list">
            <!-- åœ°å€åˆ—è¡¨å°‡å‹•æ…‹è¼‰å…¥ -->
        </div>
    </div>

    <!-- åœ°å€è¡¨å–® Modal -->
    <div id="addressModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">æ–°å¢åœ°å€</h2>
            
            <form id="addressForm">
                <div class="form-group">
                    <label>æ”¶ä»¶äººå§“å *</label>
                    <input type="text" name="recipientName" required>
                </div>
                
                <div class="form-group">
                    <label>æ‰‹æ©Ÿè™Ÿç¢¼ *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>ç¸£å¸‚ *</label>
                    <select name="city" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                        <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                        <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                        <option value="å°ä¸­å¸‚">å°ä¸­å¸‚</option>
                        <option value="å°å—å¸‚">å°å—å¸‚</option>
                        <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                        <!-- å…¶ä»–ç¸£å¸‚ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>å€åŸŸ *</label>
                    <input type="text" name="district" required placeholder="ä¾‹å¦‚ï¼šä¸­æ­£å€">
                </div>
                
                <div class="form-group">
                    <label>è©³ç´°åœ°å€ *</label>
                    <input type="text" name="address" required placeholder="ä¾‹å¦‚ï¼šä¸­å±±è·¯123è™Ÿ4æ¨“">
                </div>
                
                <div class="form-group">
                    <label>éƒµéå€è™Ÿ</label>
                    <input type="text" name="postalCode" placeholder="ä¾‹å¦‚ï¼š100">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="isDefault">
                        è¨­ç‚ºé è¨­åœ°å€
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                    <button type="button" onclick="addressManager.closeModal()" class="btn">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å¼•å…¥ JavaScript -->
    <script src="js/api-client.js"></script>
    <script src="js/address-manager.js"></script>
</body>
</html>
```

---

## ğŸš€ æ­¥é©Ÿ 5ï¼šéƒ¨ç½²åˆ° Railway

### 1. æäº¤ä»£ç¢¼åˆ° Git

```bash
cd "/Users/ming/Desktop/keyboard clicking/p.et/ç¶²ç«™"

# æª¢æŸ¥ç‹€æ…‹
git status

# åŠ å…¥æ–°æª”æ¡ˆ
git add backend/routes/addresses.js
git add backend/migrations/add-user-addresses-table.sql
git add js/address-manager.js
git add member-addresses.html

# æäº¤
git commit -m "æ–°å¢æœƒå“¡åœ°å€ç®¡ç†åŠŸèƒ½"

# æ¨é€åˆ° GitHub
git push origin main
```

### 2. ç­‰å¾… Railway è‡ªå‹•éƒ¨ç½²ï¼ˆ2-3 åˆ†é˜ï¼‰

```bash
railway logs --tail 20
```

---

## ğŸ§ª æ­¥é©Ÿ 6ï¼šæ¸¬è©¦

### 1. åœ¨ Railway å‰µå»ºè³‡æ–™è¡¨

ï¼ˆå·²åœ¨æ­¥é©Ÿ 1 å®Œæˆï¼‰

### 2. æ¸¬è©¦å¾Œç«¯ API

```bash
# å…ˆç™»å…¥ç²å– Token
curl -X POST https://pet-taiwan-production.up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser123@example.com",
    "password": "Test123456"
  }'

# è¤‡è£½å›æ‡‰ä¸­çš„ tokenï¼Œç„¶å¾Œæ¸¬è©¦æ–°å¢åœ°å€
curl -X POST https://pet-taiwan-production.up.railway.app/api/addresses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "recipientName": "æ¸¬è©¦æ”¶ä»¶äºº",
    "phone": "0912345678",
    "city": "å°åŒ—å¸‚",
    "district": "ä¸­æ­£å€",
    "address": "ä¸­å±±è·¯123è™Ÿ",
    "postalCode": "100",
    "isDefault": true
  }'
```

### 3. æ¸¬è©¦å‰ç«¯

1. æ‰“é–‹ï¼šhttps://aa89976566.github.io/p.et-taiwan/member-addresses.html
2. ç™»å…¥
3. é»æ“Šã€Œæ–°å¢åœ°å€ã€
4. å¡«å¯«è¡¨å–®ä¸¦å„²å­˜
5. æ¸¬è©¦ç·¨è¼¯ã€åˆªé™¤ã€è¨­ç‚ºé è¨­ç­‰åŠŸèƒ½

---

## ğŸ“Š API ç«¯é»ç¸½è¦½

| æ–¹æ³• | ç«¯é» | èªªæ˜ |
|-----|------|------|
| GET | `/api/addresses` | ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰åœ°å€ |
| POST | `/api/addresses` | æ–°å¢åœ°å€ |
| PUT | `/api/addresses/:id` | æ›´æ–°åœ°å€ |
| DELETE | `/api/addresses/:id` | åˆªé™¤åœ°å€ |
| PUT | `/api/addresses/:id/set-default` | è¨­å®šé è¨­åœ°å€ |

---

## ğŸ”— åœ¨çµå¸³æµç¨‹ä¸­ä½¿ç”¨åœ°å€

### åœ¨ `checkout.html` ä¸­åŠ å…¥åœ°å€é¸æ“‡å™¨ï¼š

```javascript
// è¼‰å…¥ç”¨æˆ¶åœ°å€
async function loadUserAddresses() {
    const response = await window.ApiClient.get('/addresses');
    if (response.success) {
        const addresses = response.data.addresses;
        renderAddressSelector(addresses);
    }
}

// æ¸²æŸ“åœ°å€é¸æ“‡å™¨
function renderAddressSelector(addresses) {
    const container = document.getElementById('addressSelector');
    container.innerHTML = addresses.map(addr => `
        <label class="address-option">
            <input type="radio" name="selectedAddress" value="${addr.id}" 
                   ${addr.isDefault ? 'checked' : ''}>
            <div class="address-detail">
                <strong>${addr.recipientName}</strong>
                <p>${addr.phone}</p>
                <p>${addr.city}${addr.district}${addr.address}</p>
            </div>
        </label>
    `).join('');
}
```

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

- [ ] åœ¨ Railway å‰µå»º `user_addresses` è¡¨
- [ ] è¤‡è£½ `backend/routes/addresses.js` åˆ°å°ˆæ¡ˆ
- [ ] åœ¨ `server.js` è¨»å†Šåœ°å€è·¯ç”±
- [ ] è¤‡è£½ `js/address-manager.js` åˆ°å°ˆæ¡ˆ
- [ ] å‰µå»º `member-addresses.html`
- [ ] æäº¤ä¸¦æ¨é€åˆ° GitHub
- [ ] ç­‰å¾… Railway éƒ¨ç½²
- [ ] æ¸¬è©¦ API
- [ ] æ¸¬è©¦å‰ç«¯åŠŸèƒ½
- [ ] æ•´åˆåˆ°çµå¸³æµç¨‹

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆåœ°å€ç®¡ç†å¾Œï¼Œä½ å¯ä»¥ï¼š
1. åœ¨çµå¸³é é¢æ•´åˆåœ°å€é¸æ“‡
2. åœ¨è¨‚å–®ä¸­è¨˜éŒ„æ”¶ä»¶åœ°å€
3. æ·»åŠ åœ°å€é©—è­‰ï¼ˆéƒµéå€è™Ÿã€é›»è©±æ ¼å¼ç­‰ï¼‰
4. å¯¦ä½œã€Œä¸€éµè¤‡è£½ä¸Šæ¬¡ä½¿ç”¨çš„åœ°å€ã€åŠŸèƒ½

---

**ç›¸é—œæ–‡ä»¶ï¼š**
- `backend/routes/addresses.js` - å¾Œç«¯ API è·¯ç”±
- `js/address-manager.js` - å‰ç«¯ç®¡ç†é‚è¼¯
- `backend/migrations/add-user-addresses-table.sql` - è³‡æ–™è¡¨ SQL

---

**éœ€è¦å”åŠ©å—ï¼Ÿ** å¦‚æœæœ‰ä»»ä½•å•é¡Œï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ï¼
