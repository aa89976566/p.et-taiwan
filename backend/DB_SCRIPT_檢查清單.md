# è³‡æ–™åº«è…³æœ¬æª¢æŸ¥æ¸…å–® âœ…

## ğŸ“‹ æ‰€æœ‰è³‡æ–™åº«ç›¸é—œè…³æœ¬å’Œé…ç½®

### âœ… 1. ä¸»è¦è³‡æ–™åº«é…ç½®æ–‡ä»¶

**æ–‡ä»¶ä½ç½®**: `backend/config/database.js`
- âœ… PostgreSQL é€£æ¥é…ç½®
- âœ… SQLite é€£æ¥é…ç½®ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
- âœ… `initDatabase()` å‡½æ•¸ - è‡ªå‹•åˆå§‹åŒ–è³‡æ–™è¡¨
- âœ… `initPostgreSQL()` å‡½æ•¸ - PostgreSQL åˆå§‹åŒ–é‚è¼¯
- âœ… `initSQLite()` å‡½æ•¸ - SQLite åˆå§‹åŒ–é‚è¼¯
- âœ… è‡ªå‹•åµæ¸¬è³‡æ–™åº«é¡å‹ï¼ˆæ ¹æ“š DATABASE_URLï¼‰

**ç‹€æ…‹**: âœ… å®Œæ•´ä¸”æ­£ç¢º

---

### âœ… 2. æœå‹™å™¨å•Ÿå‹•è…³æœ¬ï¼ˆè‡ªå‹•åˆå§‹åŒ–ï¼‰

**æ–‡ä»¶ä½ç½®**: `backend/server.js`
- âœ… ç¬¬ 8 è¡Œï¼šå°å…¥ `initDatabase`
- âœ… ç¬¬ 77-78 è¡Œï¼šæœå‹™å•Ÿå‹•æ™‚è‡ªå‹•èª¿ç”¨ `initDatabase()`
- âœ… ç¬¬ 118-125 è¡Œï¼šéŒ¯èª¤è™•ç†ï¼ˆå¦‚æœåˆå§‹åŒ–å¤±æ•—æœƒé¡¯ç¤ºéŒ¯èª¤ï¼‰

**ç‹€æ…‹**: âœ… å·²é…ç½®è‡ªå‹•åˆå§‹åŒ–

---

### âœ… 3. æ‰‹å‹•åˆå§‹åŒ–è…³æœ¬

#### è…³æœ¬ A: `backend/scripts/init-db.js`
- âœ… ç°¡æ½”çš„åˆå§‹åŒ–è…³æœ¬
- âœ… èª¿ç”¨ `initDatabase()`
- âœ… åŸ·è¡Œå®Œå¾Œé—œé–‰é€£æ¥

**åŸ·è¡Œæ–¹å¼**:
```bash
npm run init-db
# æˆ–
node scripts/init-db.js
```

#### è…³æœ¬ B: `backend/scripts/setup-railway-db.js`
- âœ… å®Œæ•´çš„ Railway è¨­ç½®è…³æœ¬
- âœ… æ­¥é©Ÿ 1: æ¸¬è©¦è³‡æ–™åº«é€£ç·šï¼ˆSELECT 1ï¼‰
- âœ… æ­¥é©Ÿ 2: å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨
- âœ… æ­¥é©Ÿ 3: é©—è­‰è³‡æ–™è¡¨æ˜¯å¦å»ºç«‹æˆåŠŸ
- âœ… è©³ç´°çš„æ—¥èªŒè¼¸å‡º

**åŸ·è¡Œæ–¹å¼**:
```bash
npm run setup-db
# æˆ–
node scripts/setup-railway-db.js
```

#### è…³æœ¬ C: `backend/scripts/test-db-connection.js`
- âœ… åªæ¸¬è©¦é€£ç·šï¼ˆä¸å»ºç«‹è³‡æ–™è¡¨ï¼‰
- âœ… SELECT 1 æ¸¬è©¦
- âœ… SELECT NOW() æ¸¬è©¦
- âœ… æª¢æŸ¥ç¾æœ‰è³‡æ–™è¡¨

**åŸ·è¡Œæ–¹å¼**:
```bash
npm run test-db
# æˆ–
node scripts/test-db-connection.js
```

**ç‹€æ…‹**: âœ… æ‰€æœ‰è…³æœ¬éƒ½å·²æº–å‚™å¥½

---

### âœ… 4. package.json è…³æœ¬å‘½ä»¤

**æ–‡ä»¶ä½ç½®**: `backend/package.json`

```json
{
  "scripts": {
    "start": "node server.js",              // å•Ÿå‹•æœå‹™ï¼ˆæœƒè‡ªå‹•åˆå§‹åŒ– DBï¼‰
    "init-db": "node scripts/init-db.js",   // æ‰‹å‹•åˆå§‹åŒ–è³‡æ–™è¡¨
    "setup-db": "node scripts/setup-railway-db.js",  // å®Œæ•´è¨­ç½®ï¼ˆæ¸¬è©¦+å»ºç«‹ï¼‰
    "test-db": "node scripts/test-db-connection.js"  // åªæ¸¬è©¦é€£ç·š
  }
}
```

**ç‹€æ…‹**: âœ… æ‰€æœ‰å‘½ä»¤éƒ½å·²é…ç½®

---

### âœ… 5. è³‡æ–™è¡¨çµæ§‹

**é æœŸå»ºç«‹çš„è³‡æ–™è¡¨**ï¼ˆå…± 11 å€‹ï¼‰:

1. âœ… `users` - ç”¨æˆ¶è¡¨
2. âœ… `products` - å•†å“è¡¨
3. âœ… `product_variants` - å•†å“è¦æ ¼è¡¨
4. âœ… `orders` - è¨‚å–®è¡¨
5. âœ… `order_items` - è¨‚å–®é …ç›®è¡¨
6. âœ… `quiz_results` - æ¸¬é©—çµæœè¡¨
7. âœ… `subscriptions` - è¨‚é–±è¡¨
8. âœ… `cart_items` - è³¼ç‰©è»Šè¡¨
9. âœ… `settings` - è¨­å®šè¡¨
10. âœ… `coupons` - å„ªæƒ åˆ¸è¡¨
11. âœ… `coupon_usage` - å„ªæƒ åˆ¸ä½¿ç”¨è¨˜éŒ„è¡¨

**å®šç¾©ä½ç½®**: `backend/config/database.js` ç¬¬ 208-441 è¡Œï¼ˆPostgreSQLï¼‰å’Œç¬¬ 452-680 è¡Œï¼ˆSQLiteï¼‰

**ç‹€æ…‹**: âœ… æ‰€æœ‰è³‡æ–™è¡¨çµæ§‹å·²å®šç¾©

---

## ğŸ” é—œæ–¼æ‚¨çœ‹åˆ°çš„ Caddy æ—¥èªŒ

æ‚¨çœ‹åˆ°çš„æ—¥èªŒï¼š
```
Starting Container
maxprocs: Updating GOMAXPROCS=2
...
server running
```

é€™æ˜¯ **Caddy ä¼ºæœå™¨**çš„å•Ÿå‹•æ—¥èªŒï¼Œä¸æ˜¯ Node.js å¾Œç«¯çš„æ—¥èªŒã€‚

### å¯èƒ½çš„æƒ…æ³ï¼š

1. **Railway ä½¿ç”¨ Caddy ä½œç‚ºåå‘ä»£ç†**
   - Caddy å¯èƒ½ä½œç‚ºå‰ç«¯ Web ä¼ºæœå™¨
   - Node.js å¾Œç«¯å¯èƒ½åœ¨å¦ä¸€å€‹å®¹å™¨æˆ–é€²ç¨‹ä¸­é‹è¡Œ

2. **éœ€è¦æŸ¥çœ‹ Node.js å¾Œç«¯çš„æ—¥èªŒ**
   - åœ¨ Railway Dashboard ä¸­ï¼Œæ‰¾åˆ° "p.et-taiwan" æœå‹™
   - æŸ¥çœ‹ "Logs" æ¨™ç±¤
   - æ‡‰è©²æœƒçœ‹åˆ° Node.js çš„å•Ÿå‹•æ—¥èªŒ

3. **ç¢ºèªå¾Œç«¯æ˜¯å¦å•Ÿå‹•**
   - åœ¨ Logs ä¸­æ‡‰è©²æœƒçœ‹åˆ°ï¼š
     ```
     ğŸ” æ­£åœ¨åˆå§‹åŒ–è³‡æ–™åº«...
     ğŸ“Š è³‡æ–™åº«é¡å‹: postgresql
     ğŸ” ä½¿ç”¨ PostgreSQL è³‡æ–™åº«...
     âœ… å·²é€£æ¥åˆ° PostgreSQL è³‡æ–™åº«
     ğŸ“Š é–‹å§‹å»ºç«‹ PostgreSQL è³‡æ–™è¡¨...
     âœ… PostgreSQL é€£ç·šæ¸¬è©¦æˆåŠŸ
     æº–å‚™å»ºç«‹ 11 å€‹è³‡æ–™è¡¨...
        âœ… users å»ºç«‹æˆåŠŸ
        ...
     âœ… PostgreSQL è³‡æ–™åº«è¡¨çµæ§‹åˆå§‹åŒ–å®Œæˆ
     âœ… è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆ
     ğŸš€ åŒ å¯µå¾Œç«¯æœå‹™å™¨å·²å•Ÿå‹•
     ```

---

## âœ… çµè«–

**æ‰€æœ‰ DB script éƒ½å·²å®Œæ•´å¯«å¥½ï¼**

- âœ… è³‡æ–™åº«é…ç½®æ­£ç¢º
- âœ… è‡ªå‹•åˆå§‹åŒ–å·²é…ç½®
- âœ… æ‰‹å‹•è…³æœ¬å·²æº–å‚™
- âœ… æ‰€æœ‰è³‡æ–™è¡¨çµæ§‹å·²å®šç¾©
- âœ… npm scripts å·²é…ç½®

**ä¸‹ä¸€æ­¥**ï¼š

1. **æª¢æŸ¥ Node.js å¾Œç«¯æ—¥èªŒ**ï¼ˆåœ¨ Railway "p.et-taiwan" æœå‹™çš„ Logs æ¨™ç±¤ï¼‰
   - æ‡‰è©²æœƒçœ‹åˆ°è³‡æ–™åº«åˆå§‹åŒ–çš„è¨Šæ¯
   - å¦‚æœæ²’æœ‰çœ‹åˆ°ï¼Œè¡¨ç¤ºå¾Œç«¯å¯èƒ½æ²’æœ‰å•Ÿå‹•

2. **å¦‚æœéœ€è¦æ‰‹å‹•åŸ·è¡Œ**ï¼Œåœ¨ Railway Terminal ä¸­ï¼š
   ```bash
   cd backend
   npm run setup-db
   ```

3. **é©—è­‰è³‡æ–™è¡¨æ˜¯å¦å»ºç«‹**ï¼Œåœ¨ PostgreSQL æœå‹™çš„ Query ä»‹é¢ï¼š
   ```sql
   SELECT table_name 
   FROM information_schema.tables 
   WHERE table_schema = 'public' 
   AND table_type = 'BASE TABLE'
   ORDER BY table_name;
   ```

---

**æ‰€æœ‰è…³æœ¬éƒ½å·²æº–å‚™å¥½ï¼Œç¾åœ¨éœ€è¦ç¢ºèªå¾Œç«¯æ˜¯å¦æ­£ç¢ºå•Ÿå‹•ä¸¦åˆå§‹åŒ–è³‡æ–™åº«ï¼** ğŸš€
