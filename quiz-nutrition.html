<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="åŒ å¯µç‡Ÿé¤Šå¥åº·æ¸¬é©— - 3åˆ†é˜æ‰¾åˆ°æœ€é©åˆä½ æ¯›å­©çš„é£²é£Ÿæ–¹æ¡ˆ">
    <title>ç‡Ÿé¤Šå¥åº·æ¸¬é©— - åŒ å¯µ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - å¯æ„›åœ“é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Zen+Maru+Gothic:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Breed Data -->
    <script src="js/breed-data.js"></script>
    
    <!-- æ•¸æ“šç®¡ç†ç³»çµ± -->
    <script src="js/data-store.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/quiz-system.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD93D',
                        dark: '#2C3E50',
                        light: '#F7F9FC'
                    },
                    fontFamily: {
                        'sans': ['Zen Maru Gothic', 'Noto Sans TC', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-light">
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white shadow-md z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="flex items-center space-x-2">
                    <i class="fas fa-paw text-primary text-3xl"></i>
                    <span class="text-2xl font-bold text-dark">åŒ å¯µ</span>
                </a>
                <a href="index.html" class="text-gray-600 hover:text-primary transition">
                    <i class="fas fa-times text-2xl"></i>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-24 pb-16">
        <div class="container mx-auto px-4 max-w-4xl">
            
            <!-- Progress Bar -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-semibold text-gray-600" id="progress-text">æ­¥é©Ÿ 1 / 10</span>
                    <span class="text-sm text-gray-500" id="progress-percentage">10%</span>
                </div>
                <div class="quiz-progress">
                    <div class="quiz-progress-bar" id="progress-bar" style="width: 10%"></div>
                </div>
            </div>
            
            <!-- Quiz Container -->
            <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12" id="quiz-container">
                
                <!-- Welcome Screen -->
                <div id="welcome-screen" class="text-center">
                    <div class="relative w-32 h-32 mx-auto mb-6">
                        <div class="absolute inset-0 bg-gradient-to-r from-secondary to-teal-400 rounded-full animate-pulse opacity-20"></div>
                        <div class="relative w-32 h-32 bg-gradient-to-br from-secondary to-teal-400 rounded-full flex items-center justify-center shadow-xl">
                            <i class="fas fa-utensils text-white text-5xl"></i>
                        </div>
                    </div>
                    <div class="inline-block bg-secondary/10 text-secondary px-4 py-2 rounded-full text-sm font-bold mb-3">
                        <i class="fas fa-sparkles mr-1"></i>æ™ºèƒ½é£²é£Ÿåˆ†æ
                    </div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-3">ğŸ– æ‰¾åˆ°æœ€é©åˆçš„é£²é£Ÿæ–¹æ¡ˆ</h1>
                    <p class="text-xl text-gray-600 mb-2"><strong>3 åˆ†é˜</strong> ç°¡å–®å•ç­”ï¼ŒAI æ™ºèƒ½åˆ†æ</p>
                    <p class="text-lg text-secondary font-semibold mb-6">
                        <i class="fas fa-gift mr-1"></i>å®Œæˆå¾Œé€ <span class="text-primary">15% æŠ˜æ‰£ç¢¼</span>
                    </p>
                    
                    <div class="bg-light rounded-2xl p-6 mb-8 text-left max-w-2xl mx-auto">
                        <h3 class="font-bold text-lg mb-4 flex items-center">
                            <i class="fas fa-clipboard-list text-secondary mr-2"></i>
                            æ¸¬é©—åŒ…å«
                        </h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-secondary mr-3 mt-1"></i>
                                <span>åŸºæœ¬è³‡è¨Šï¼ˆå¹´é½¡ã€é«”é‡ã€å“ç¨®ã€æ€§åˆ¥ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-secondary mr-3 mt-1"></i>
                                <span>å¥åº·ç‹€æ³è©•ä¼°ï¼ˆéæ•ã€ç–¾ç—…ã€ç”¨è—¥æƒ…æ³ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-secondary mr-3 mt-1"></i>
                                <span>ç”Ÿæ´»å‹æ…‹åˆ†æï¼ˆæ´»å‹•é‡ã€é£²é£Ÿç¿’æ…£ï¼‰</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-secondary mr-3 mt-1"></i>
                                <span>å€‹äººåŒ–ç”¢å“æ¨è–¦</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="flex items-center justify-center gap-4 mb-8">
                        <div class="flex items-center">
                            <i class="fas fa-clock text-secondary mr-2"></i>
                            <span class="text-sm text-gray-600">ç´„ 3 åˆ†é˜</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-shield-alt text-secondary mr-2"></i>
                            <span class="text-sm text-gray-600">è³‡æ–™ä¿å¯†</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-gift text-secondary mr-2"></i>
                            <span class="text-sm text-gray-600">å®Œæˆé€å„ªæƒ </span>
                        </div>
                    </div>
                    
                    <button onclick="startQuiz()" class="bg-gradient-to-r from-secondary to-teal-500 text-white px-12 py-4 rounded-full text-lg font-bold hover:shadow-2xl transition transform hover:scale-105 relative overflow-hidden group">
                        <span class="relative z-10">ğŸš€ ç«‹å³é–‹å§‹ <i class="fas fa-arrow-right ml-2"></i></span>
                        <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition"></div>
                    </button>
                    <p class="text-xs text-gray-500 mt-4"><i class="fas fa-users mr-1"></i>å·²æœ‰ <strong>2,847</strong> ä½æ¯›çˆ¸åª½å®Œæˆæ¸¬é©—</p>
                </div>
                
                <!-- Question Screens (Hidden by default) -->
                <div id="question-screen" class="hidden">
                    <!-- Question will be dynamically inserted here -->
                </div>
                
                <!-- Loading Screen -->
                <div id="loading-screen" class="hidden text-center py-12">
                    <div class="spinner mx-auto mb-6"></div>
                    <h3 class="text-2xl font-bold mb-2">æ­£åœ¨åˆ†ææ‚¨çš„è³‡æ–™...</h3>
                    <p class="text-gray-600">è«‹ç¨å€™ï¼Œæˆ‘å€‘æ­£åœ¨ç‚ºæ‚¨é‡èº«æ‰“é€ ç‡Ÿé¤Šæ–¹æ¡ˆ</p>
                </div>
                
            </div>
            
            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-8" id="nav-buttons" style="display: none;">
                <button onclick="previousQuestion()" id="prev-btn" class="bg-gray-200 text-dark px-8 py-3 rounded-full font-semibold hover:bg-gray-300 transition">
                    <i class="fas fa-arrow-left mr-2"></i>ä¸Šä¸€é¡Œ
                </button>
                <button onclick="nextQuestion()" id="next-btn" class="bg-secondary text-white px-8 py-3 rounded-full font-semibold hover:bg-teal-600 transition">
                    ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
            
        </div>
    </main>
    
    <!-- Quiz Data & Logic -->
    <script>
        // Quiz Questions Data
        const quizData = [
            {
                id: 1,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©å«ä»€éº¼åå­—ï¼Ÿ',
                type: 'text',
                placeholder: 'è«‹è¼¸å…¥å¯µç‰©åå­—',
                icon: 'fa-dog',
                required: true
            },
            {
                id: 2,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©æ˜¯ï¼Ÿ',
                type: 'choice',
                icon: 'fa-paw',
                options: [
                    { value: 'dog', label: 'ç‹—ç‹— ğŸ•', icon: 'fa-dog' },
                    { value: 'cat', label: 'è²“å’ª ğŸ±', icon: 'fa-cat' }
                ]
            },
            {
                id: 3,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©å¹¾æ­²äº†ï¼Ÿ',
                type: 'choice',
                icon: 'fa-birthday-cake',
                options: [
                    { value: 'puppy', label: 'å¹¼å¹´æœŸï¼ˆ0-1æ­²ï¼‰', desc: 'æˆé•·ç™¼è‚²éšæ®µ' },
                    { value: 'adult', label: 'æˆå¹´æœŸï¼ˆ1-7æ­²ï¼‰', desc: 'æ´»åŠ›å……æ²›éšæ®µ' },
                    { value: 'senior', label: 'ç†Ÿé½¡æœŸï¼ˆ7æ­²ä»¥ä¸Šï¼‰', desc: 'éœ€è¦ç‰¹æ®Šç…§è­·' }
                ]
            },
            {
                id: 4,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©çš„é«”é‡ï¼Ÿ',
                type: 'number',
                icon: 'fa-weight',
                placeholder: 'è«‹è¼¸å…¥é«”é‡ï¼ˆå…¬æ–¤ï¼‰',
                unit: 'kg',
                min: 0.5,
                max: 100
            },
            {
                id: 5,
                category: 'basic',
                question: 'ä½ çš„æ¯›å­©çš„å“ç¨®ï¼Ÿ',
                type: 'text',
                icon: 'fa-dog',
                placeholder: 'ä¾‹å¦‚ï¼šæŸ´çŠ¬ã€é»ƒé‡‘çµçŠ¬ã€ç±³å…‹æ–¯...',
                required: false,
                hint: 'å¦‚æœä¸ç¢ºå®šå“ç¨®ï¼Œå¯ä»¥å¡«å¯«ã€Œç±³å…‹æ–¯ã€æˆ–ã€Œä¸ç¢ºå®šã€'
            },
            {
                id: 6,
                category: 'health',
                question: 'ä½ çš„æ¯›å­©æœ‰æ²’æœ‰ä»¥ä¸‹å¥åº·å•é¡Œï¼Ÿ',
                type: 'multi-choice',
                icon: 'fa-heartbeat',
                options: [
                    { value: 'none', label: 'æ²’æœ‰ç‰¹æ®Šå¥åº·å•é¡Œ' },
                    { value: 'allergy', label: 'é£Ÿç‰©éæ•' },
                    { value: 'digestive', label: 'æ¶ˆåŒ–å•é¡Œï¼ˆè…¹ç€‰ã€ä¾¿ç§˜ï¼‰' },
                    { value: 'skin', label: 'çš®è†šå•é¡Œ' },
                    { value: 'joint', label: 'é—œç¯€å•é¡Œ' },
                    { value: 'kidney', label: 'è…è‡Ÿå•é¡Œ' },
                    { value: 'heart', label: 'å¿ƒè‡Ÿå•é¡Œ' },
                    { value: 'diabetes', label: 'ç³–å°¿ç—…' },
                    { value: 'other', label: 'å…¶ä»–ï¼ˆè«‹å‚™è¨»ï¼‰' }
                ]
            },
            {
                id: 7,
                category: 'health',
                question: 'ä½ çš„æ¯›å­©ç›®å‰çš„é«”æ…‹ï¼Ÿ',
                type: 'choice',
                icon: 'fa-balance-scale',
                options: [
                    { value: 'underweight', label: 'éç˜¦', desc: 'è‚‹éª¨æ˜é¡¯å¯è¦‹ï¼Œç¼ºä¹è„‚è‚ªå±¤' },
                    { value: 'ideal', label: 'æ¨™æº–', desc: 'å¯æ‘¸åˆ°è‚‹éª¨ï¼Œæœ‰é©ç•¶è„‚è‚ªå±¤' },
                    { value: 'overweight', label: 'éé‡', desc: 'è‚‹éª¨ä¸æ˜“æ‘¸åˆ°ï¼Œè…°ç·šä¸æ˜é¡¯' }
                ]
            },
            {
                id: 8,
                category: 'lifestyle',
                question: 'ä½ çš„æ¯›å­©æ¯å¤©çš„æ´»å‹•é‡ï¼Ÿ',
                type: 'choice',
                icon: 'fa-running',
                options: [
                    { value: 'low', label: 'ä½æ´»å‹•é‡', desc: 'æ¯å¤©æ•£æ­¥ < 30 åˆ†é˜' },
                    { value: 'medium', label: 'ä¸­ç­‰æ´»å‹•é‡', desc: 'æ¯å¤©æ•£æ­¥ 30-60 åˆ†é˜' },
                    { value: 'high', label: 'é«˜æ´»å‹•é‡', desc: 'æ¯å¤©æ•£æ­¥ > 60 åˆ†é˜æˆ–æ¿€çƒˆé‹å‹•' }
                ]
            },
            {
                id: 9,
                category: 'lifestyle',
                question: 'ä½ çš„æ¯›å­©ç›®å‰çš„é£²é£Ÿæ–¹å¼ï¼Ÿ',
                type: 'choice',
                icon: 'fa-utensils',
                options: [
                    { value: 'kibble', label: 'ä¹¾é£¼æ–™ç‚ºä¸»', desc: 'ä¸»è¦é¤µé£Ÿä¹¾ç³§' },
                    { value: 'wet', label: 'æ¿•é£Ÿ/ç½é ­ç‚ºä¸»', desc: 'ä¸»è¦é¤µé£Ÿç½é ­æˆ–é®®é£Ÿ' },
                    { value: 'mixed', label: 'æ··åˆé¤µé£Ÿ', desc: 'ä¹¾æ¿•ç³§æ··åˆ' },
                    { value: 'raw', label: 'ç”Ÿé£Ÿ/é®®é£Ÿ', desc: 'è‡ªè£½é®®é£Ÿæˆ–ç”Ÿé£Ÿ' }
                ]
            },
            {
                id: 10,
                category: 'preference',
                question: 'ä½ æœ€åœ¨æ„çš„æ˜¯ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰',
                type: 'multi-choice',
                icon: 'fa-heart',
                options: [
                    { value: 'nutrition', label: 'ç‡Ÿé¤Šå‡è¡¡' },
                    { value: 'natural', label: 'å¤©ç„¶ç„¡æ·»åŠ ' },
                    { value: 'local', label: 'å°ç£åœ¨åœ°é£Ÿæ' },
                    { value: 'eco', label: 'ç’°ä¿æ°¸çºŒ' },
                    { value: 'convenient', label: 'æ–¹ä¾¿é¤µé£Ÿ' },
                    { value: 'price', label: 'åƒ¹æ ¼å¯¦æƒ ' }
                ]
            }
        ];
        
        // Quiz State
        let currentQuestion = 0;
        let answers = {};
        let quizStarted = false;
        
        // Start Quiz
        function startQuiz() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            document.getElementById('nav-buttons').style.display = 'flex';
            quizStarted = true;
            showQuestion(0);
        }
        
        // Show Question
        function showQuestion(index) {
            const question = quizData[index];
            const questionScreen = document.getElementById('question-screen');
            
            let optionsHTML = '';
            
            if (question.type === 'text' || question.type === 'number') {
                optionsHTML = `
                    <input 
                        type="${question.type}" 
                        id="answer-input"
                        class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl text-lg focus:border-secondary focus:outline-none transition"
                        placeholder="${question.placeholder}"
                        ${question.min ? `min="${question.min}"` : ''}
                        ${question.max ? `max="${question.max}"` : ''}
                        value="${answers[question.id] || ''}"
                        onkeypress="if(event.key === 'Enter') nextQuestion()"
                    >
                    ${question.hint ? `<p class="text-sm text-gray-500 mt-2"><i class="fas fa-info-circle mr-1"></i>${question.hint}</p>` : ''}
                    ${question.unit ? `<span class="text-gray-500 mt-2 inline-block">${question.unit}</span>` : ''}
                `;
            } else if (question.type === 'choice') {
                optionsHTML = question.options.map(option => `
                    <div class="answer-option ${answers[question.id] === option.value ? 'selected' : ''}" 
                         onclick="selectOption('${option.value}')">
                        <div class="flex items-center">
                            ${option.icon ? `<i class="fas ${option.icon} text-2xl text-secondary mr-4"></i>` : ''}
                            <div class="flex-1">
                                <div class="font-semibold text-lg">${option.label}</div>
                                ${option.desc ? `<div class="text-sm text-gray-600 mt-1">${option.desc}</div>` : ''}
                            </div>
                            <i class="fas fa-check-circle text-2xl text-secondary ${answers[question.id] === option.value ? '' : 'opacity-0'}"></i>
                        </div>
                    </div>
                `).join('');
            } else if (question.type === 'multi-choice') {
                optionsHTML = question.options.map(option => `
                    <div class="answer-option ${(answers[question.id] || []).includes(option.value) ? 'selected' : ''}" 
                         onclick="toggleMultiOption('${option.value}')">
                        <div class="flex items-center">
                            <div class="flex-1">
                                <div class="font-semibold">${option.label}</div>
                            </div>
                            <input type="checkbox" 
                                   class="custom-checkbox" 
                                   ${(answers[question.id] || []).includes(option.value) ? 'checked' : ''}
                                   onchange="event.stopPropagation()">
                        </div>
                    </div>
                `).join('');
            }
            
            questionScreen.innerHTML = `
                <div class="mb-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center mr-4">
                            <i class="fas ${question.icon} text-secondary text-xl"></i>
                        </div>
                        <span class="text-sm font-semibold text-gray-500">å•é¡Œ ${index + 1} / ${quizData.length}</span>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">${question.question}</h2>
                    ${question.required === false ? '<p class="text-sm text-gray-500">ï¼ˆé¸å¡«ï¼‰</p>' : ''}
                </div>
                <div class="space-y-3">
                    ${optionsHTML}
                </div>
            `;
            
            // Update progress
            updateProgress(index);
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').textContent = index === quizData.length - 1 ? 'æŸ¥çœ‹çµæœ' : 'ä¸‹ä¸€é¡Œ';
            
            // Auto-focus input
            if (question.type === 'text' || question.type === 'number') {
                setTimeout(() => document.getElementById('answer-input')?.focus(), 100);
            }
        }
        
        // Update Progress
        function updateProgress(index) {
            const progress = ((index + 1) / quizData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `æ­¥é©Ÿ ${index + 1} / ${quizData.length}`;
            document.getElementById('progress-percentage').textContent = Math.round(progress) + '%';
        }
        
        // Select Option (Single Choice)
        function selectOption(value) {
            const question = quizData[currentQuestion];
            answers[question.id] = value;
            showQuestion(currentQuestion);
            
            // Auto-advance after selection
            setTimeout(() => nextQuestion(), 300);
        }
        
        // Toggle Multi Option (Multiple Choice)
        function toggleMultiOption(value) {
            const question = quizData[currentQuestion];
            if (!answers[question.id]) {
                answers[question.id] = [];
            }
            
            const index = answers[question.id].indexOf(value);
            if (index > -1) {
                answers[question.id].splice(index, 1);
            } else {
                // Handle "none" option
                if (value === 'none') {
                    answers[question.id] = ['none'];
                } else {
                    // Remove "none" if selecting other options
                    const noneIndex = answers[question.id].indexOf('none');
                    if (noneIndex > -1) {
                        answers[question.id].splice(noneIndex, 1);
                    }
                    answers[question.id].push(value);
                }
            }
            
            showQuestion(currentQuestion);
        }
        
        // é©—è­‰ç­”æ¡ˆ
        function validateAnswer(question, answer) {
            // é©—è­‰å¹´ç´€ï¼ˆå•é¡Œ 3 - å¹´é½¡çµ„é¸æ“‡ï¼‰
            if (question.id === 3) {
                // å¦‚æœæ˜¯é¸æ“‡é¡Œï¼Œå·²ç¶“é€šéé¸æ“‡é©—è­‰
                // é€™è£¡ä¸»è¦é©—è­‰æ•¸å­—è¼¸å…¥çš„å¹´ç´€
                return { valid: true };
            }
            
            // é©—è­‰é«”é‡ï¼ˆå•é¡Œ 4ï¼‰
            if (question.id === 4) {
                const weight = parseFloat(answer);
                if (isNaN(weight) || weight <= 0) {
                    return { valid: false, message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é«”é‡ï¼ˆå…¬æ–¤ï¼‰' };
                }
                if (weight > 60) {
                    return { valid: false, message: 'é«”é‡ä¸èƒ½è¶…é 60 å…¬æ–¤ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º' };
                }
                if (weight < 0.5) {
                    return { valid: false, message: 'é«”é‡éè¼•ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º' };
                }
                return { valid: true };
            }
            
            // é©—è­‰å“ç¨®ï¼ˆå•é¡Œ 5ï¼‰
            if (question.id === 5 && answer && answer.trim()) {
                const breed = answer.trim();
                // æª¢æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
                const hasChinese = /[\u4e00-\u9fa5]/.test(breed);
                if (!hasChinese) {
                    return { valid: false, message: 'å“ç¨®å¿…é ˆå¡«å…¥ä¸­æ–‡ï¼Œä¾‹å¦‚ï¼šæŸ´çŠ¬ã€é»ƒé‡‘çµçŠ¬ã€ç±³å…‹æ–¯ç­‰' };
                }
                return { valid: true };
            }
            
            return { valid: true };
        }
        
        // Next Question
        function nextQuestion() {
            const question = quizData[currentQuestion];
            let answerValue = null;
            
            // Validate answer
            if (question.type === 'text' || question.type === 'number') {
                const input = document.getElementById('answer-input');
                if (input && input.value.trim()) {
                    answerValue = input.value.trim();
                    answers[question.id] = answerValue;
                } else if (question.required !== false) {
                    alert('è«‹å¡«å¯«ç­”æ¡ˆ');
                    return;
                } else {
                    // é¸å¡«é¡Œï¼Œå…è¨±ç©ºç™½
                    answers[question.id] = '';
                }
            } else if (!answers[question.id] && question.required !== false) {
                alert('è«‹é¸æ“‡ç­”æ¡ˆ');
                return;
            } else {
                answerValue = answers[question.id];
            }
            
            // åŸ·è¡Œé©—è­‰
            if (answerValue !== null && answerValue !== '') {
                const validation = validateAnswer(question, answerValue);
                if (!validation.valid) {
                    alert(validation.message);
                    return;
                }
            }
            
            // Move to next question or finish
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                finishQuiz();
            }
        }
        
        // Previous Question
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }
        
        // Finish Quiz
        function finishQuiz() {
            // Hide question screen and nav buttons
            document.getElementById('question-screen').style.display = 'none';
            document.getElementById('nav-buttons').style.display = 'none';
            
            // Show loading screen
            document.getElementById('loading-screen').style.display = 'block';
            
            // Store answers in localStorage
            localStorage.setItem('nutritionQuizAnswers', JSON.stringify(answers));
            
            // ä¿å­˜æ¸¬é©—çµæœåˆ°æ•¸æ“šç³»çµ±
            setTimeout(() => {
                if (window.saveQuizResult) {
                    const quizData = {
                        quizType: 'nutrition',
                        petInfo: {
                            species: answers.species,
                            age: answers.age
                        },
                        answers: answers,
                        result: {
                            category: 'nutrition_quiz',
                            completedAt: new Date().toISOString()
                        }
                    };
                    window.saveQuizResult(quizData);
                    console.log('âœ… ç‡Ÿé¤Šæ¸¬é©—çµæœå·²ä¿å­˜');
                }
                
                // Redirect to results
                window.location.href = 'quiz-result.html?type=nutrition';
            }, 3000);
        }
        
        // Prevent accidental page leave
        window.addEventListener('beforeunload', function(e) {
            if (quizStarted && currentQuestion < quizData.length - 1) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
    
</body>
</html>
