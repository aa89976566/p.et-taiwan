<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³¼ç‰©è»Š - åŒ å¯µ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- å…¨å±€é…ç½® -->
    <script src="js/config.js"></script>
    
    <!-- æ•¸æ“šç®¡ç†ç³»çµ± -->
    <script src="js/data-store.js"></script>
    <script src="js/mock-data.js"></script>
    
    <!-- è³¼ç‰©è»Šç³»çµ± -->
    <script src="js/local-cart.js"></script>
    
    <!-- ç”¢å“ç³»çµ± -->
    <script src="js/front-products.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD93D',
                        dark: '#2C3E50',
                        light: '#F7F9FC'
                    },
                    fontFamily: {
                        'sans': ['Nunito', 'Noto Sans TC', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        body { font-family: 'Noto Sans TC', 'Nunito', sans-serif; }
        .cart-item {
            transition: all 0.3s ease;
        }
        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-white">
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white shadow-md z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="images/logo.svg" alt="åŒ å¯µ Logo" class="h-10 w-10 object-contain">
                    <span class="text-2xl font-bold text-dark">åŒ å¯µ</span>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-dark hover:text-primary transition">
                        <i class="fas fa-home mr-2"></i>è¿”å›é¦–é 
                    </a>
                    <a href="javascript:void(0)" onclick="proceedToCheckout()" id="checkout-btn" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-red-600 transition hidden">
                        <i class="fas fa-shopping-bag mr-2"></i>å‰å¾€çµå¸³
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-16">
        <div class="container mx-auto px-4 max-w-6xl">
            
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-dark mb-2">
                    <i class="fas fa-shopping-cart text-primary mr-3"></i>è³¼ç‰©è»Š
                </h1>
                <p class="text-gray-600">æŸ¥çœ‹ä¸¦ç®¡ç†æ‚¨çš„è³¼ç‰©è»Šå•†å“</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- å·¦å´ï¼šè³¼ç‰©è»Šå•†å“åˆ—è¡¨ -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-md p-6">
                        <div id="cartItemsContainer" class="space-y-4">
                            <!-- è³¼ç‰©è»Šé …ç›®å°‡å‹•æ…‹è¼‰å…¥ -->
                            <div class="text-center py-12">
                                <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³å´ï¼šè¨‚å–®æ‘˜è¦ -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-md p-6 sticky top-24">
                        <h2 class="text-xl font-bold text-dark mb-6">
                            <i class="fas fa-receipt text-primary mr-2"></i>è¨‚å–®æ‘˜è¦
                        </h2>
                        
                        <div class="space-y-4 mb-6">
                            <div class="flex justify-between text-gray-600">
                                <span>å•†å“å°è¨ˆ</span>
                                <span id="cartSubtotal" class="font-semibold">NT$ 0</span>
                            </div>
                            <div class="flex justify-between text-gray-600">
                                <span>é‹è²»</span>
                                <span id="cartShipping" class="font-semibold">NT$ 0</span>
                            </div>
                            <div class="flex justify-between text-gray-600">
                                <span>æŠ˜æ‰£</span>
                                <span id="cartDiscount" class="font-semibold text-green-600">-NT$ 0</span>
                            </div>
                            <hr class="my-4">
                            <div class="flex justify-between text-xl font-bold text-dark">
                                <span>ç¸½è¨ˆ</span>
                                <span id="cartTotal" class="text-primary">NT$ 0</span>
                            </div>
                        </div>

                        <button onclick="proceedToCheckout()" id="checkout-button" class="w-full bg-primary text-white py-4 rounded-xl font-bold text-lg hover:bg-red-600 hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-shopping-bag mr-2"></i>å‰å¾€çµå¸³
                        </button>

                        <div class="mt-4 text-center">
                            <a href="index.html#products" class="text-primary hover:underline text-sm">
                                <i class="fas fa-arrow-left mr-1"></i>ç¹¼çºŒè³¼ç‰©
                            </a>
                        </div>

                        <!-- å„ªæƒ åˆ¸å€åŸŸ -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">å„ªæƒ åˆ¸</h3>
                            <div class="flex gap-2">
                                <input type="text" id="couponCode" placeholder="è¼¸å…¥å„ªæƒ ç¢¼" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                                <button onclick="applyCoupon()" class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-teal-500 transition text-sm">
                                    å¥—ç”¨
                                </button>
                            </div>
                            <p id="couponMessage" class="text-xs mt-2 text-gray-500"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let cart = [];
        let appliedCoupon = null;
        let couponDiscount = 0;

        // é é¢è¼‰å…¥
        document.addEventListener('DOMContentLoaded', function() {
            loadCart();
        });

        // è¼‰å…¥è³¼ç‰©è»Š
        function loadCart() {
            // å¾ localStorage è¼‰å…¥è³¼ç‰©è»Š
            cart = JSON.parse(localStorage.getItem('jiangchong_cart') || '[]');
            
            // éæ¿¾æ‰é›¶å…ƒå•†å“å’Œç„¡æ•ˆå•†å“
            cart = cart.filter(item => {
                const price = parseFloat(item.price) || 0;
                const productId = item.productId;
                // éæ¿¾æ‰åƒ¹æ ¼ç‚º 0 æˆ–æ²’æœ‰ productId çš„å•†å“
                return price > 0 && productId !== undefined && productId !== null && productId !== '';
            });
            
            // å„²å­˜éæ¿¾å¾Œçš„è³¼ç‰©è»Š
            if (cart.length !== JSON.parse(localStorage.getItem('jiangchong_cart') || '[]').length) {
                localStorage.setItem('jiangchong_cart', JSON.stringify(cart));
            }
            
            if (cart.length === 0) {
                renderEmptyCart();
                return;
            }

            // ç²å–å•†å“è©³æƒ…
            let products = [];
            if (window.DataStore) {
                products = window.DataStore.getAll('products');
            }

            renderCartItems(cart, products);
            updateCartSummary();
        }

        // æ¸²æŸ“ç©ºè³¼ç‰©è»Š
        function renderEmptyCart() {
            const container = document.getElementById('cartItemsContainer');
            container.innerHTML = `
                <div class="text-center py-16">
                    <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-6"></i>
                    <h3 class="text-2xl font-bold text-gray-700 mb-2">è³¼ç‰©è»Šæ˜¯ç©ºçš„</h3>
                    <p class="text-gray-500 mb-6">å¿«å»æŒ‘é¸å–œæ­¡çš„å•†å“å§ï¼</p>
                    <a href="index.html#products" class="inline-block bg-primary text-white px-8 py-3 rounded-xl font-semibold hover:bg-red-600 transition">
                        <i class="fas fa-shopping-bag mr-2"></i>å‰å¾€é¸è³¼
                    </a>
                </div>
            `;
            
            // éš±è—çµå¸³æŒ‰éˆ•
            document.getElementById('checkout-button').disabled = true;
            document.getElementById('checkout-btn').classList.add('hidden');
        }

        // æ¸²æŸ“è³¼ç‰©è»Šé …ç›®
        function renderCartItems(cartItems, products) {
            const container = document.getElementById('cartItemsContainer');
            
            if (!container) {
                console.error('æ‰¾ä¸åˆ° cartItemsContainer å…ƒç´ ');
                return;
            }
            
            // éæ¿¾æ‰é›¶å…ƒå•†å“å’Œç„¡æ•ˆå•†å“
            const validItems = cartItems.filter(item => {
                const price = parseFloat(item.price) || 0;
                const productId = item.productId;
                return price > 0 && productId !== undefined && productId !== null && productId !== '';
            });
            
            if (validItems.length === 0) {
                renderEmptyCart();
                return;
            }
            
            container.innerHTML = validItems.map(item => {
                const product = products.find(p => p.id === item.productId) || {};
                const imageUrl = item.imageUrl || item.productImageUrl || product.imageUrl || 'https://via.placeholder.com/150';
                const name = item.name || item.productName || product.name || 'å•†å“';
                const price = parseFloat(item.price) || parseFloat(product.price) || 0;
                const quantity = parseInt(item.quantity) || 1;
                const subtotal = price * quantity;

                return `
                    <div class="cart-item bg-white border border-gray-200 rounded-xl p-6">
                        <div class="flex flex-col md:flex-row gap-4">
                            <!-- å•†å“åœ–ç‰‡ -->
                            <div class="flex-shrink-0">
                                <img src="${imageUrl}" alt="${name}" class="w-24 h-24 md:w-32 md:h-32 object-cover rounded-lg">
                            </div>
                            
                            <!-- å•†å“è³‡è¨Š -->
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-dark mb-2">${name}</h3>
                                <p class="text-primary font-bold text-lg mb-4">NT$ ${price.toLocaleString()}</p>
                                
                                <!-- æ•¸é‡æ§åˆ¶ -->
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2 border border-gray-300 rounded-lg">
                                        <button onclick="updateQuantity('${String(item.productId)}', ${Math.max(1, quantity - 1)})" 
                                                class="px-4 py-2 hover:bg-gray-100 transition">
                                            <i class="fas fa-minus text-sm"></i>
                                        </button>
                                        <span class="px-4 py-2 font-semibold min-w-[3rem] text-center">${quantity}</span>
                                        <button onclick="updateQuantity('${String(item.productId)}', ${quantity + 1})" 
                                                class="px-4 py-2 hover:bg-gray-100 transition">
                                            <i class="fas fa-plus text-sm"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="text-right flex-1">
                                        <p class="text-gray-600 text-sm">å°è¨ˆ</p>
                                        <p class="text-xl font-bold text-primary">NT$ ${subtotal.toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ç§»é™¤æŒ‰éˆ• -->
                            <div class="flex-shrink-0">
                                <button onclick="removeItem('${item.productId}')" 
                                        class="text-red-500 hover:text-red-700 transition p-2">
                                    <i class="fas fa-trash text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°æ•¸é‡
        function updateQuantity(productId, newQuantity) {
            // ç¢ºä¿ productId æœ‰æ•ˆï¼ˆåŒ…æ‹¬ 0 å’Œ '0'ï¼‰
            if (productId === undefined || productId === null || productId === '') {
                console.error('updateQuantity: productId ç‚ºç©º');
                return;
            }
            
            // ç¢ºä¿ newQuantity æ˜¯æ•¸å­—
            newQuantity = parseInt(newQuantity) || 1;
            if (newQuantity < 1) {
                newQuantity = 1;
            }
            
            if (newQuantity <= 0) {
                removeItem(productId);
                return;
            }

            // ä½¿ç”¨å¤šç¨®æ–¹å¼æŸ¥æ‰¾å•†å“ï¼ˆåŒ…æ‹¬åƒ¹æ ¼ç‚º 0 çš„ï¼‰
            const item = cart.find(item => {
                return item.productId === productId || 
                       String(item.productId) === String(productId) ||
                       (item.productId != null && item.productId.toString() === String(productId));
            });
            
            if (item) {
                // ç¢ºä¿æ•¸é‡æ˜¯æ­£æ•´æ•¸ï¼ˆé¿å…å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰
                const finalQuantity = Math.max(1, parseInt(newQuantity) || 1);
                // ç¢ºä¿å­˜å„²ç‚ºæ•¸å­—é¡å‹
                item.quantity = Number(finalQuantity);
                
                console.log(`âœ… æ›´æ–°å•†å“æ•¸é‡: ${item.name || item.productName || productId} -> ${finalQuantity}`);
                
                try {
                    localStorage.setItem('jiangchong_cart', JSON.stringify(cart));
                } catch (error) {
                    console.error('å„²å­˜è³¼ç‰©è»Šå¤±æ•—:', error);
                    alert('æ›´æ–°å¤±æ•—ï¼Œè«‹é‡è©¦');
                    return;
                }
                
                // é‡æ–°è¼‰å…¥è³¼ç‰©è»Šä»¥æ›´æ–°é¡¯ç¤º
                loadCart();
                
                // æ›´æ–°å°èˆªæ¬„è³¼ç‰©è»Šæ•¸é‡
                if (window.FrontProducts && window.FrontProducts.updateCartCount) {
                    window.FrontProducts.updateCartCount();
                } else if (window.localCart && window.localCart.updateCartUI) {
                    window.localCart.updateCartUI();
                }
            } else {
                console.warn('æ‰¾ä¸åˆ°è¦æ›´æ–°çš„å•†å“:', productId);
                console.log('ç•¶å‰è³¼ç‰©è»Š:', cart);
            }
        }

        // ç§»é™¤å•†å“
        function removeItem(productId) {
            // å…è¨± productId ç‚º 0 æˆ– '0'ï¼ˆåƒ¹æ ¼ç‚º 0 çš„å•†å“ï¼‰
            if (productId === undefined || productId === null || productId === '') {
                console.error('removeItem: productId ç‚ºç©º');
                return;
            }
            
            // æ‰¾åˆ°è¦ç§»é™¤çš„å•†å“
            const itemToRemove = cart.find(item => {
                // ä½¿ç”¨å¤šç¨®æ–¹å¼æ¯”è¼ƒï¼Œç¢ºä¿èƒ½æ‰¾åˆ°å•†å“
                return item.productId === productId || 
                       String(item.productId) === String(productId) ||
                       (item.productId && item.productId.toString() === productId.toString());
            });
            
            if (!itemToRemove) {
                console.warn('æ‰¾ä¸åˆ°è¦ç§»é™¤çš„å•†å“:', productId);
                console.log('ç•¶å‰è³¼ç‰©è»Š:', cart);
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦ç§»é™¤ã€Œ${itemToRemove.name || itemToRemove.productName || 'æ­¤å•†å“'}ã€å—ï¼Ÿ`)) {
                // ä½¿ç”¨åš´æ ¼éæ¿¾ï¼Œç¢ºä¿æ­£ç¢ºç§»é™¤
                const originalLength = cart.length;
                cart = cart.filter(item => {
                    // ä½¿ç”¨å¤šç¨®æ–¹å¼æ¯”è¼ƒï¼Œç¢ºä¿æ­£ç¢ºéæ¿¾
                    const isMatch = item.productId === productId || 
                                   String(item.productId) === String(productId) ||
                                   (item.productId && item.productId.toString() === productId.toString());
                    return !isMatch;
                });
                
                // é©—è­‰æ˜¯å¦æˆåŠŸç§»é™¤
                if (cart.length === originalLength) {
                    console.error('ç§»é™¤å¤±æ•—ï¼šå•†å“ä»åœ¨è³¼ç‰©è»Šä¸­');
                    alert('ç§»é™¤å¤±æ•—ï¼Œè«‹é‡è©¦');
                    return;
                }
                
                // å„²å­˜åˆ° localStorage
                try {
                    localStorage.setItem('jiangchong_cart', JSON.stringify(cart));
                    console.log('âœ… å•†å“å·²ç§»é™¤ï¼Œå‰©é¤˜å•†å“æ•¸:', cart.length);
                } catch (error) {
                    console.error('å„²å­˜è³¼ç‰©è»Šå¤±æ•—:', error);
                    alert('å„²å­˜å¤±æ•—ï¼Œè«‹é‡è©¦');
                    return;
                }
                
                // é‡æ–°è¼‰å…¥è³¼ç‰©è»Š
                loadCart();
                
                // æ›´æ–°å°èˆªæ¬„è³¼ç‰©è»Šæ•¸é‡
                if (window.FrontProducts && window.FrontProducts.updateCartCount) {
                    window.FrontProducts.updateCartCount();
                } else if (window.localCart && window.localCart.updateCartUI) {
                    window.localCart.updateCartUI();
                }
            }
        }

        // æ›´æ–°è¨‚å–®æ‘˜è¦
        function updateCartSummary() {
            if (cart.length === 0) {
                renderEmptyCart();
                return;
            }
            
            // è¨ˆç®—å°è¨ˆï¼ˆç¢ºä¿åƒ¹æ ¼å’Œæ•¸é‡éƒ½æ˜¯æ•¸å­—ï¼‰
            const subtotal = cart.reduce((sum, item) => {
                const price = parseFloat(item.price) || 0;
                const quantity = parseInt(item.quantity) || 1;
                return sum + (price * quantity);
            }, 0);
            
            // é‹è²»è¨ˆç®—ï¼ˆæ»¿1000å…é‹ï¼Œè¶…å•†å–è²¨é‹è²» 60 å…ƒï¼‰
            const shippingFee = subtotal >= 1000 ? 0 : 60;
            
            // æŠ˜æ‰£è¨ˆç®—ï¼ˆæ»¿1000æŠ˜100 + å„ªæƒ åˆ¸æŠ˜æ‰£ï¼‰
            const baseDiscount = subtotal >= 1000 ? 100 : 0;
            const discount = baseDiscount + (couponDiscount || 0);
            
            const total = subtotal + shippingFee - discount;

            // æ›´æ–°é¡¯ç¤º
            const subtotalEl = document.getElementById('cartSubtotal');
            const shippingEl = document.getElementById('cartShipping');
            const discountEl = document.getElementById('cartDiscount');
            const totalEl = document.getElementById('cartTotal');
            
            if (subtotalEl) subtotalEl.textContent = `NT$ ${subtotal.toLocaleString()}`;
            if (shippingEl) shippingEl.textContent = shippingFee === 0 ? 'å…é‹' : `NT$ ${shippingFee}`;
            if (discountEl) discountEl.textContent = discount > 0 ? `-NT$ ${discount.toLocaleString()}` : '-NT$ 0';
            if (totalEl) totalEl.textContent = `NT$ ${total.toLocaleString()}`;

            // å•Ÿç”¨/åœç”¨çµå¸³æŒ‰éˆ•
            const checkoutBtn = document.getElementById('checkout-button');
            const checkoutNavBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.disabled = false;
            }
            if (checkoutNavBtn) {
                checkoutNavBtn.classList.remove('hidden');
            }
        }

        // å¥—ç”¨å„ªæƒ åˆ¸
        async function applyCoupon() {
            const code = document.getElementById('couponCode').value.trim();
            const messageEl = document.getElementById('couponMessage');
            
            if (!code) {
                messageEl.textContent = 'è«‹è¼¸å…¥å„ªæƒ ç¢¼';
                messageEl.className = 'text-xs mt-2 text-red-500';
                return;
            }

            // è¨ˆç®—ç•¶å‰å°è¨ˆï¼ˆç¢ºä¿åƒ¹æ ¼å’Œæ•¸é‡éƒ½æ˜¯æ•¸å­—ï¼‰
            const subtotal = cart.reduce((sum, item) => {
                const price = parseFloat(item.price) || 0;
                const quantity = parseInt(item.quantity) || 1;
                return sum + (price * quantity);
            }, 0);

            try {
                if (window.ApiClient) {
                    const response = await window.ApiClient.validateCoupon(code.toUpperCase(), subtotal);
                    
                    if (response.success && response.data) {
                        appliedCoupon = response.data.coupon;
                        const discountAmount = response.data.discountAmount;
                        
                        // è¨ˆç®—æŠ˜æ‰£ï¼ˆé€™è£¡éœ€è¦æ›´æ–°è¨ˆç®—é‚è¼¯ï¼‰
                        const baseDiscount = subtotal >= 1000 ? 100 : 0;
                        couponDiscount = discountAmount;
                        
                        messageEl.textContent = `âœ… å„ªæƒ åˆ¸ã€Œ${appliedCoupon.name}ã€å·²å¥—ç”¨ï¼`;
                        messageEl.className = 'text-xs mt-2 text-green-600';
                        updateCartSummary();
                    } else {
                        throw new Error(response.message || 'å„ªæƒ ç¢¼ç„¡æ•ˆæˆ–å·²éæœŸ');
                    }
                } else {
                    throw new Error('API å®¢æˆ¶ç«¯æœªè¼‰å…¥');
                }
            } catch (error) {
                console.error('å„ªæƒ ç¢¼é©—è­‰å¤±æ•—:', error);
                messageEl.textContent = `âŒ ${error.message || 'å„ªæƒ ç¢¼ç„¡æ•ˆæˆ–å·²éæœŸ'}`;
                messageEl.className = 'text-xs mt-2 text-red-500';
                appliedCoupon = null;
                couponDiscount = 0;
                updateCartSummary();
            }
        }

        // å‰å¾€çµå¸³
        function proceedToCheckout() {
            console.log('ğŸ›’ é–‹å§‹çµå¸³æµç¨‹...');
            
            // é‡æ–°è¼‰å…¥è³¼ç‰©è»Šä»¥ç¢ºä¿æ•¸æ“šæœ€æ–°
            if (window.localCart && typeof window.localCart.getItems === 'function') {
                cart = window.localCart.getItems();
            } else {
                cart = JSON.parse(localStorage.getItem('jiangchong_cart') || '[]');
            }
            
            console.log('ğŸ“¦ è³¼ç‰©è»Šå…§å®¹:', cart);
            
            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼è«‹å…ˆåŠ å…¥å•†å“ã€‚');
                return;
            }

            // å¦‚æœæœ‰å¥—ç”¨å„ªæƒ åˆ¸ï¼Œå„²å­˜åˆ° localStorage
            if (appliedCoupon) {
                localStorage.setItem('appliedCoupon', JSON.stringify(appliedCoupon));
                localStorage.setItem('couponDiscount', couponDiscount.toString());
                console.log('âœ… å„ªæƒ åˆ¸å·²å„²å­˜:', appliedCoupon);
            } else {
                localStorage.removeItem('appliedCoupon');
                localStorage.removeItem('couponDiscount');
            }

            // ç¢ºä¿è³¼ç‰©è»Šæ•¸æ“šå·²ä¿å­˜
            if (window.localCart && typeof window.localCart.saveCart === 'function') {
                window.localCart.saveCart();
            }

            console.log('ğŸš€ è·³è½‰åˆ°çµå¸³é é¢...');
            // è·³è½‰åˆ°çµå¸³é é¢
            window.location.href = 'checkout.html';
        }
        
        // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨å±€ï¼Œä¾›æŒ‰éˆ•èª¿ç”¨
        window.proceedToCheckout = proceedToCheckout;
        window.updateQuantity = updateQuantity;
        window.removeItem = removeItem;
        window.applyCoupon = applyCoupon;
    </script>
</body>
</html>

